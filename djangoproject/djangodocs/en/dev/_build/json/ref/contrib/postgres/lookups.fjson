{"parents": [{"link": "../../../", "title": "API Reference"}, {"link": "../../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">contrib</span></code> packages"}, {"link": "../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.postgres</span></code>"}], "prev": {"link": "../indexes/", "title": "PostgreSQL specific model indexes"}, "next": {"link": "../operations/", "title": "Database migration operations"}, "title": "PostgreSQL specific lookups", "meta": {}, "body": "<div class=\"section\" id=\"s-postgresql-specific-lookups\">\n<span id=\"postgresql-specific-lookups\"></span><h1>PostgreSQL specific lookups<a class=\"headerlink\" href=\"#postgresql-specific-lookups\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"section\" id=\"s-trigram-similarity\">\n<span id=\"trigram-similarity\"></span><h2>Trigram similarity<a class=\"headerlink\" href=\"#trigram-similarity\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<div class=\"section\" id=\"s-trigram-similar\">\n<span id=\"s-std-fieldlookup-trigram_similar\"></span><span id=\"s-std:fieldlookup-trigram_similar\"></span><span id=\"trigram-similar\"></span><span id=\"std-fieldlookup-trigram_similar\"></span><span id=\"std:fieldlookup-trigram_similar\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_similar</span></code><a class=\"headerlink\" href=\"#trigram-similar\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_similar</span></code> lookup allows you to perform trigram lookups,\nmeasuring the number of trigrams (three consecutive characters) shared, using a\ndedicated PostgreSQL extension. A trigram lookup is given an expression and\nreturns results that have a similarity measurement greater than the current\nsimilarity threshold.</p>\n<p>To use it, add <code class=\"docutils literal notranslate\"><span class=\"pre\">'django.contrib.postgres'</span></code> in your <a class=\"reference internal\" href=\"../../../settings/#std-setting-INSTALLED_APPS\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">INSTALLED_APPS</span></code></a>\nand activate the <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/pgtrgm.html\">pg_trgm extension</a> on PostgreSQL. You can install the\nextension using the\n<a class=\"reference internal\" href=\"../operations/#django.contrib.postgres.operations.TrigramExtension\" title=\"django.contrib.postgres.operations.TrigramExtension\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TrigramExtension</span></code></a> migration\noperation.</p>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_similar</span></code> lookup can be used on\n<a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.CharField\" title=\"django.db.models.CharField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">CharField</span></code></a> and <a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.TextField\" title=\"django.db.models.TextField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TextField</span></code></a>:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">City</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">name__trigram_similar</span><span class=\"o\">=</span><span class=\"s2\">&quot;Middlesborough&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">[&#39;&lt;City: Middlesbrough&gt;&#39;]</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"s-trigram-word-similar\">\n<span id=\"s-std-fieldlookup-trigram_word_similar\"></span><span id=\"s-std:fieldlookup-trigram_word_similar\"></span><span id=\"trigram-word-similar\"></span><span id=\"std-fieldlookup-trigram_word_similar\"></span><span id=\"std:fieldlookup-trigram_word_similar\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_word_similar</span></code><a class=\"headerlink\" href=\"#trigram-word-similar\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_word_similar</span></code> lookup allows you to perform trigram word\nsimilarity lookups using a dedicated PostgreSQL extension. It can be\napproximately understood as measuring the greatest number of trigrams shared\nbetween the parameter and any substring of the field. A trigram word lookup is\ngiven an expression and returns results that have a word similarity measurement\ngreater than the current similarity threshold.</p>\n<p>To use it, add <code class=\"docutils literal notranslate\"><span class=\"pre\">'django.contrib.postgres'</span></code> in your <a class=\"reference internal\" href=\"../../../settings/#std-setting-INSTALLED_APPS\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">INSTALLED_APPS</span></code></a>\nand activate the <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/pgtrgm.html\">pg_trgm extension</a> on PostgreSQL. You can install the\nextension using the\n<a class=\"reference internal\" href=\"../operations/#django.contrib.postgres.operations.TrigramExtension\" title=\"django.contrib.postgres.operations.TrigramExtension\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TrigramExtension</span></code></a> migration\noperation.</p>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_word_similar</span></code> lookup can be used on\n<a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.CharField\" title=\"django.db.models.CharField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">CharField</span></code></a> and <a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.TextField\" title=\"django.db.models.TextField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TextField</span></code></a>:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">Sentence</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">name__trigram_word_similar</span><span class=\"o\">=</span><span class=\"s2\">&quot;Middlesborough&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">[&#39;&lt;Sentence: Gumby rides on the path of Middlesbrough&gt;&#39;]</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"s-trigram-strict-word-similar\">\n<span id=\"s-std-fieldlookup-trigram_strict_word_similar\"></span><span id=\"s-std:fieldlookup-trigram_strict_word_similar\"></span><span id=\"trigram-strict-word-similar\"></span><span id=\"std-fieldlookup-trigram_strict_word_similar\"></span><span id=\"std:fieldlookup-trigram_strict_word_similar\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_strict_word_similar</span></code><a class=\"headerlink\" href=\"#trigram-strict-word-similar\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<div class=\"versionadded\">\n<span class=\"title\">New in Django 4.2.</span> </div>\n<p>Similar to <a class=\"reference internal\" href=\"#std-fieldlookup-trigram_word_similar\"><code class=\"xref std std-lookup docutils literal notranslate\"><span class=\"pre\">trigram_word_similar</span></code></a>, except that it forces extent\nboundaries to match word boundaries.</p>\n<p>To use it, add <code class=\"docutils literal notranslate\"><span class=\"pre\">'django.contrib.postgres'</span></code> in your <a class=\"reference internal\" href=\"../../../settings/#std-setting-INSTALLED_APPS\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">INSTALLED_APPS</span></code></a>\nand activate the <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/pgtrgm.html\">pg_trgm extension</a> on PostgreSQL. You can install the\nextension using the\n<a class=\"reference internal\" href=\"../operations/#django.contrib.postgres.operations.TrigramExtension\" title=\"django.contrib.postgres.operations.TrigramExtension\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TrigramExtension</span></code></a> migration\noperation.</p>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_strict_word_similar</span></code> lookup can be used on\n<a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.CharField\" title=\"django.db.models.CharField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">CharField</span></code></a> and <a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.TextField\" title=\"django.db.models.TextField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TextField</span></code></a>.</p>\n</div>\n</div>\n<div class=\"section\" id=\"s-unaccent\">\n<span id=\"unaccent\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">Unaccent</span></code><a class=\"headerlink\" href=\"#unaccent\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p id=\"std-fieldlookup-unaccent\"><span id=\"std:fieldlookup-unaccent\"></span>The <code class=\"docutils literal notranslate\"><span class=\"pre\">unaccent</span></code> lookup allows you to perform accent-insensitive lookups using\na dedicated PostgreSQL extension.</p>\n<p>This lookup is implemented using <a class=\"reference internal\" href=\"../../../models/lookups/#django.db.models.Transform\" title=\"django.db.models.Transform\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Transform</span></code></a>, so it\ncan be chained with other lookup functions. To use it, you need to add\n<code class=\"docutils literal notranslate\"><span class=\"pre\">'django.contrib.postgres'</span></code> in your <a class=\"reference internal\" href=\"../../../settings/#std-setting-INSTALLED_APPS\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">INSTALLED_APPS</span></code></a> and activate\nthe <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/unaccent.html\">unaccent extension on PostgreSQL</a>. The\n<a class=\"reference internal\" href=\"../operations/#django.contrib.postgres.operations.UnaccentExtension\" title=\"django.contrib.postgres.operations.UnaccentExtension\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">UnaccentExtension</span></code></a> migration\noperation is available if you want to perform this activation using migrations).</p>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">unaccent</span></code> lookup can be used on\n<a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.CharField\" title=\"django.db.models.CharField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">CharField</span></code></a> and <a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.TextField\" title=\"django.db.models.TextField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TextField</span></code></a>:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">City</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">name__unaccent</span><span class=\"o\">=</span><span class=\"s2\">&quot;M\u00e9xico&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">[&#39;&lt;City: Mexico&gt;&#39;]</span>\n\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">User</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">first_name__unaccent__startswith</span><span class=\"o\">=</span><span class=\"s2\">&quot;Jerem&quot;</span><span class=\"p\">)</span>\n<span class=\"go\">[&#39;&lt;User: Jeremy&gt;&#39;, &#39;&lt;User: J\u00e9r\u00e9my&gt;&#39;, &#39;&lt;User: J\u00e9r\u00e9mie&gt;&#39;, &#39;&lt;User: Jeremie&gt;&#39;]</span>\n</pre></div>\n</div>\n<div class=\"admonition warning\">\n<p class=\"first admonition-title\">Warning</p>\n<p class=\"last\"><code class=\"docutils literal notranslate\"><span class=\"pre\">unaccent</span></code> lookups should perform fine in most use cases. However, queries\nusing this filter will generally perform full table scans, which can be slow\non large tables. In those cases, using dedicated full text indexing tools\nmight be appropriate.</p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["ref/contrib/postgres/operations", "Database migration operations", "N", "next"], ["ref/contrib/postgres/indexes", "PostgreSQL specific model indexes", "P", "previous"]], "sourcename": "ref/contrib/postgres/lookups.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">PostgreSQL specific lookups</a><ul>\n<li><a class=\"reference internal\" href=\"#trigram-similarity\">Trigram similarity</a><ul>\n<li><a class=\"reference internal\" href=\"#trigram-similar\"><code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_similar</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#trigram-word-similar\"><code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_word_similar</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#trigram-strict-word-similar\"><code class=\"docutils literal notranslate\"><span class=\"pre\">trigram_strict_word_similar</span></code></a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#unaccent\"><code class=\"docutils literal notranslate\"><span class=\"pre\">Unaccent</span></code></a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "ref/contrib/postgres/lookups", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}
