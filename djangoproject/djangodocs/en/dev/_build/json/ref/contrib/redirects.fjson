{"parents": [{"link": "../../", "title": "API Reference"}, {"link": "../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">contrib</span></code> packages"}], "prev": {"link": "../postgres/validators/", "title": "Validators"}, "next": {"link": "../sitemaps/", "title": "The sitemap framework"}, "title": "The redirects app", "meta": {}, "body": "<div class=\"section\" id=\"s-module-django.contrib.redirects\">\n<span id=\"s-the-redirects-app\"></span><span id=\"module-django.contrib.redirects\"></span><span id=\"the-redirects-app\"></span><h1>The redirects app<a class=\"headerlink\" href=\"#module-django.contrib.redirects\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>Django comes with an optional redirects application. It lets you store\nredirects in a database and handles the redirecting for you. It uses the HTTP\nresponse status code <code class=\"docutils literal notranslate\"><span class=\"pre\">301</span> <span class=\"pre\">Moved</span> <span class=\"pre\">Permanently</span></code> by default.</p>\n<div class=\"section\" id=\"s-installation\">\n<span id=\"installation\"></span><h2>Installation<a class=\"headerlink\" href=\"#installation\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>To install the redirects app, follow these steps:</p>\n<ol class=\"arabic simple\">\n<li>Ensure that the <code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.sites</span></code> framework\n<a class=\"reference internal\" href=\"../sites/#enabling-the-sites-framework\"><span class=\"std std-ref\">is installed</span></a>.</li>\n<li>Add <code class=\"docutils literal notranslate\"><span class=\"pre\">'django.contrib.redirects'</span></code> to your <a class=\"reference internal\" href=\"../../settings/#std-setting-INSTALLED_APPS\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">INSTALLED_APPS</span></code></a> setting.</li>\n<li>Add <code class=\"docutils literal notranslate\"><span class=\"pre\">'django.contrib.redirects.middleware.RedirectFallbackMiddleware'</span></code>\nto your <a class=\"reference internal\" href=\"../../settings/#std-setting-MIDDLEWARE\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">MIDDLEWARE</span></code></a> setting.</li>\n<li>Run the command <a class=\"reference internal\" href=\"../../django-admin/#django-admin-migrate\"><code class=\"xref std std-djadmin docutils literal notranslate\"><span class=\"pre\">manage.py</span> <span class=\"pre\">migrate</span></code></a>.</li>\n</ol>\n</div>\n<div class=\"section\" id=\"s-how-it-works\">\n<span id=\"how-it-works\"></span><h2>How it works<a class=\"headerlink\" href=\"#how-it-works\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">manage.py</span> <span class=\"pre\">migrate</span></code> creates a <code class=\"docutils literal notranslate\"><span class=\"pre\">django_redirect</span></code> table in your database. This\nis a lookup table with <code class=\"docutils literal notranslate\"><span class=\"pre\">site_id</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">old_path</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">new_path</span></code> fields.</p>\n<p>The <a class=\"reference internal\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware\" title=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">RedirectFallbackMiddleware</span></code></a>\ndoes all of the work. Each time any Django application raises a 404\nerror, this middleware checks the redirects database for the requested\nURL as a last resort. Specifically, it checks for a redirect with the\ngiven <code class=\"docutils literal notranslate\"><span class=\"pre\">old_path</span></code> with a site ID that corresponds to the\n<a class=\"reference internal\" href=\"../../settings/#std-setting-SITE_ID\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">SITE_ID</span></code></a> setting.</p>\n<ul class=\"simple\">\n<li>If it finds a match, and <code class=\"docutils literal notranslate\"><span class=\"pre\">new_path</span></code> is not empty, it redirects to\n<code class=\"docutils literal notranslate\"><span class=\"pre\">new_path</span></code> using a 301 (\u201cMoved Permanently\u201d) redirect. You can subclass\n<a class=\"reference internal\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware\" title=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">RedirectFallbackMiddleware</span></code></a>\nand set\n<a class=\"reference internal\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware.response_redirect_class\" title=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware.response_redirect_class\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">response_redirect_class</span></code></a>\nto <a class=\"reference internal\" href=\"../../request-response/#django.http.HttpResponseRedirect\" title=\"django.http.HttpResponseRedirect\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">django.http.HttpResponseRedirect</span></code></a> to use a\n<code class=\"docutils literal notranslate\"><span class=\"pre\">302</span> <span class=\"pre\">Moved</span> <span class=\"pre\">Temporarily</span></code> redirect instead.</li>\n<li>If it finds a match, and <code class=\"docutils literal notranslate\"><span class=\"pre\">new_path</span></code> is empty, it sends a 410 (\u201cGone\u201d)\nHTTP header and empty (content-less) response.</li>\n<li>If it doesn\u2019t find a match, the request continues to be processed as\nusual.</li>\n</ul>\n<p>The middleware only gets activated for 404s \u2013 not for 500s or responses of any\nother status code.</p>\n<p>Note that the order of <a class=\"reference internal\" href=\"../../settings/#std-setting-MIDDLEWARE\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">MIDDLEWARE</span></code></a> matters. Generally, you can put\n<a class=\"reference internal\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware\" title=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">RedirectFallbackMiddleware</span></code></a> at the\nend of the list, because it\u2019s a last resort.</p>\n<p>For more on middleware, read the <a class=\"reference internal\" href=\"../../../topics/http/middleware/\"><span class=\"doc\">middleware docs</span></a>.</p>\n</div>\n<div class=\"section\" id=\"s-how-to-add-change-and-delete-redirects\">\n<span id=\"how-to-add-change-and-delete-redirects\"></span><h2>How to add, change and delete redirects<a class=\"headerlink\" href=\"#how-to-add-change-and-delete-redirects\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<div class=\"section\" id=\"s-via-the-admin-interface\">\n<span id=\"via-the-admin-interface\"></span><h3>Via the admin interface<a class=\"headerlink\" href=\"#via-the-admin-interface\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>If you\u2019ve activated the automatic Django admin interface, you should see a\n\u201cRedirects\u201d section on the admin index page. Edit redirects as you edit any\nother object in the system.</p>\n</div>\n<div class=\"section\" id=\"s-via-the-python-api\">\n<span id=\"via-the-python-api\"></span><h3>Via the Python API<a class=\"headerlink\" href=\"#via-the-python-api\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.redirects.models.Redirect\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-prename descclassname\"><span class=\"pre\">models.</span></code><code class=\"sig-name descname\"><span class=\"pre\">Redirect</span></code><a class=\"headerlink\" href=\"#django.contrib.redirects.models.Redirect\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Redirects are represented by a standard <a class=\"reference internal\" href=\"../../../topics/db/models/\"><span class=\"doc\">Django model</span></a>,\nwhich lives in <a class=\"reference external\" href=\"https://github.com/django/django/blob/main/django/contrib/redirects/models.py\">django/contrib/redirects/models.py</a>. You can access\nredirect objects via the <a class=\"reference internal\" href=\"../../../topics/db/queries/\"><span class=\"doc\">Django database API</span></a>.\nFor example:</p>\n<div class=\"highlight-pycon notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span> <span class=\"nn\">django.conf</span> <span class=\"kn\">import</span> <span class=\"n\">settings</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"kn\">from</span> <span class=\"nn\">django.contrib.redirects.models</span> <span class=\"kn\">import</span> <span class=\"n\">Redirect</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"c1\"># Add a new redirect.</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">redirect</span> <span class=\"o\">=</span> <span class=\"n\">Redirect</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span>\n<span class=\"gp\">... </span>    <span class=\"n\">site_id</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span>\n<span class=\"gp\">... </span>    <span class=\"n\">old_path</span><span class=\"o\">=</span><span class=\"s2\">&quot;/contact-us/&quot;</span><span class=\"p\">,</span>\n<span class=\"gp\">... </span>    <span class=\"n\">new_path</span><span class=\"o\">=</span><span class=\"s2\">&quot;/contact/&quot;</span><span class=\"p\">,</span>\n<span class=\"gp\">... </span><span class=\"p\">)</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"c1\"># Change a redirect.</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">redirect</span><span class=\"o\">.</span><span class=\"n\">new_path</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;/contact-details/&quot;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">redirect</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">redirect</span>\n<span class=\"go\">&lt;Redirect: /contact-us/ ---&gt; /contact-details/&gt;</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"c1\"># Delete a redirect.</span>\n<span class=\"gp\">&gt;&gt;&gt; </span><span class=\"n\">Redirect</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">site_id</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">old_path</span><span class=\"o\">=</span><span class=\"s2\">&quot;/contact-us/&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span>\n<span class=\"go\">(1, {&#39;redirects.Redirect&#39;: 1})</span>\n</pre></div>\n</div>\n</dd></dl>\n\n</div>\n</div>\n<div class=\"section\" id=\"s-middleware\">\n<span id=\"middleware\"></span><h2>Middleware<a class=\"headerlink\" href=\"#middleware\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-prename descclassname\"><span class=\"pre\">middleware.</span></code><code class=\"sig-name descname\"><span class=\"pre\">RedirectFallbackMiddleware</span></code><a class=\"headerlink\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>You can change the <a class=\"reference internal\" href=\"../../request-response/#django.http.HttpResponse\" title=\"django.http.HttpResponse\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">HttpResponse</span></code></a> classes used\nby the middleware by creating a subclass of\n<a class=\"reference internal\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware\" title=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">RedirectFallbackMiddleware</span></code></a>\nand overriding <code class=\"docutils literal notranslate\"><span class=\"pre\">response_gone_class</span></code> and/or <code class=\"docutils literal notranslate\"><span class=\"pre\">response_redirect_class</span></code>.</p>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware.response_gone_class\">\n<code class=\"sig-name descname\"><span class=\"pre\">response_gone_class</span></code><a class=\"headerlink\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware.response_gone_class\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>The <a class=\"reference internal\" href=\"../../request-response/#django.http.HttpResponse\" title=\"django.http.HttpResponse\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">HttpResponse</span></code></a> class used when a\n<a class=\"reference internal\" href=\"#django.contrib.redirects.models.Redirect\" title=\"django.contrib.redirects.models.Redirect\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Redirect</span></code></a> is not found for the\nrequested path or has a blank <code class=\"docutils literal notranslate\"><span class=\"pre\">new_path</span></code> value.</p>\n<p>Defaults to <a class=\"reference internal\" href=\"../../request-response/#django.http.HttpResponseGone\" title=\"django.http.HttpResponseGone\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">HttpResponseGone</span></code></a>.</p>\n</dd></dl>\n\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.redirects.middleware.RedirectFallbackMiddleware.response_redirect_class\">\n<code class=\"sig-name descname\"><span class=\"pre\">response_redirect_class</span></code><a class=\"headerlink\" href=\"#django.contrib.redirects.middleware.RedirectFallbackMiddleware.response_redirect_class\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>The <a class=\"reference internal\" href=\"../../request-response/#django.http.HttpResponse\" title=\"django.http.HttpResponse\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">HttpResponse</span></code></a> class that handles the redirect.</p>\n<p>Defaults to <a class=\"reference internal\" href=\"../../request-response/#django.http.HttpResponsePermanentRedirect\" title=\"django.http.HttpResponsePermanentRedirect\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">HttpResponsePermanentRedirect</span></code></a>.</p>\n</dd></dl>\n\n</dd></dl>\n\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["ref/contrib/sitemaps", "The sitemap framework", "N", "next"], ["ref/contrib/postgres/validators", "Validators", "P", "previous"]], "sourcename": "ref/contrib/redirects.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">The redirects app</a><ul>\n<li><a class=\"reference internal\" href=\"#installation\">Installation</a></li>\n<li><a class=\"reference internal\" href=\"#how-it-works\">How it works</a></li>\n<li><a class=\"reference internal\" href=\"#how-to-add-change-and-delete-redirects\">How to add, change and delete redirects</a><ul>\n<li><a class=\"reference internal\" href=\"#via-the-admin-interface\">Via the admin interface</a></li>\n<li><a class=\"reference internal\" href=\"#via-the-python-api\">Via the Python API</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#middleware\">Middleware</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "ref/contrib/redirects", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}
