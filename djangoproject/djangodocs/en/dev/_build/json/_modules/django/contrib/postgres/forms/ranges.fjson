{"parents": [{"link": "../../../../../", "title": "Module code"}, {"link": "../../../../", "title": "django"}], "title": "django.contrib.postgres.forms.ranges", "body": "<h1>Source code for django.contrib.postgres.forms.ranges</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">django</span> <span class=\"kn\">import</span> <span class=\"n\">forms</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core</span> <span class=\"kn\">import</span> <span class=\"n\">exceptions</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.backends.postgresql.psycopg_any</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">DateRange</span><span class=\"p\">,</span>\n    <span class=\"n\">DateTimeTZRange</span><span class=\"p\">,</span>\n    <span class=\"n\">NumericRange</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.forms.widgets</span> <span class=\"kn\">import</span> <span class=\"n\">HiddenInput</span><span class=\"p\">,</span> <span class=\"n\">MultiWidget</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.translation</span> <span class=\"kn\">import</span> <span class=\"n\">gettext_lazy</span> <span class=\"k\">as</span> <span class=\"n\">_</span>\n\n<span class=\"n\">__all__</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"s2\">&quot;BaseRangeField&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;IntegerRangeField&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;DecimalRangeField&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;DateTimeRangeField&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;DateRangeField&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;HiddenRangeWidget&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;RangeWidget&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">]</span>\n\n\n<div class=\"viewcode-block\" id=\"RangeWidget\"><a class=\"viewcode-back\" href=\"../../../../../../ref/contrib/postgres/forms/#django.contrib.postgres.forms.RangeWidget\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">RangeWidget</span><span class=\"p\">(</span><span class=\"n\">MultiWidget</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">base_widget</span><span class=\"p\">,</span> <span class=\"n\">attrs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">widgets</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">base_widget</span><span class=\"p\">,</span> <span class=\"n\">base_widget</span><span class=\"p\">)</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">widgets</span><span class=\"p\">,</span> <span class=\"n\">attrs</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"RangeWidget.decompress\"><a class=\"viewcode-back\" href=\"../../../../../../ref/contrib/postgres/forms/#django.contrib.postgres.forms.RangeWidget.decompress\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">decompress</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">value</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">upper</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span></div></div>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">HiddenRangeWidget</span><span class=\"p\">(</span><span class=\"n\">RangeWidget</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;A widget that splits input into two &lt;input type=&quot;hidden&quot;&gt; inputs.&quot;&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">attrs</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">HiddenInput</span><span class=\"p\">,</span> <span class=\"n\">attrs</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">BaseRangeField</span><span class=\"p\">(</span><span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">MultiValueField</span><span class=\"p\">):</span>\n    <span class=\"n\">default_error_messages</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n        <span class=\"s2\">&quot;invalid&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter two valid values.&quot;</span><span class=\"p\">),</span>\n        <span class=\"s2\">&quot;bound_ordering&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;The start of the range must not exceed the end of the range.&quot;</span>\n        <span class=\"p\">),</span>\n    <span class=\"p\">}</span>\n    <span class=\"n\">hidden_widget</span> <span class=\"o\">=</span> <span class=\"n\">HiddenRangeWidget</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;widget&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">RangeWidget</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">base_field</span><span class=\"o\">.</span><span class=\"n\">widget</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;fields&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">base_field</span><span class=\"p\">(</span><span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">base_field</span><span class=\"p\">(</span><span class=\"n\">required</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n            <span class=\"p\">]</span>\n        <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span><span class=\"p\">(</span><span class=\"s2\">&quot;required&quot;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">setdefault</span><span class=\"p\">(</span><span class=\"s2\">&quot;require_all_fields&quot;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">range_kwargs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n        <span class=\"k\">if</span> <span class=\"n\">default_bounds</span> <span class=\"o\">:=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s2\">&quot;default_bounds&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">range_kwargs</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;bounds&quot;</span><span class=\"p\">:</span> <span class=\"n\">default_bounds</span><span class=\"p\">}</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">prepare_value</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">):</span>\n        <span class=\"n\">lower_base</span><span class=\"p\">,</span> <span class=\"n\">upper_base</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fields</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">range_type</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"p\">[</span>\n                <span class=\"n\">lower_base</span><span class=\"o\">.</span><span class=\"n\">prepare_value</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">),</span>\n                <span class=\"n\">upper_base</span><span class=\"o\">.</span><span class=\"n\">prepare_value</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"o\">.</span><span class=\"n\">upper</span><span class=\"p\">),</span>\n            <span class=\"p\">]</span>\n        <span class=\"k\">if</span> <span class=\"n\">value</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"p\">[</span>\n                <span class=\"n\">lower_base</span><span class=\"o\">.</span><span class=\"n\">prepare_value</span><span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">),</span>\n                <span class=\"n\">upper_base</span><span class=\"o\">.</span><span class=\"n\">prepare_value</span><span class=\"p\">(</span><span class=\"kc\">None</span><span class=\"p\">),</span>\n            <span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"n\">value</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">compress</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">values</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">values</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n        <span class=\"n\">lower</span><span class=\"p\">,</span> <span class=\"n\">upper</span> <span class=\"o\">=</span> <span class=\"n\">values</span>\n        <span class=\"k\">if</span> <span class=\"n\">lower</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"n\">upper</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"n\">lower</span> <span class=\"o\">&gt;</span> <span class=\"n\">upper</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">exceptions</span><span class=\"o\">.</span><span class=\"n\">ValidationError</span><span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">error_messages</span><span class=\"p\">[</span><span class=\"s2\">&quot;bound_ordering&quot;</span><span class=\"p\">],</span>\n                <span class=\"n\">code</span><span class=\"o\">=</span><span class=\"s2\">&quot;bound_ordering&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">range_value</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">range_type</span><span class=\"p\">(</span><span class=\"n\">lower</span><span class=\"p\">,</span> <span class=\"n\">upper</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">range_kwargs</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">TypeError</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">exceptions</span><span class=\"o\">.</span><span class=\"n\">ValidationError</span><span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">error_messages</span><span class=\"p\">[</span><span class=\"s2\">&quot;invalid&quot;</span><span class=\"p\">],</span>\n                <span class=\"n\">code</span><span class=\"o\">=</span><span class=\"s2\">&quot;invalid&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">range_value</span>\n\n\n<div class=\"viewcode-block\" id=\"IntegerRangeField\"><a class=\"viewcode-back\" href=\"../../../../../../ref/contrib/postgres/forms/#django.contrib.postgres.forms.IntegerRangeField\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">IntegerRangeField</span><span class=\"p\">(</span><span class=\"n\">BaseRangeField</span><span class=\"p\">):</span>\n    <span class=\"n\">default_error_messages</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;invalid&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter two whole numbers.&quot;</span><span class=\"p\">)}</span>\n    <span class=\"n\">base_field</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">IntegerField</span>\n    <span class=\"n\">range_type</span> <span class=\"o\">=</span> <span class=\"n\">NumericRange</span></div>\n\n\n<div class=\"viewcode-block\" id=\"DecimalRangeField\"><a class=\"viewcode-back\" href=\"../../../../../../ref/contrib/postgres/forms/#django.contrib.postgres.forms.DecimalRangeField\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">DecimalRangeField</span><span class=\"p\">(</span><span class=\"n\">BaseRangeField</span><span class=\"p\">):</span>\n    <span class=\"n\">default_error_messages</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;invalid&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter two numbers.&quot;</span><span class=\"p\">)}</span>\n    <span class=\"n\">base_field</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">DecimalField</span>\n    <span class=\"n\">range_type</span> <span class=\"o\">=</span> <span class=\"n\">NumericRange</span></div>\n\n\n<div class=\"viewcode-block\" id=\"DateTimeRangeField\"><a class=\"viewcode-back\" href=\"../../../../../../ref/contrib/postgres/forms/#django.contrib.postgres.forms.DateTimeRangeField\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">DateTimeRangeField</span><span class=\"p\">(</span><span class=\"n\">BaseRangeField</span><span class=\"p\">):</span>\n    <span class=\"n\">default_error_messages</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;invalid&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter two valid date/times.&quot;</span><span class=\"p\">)}</span>\n    <span class=\"n\">base_field</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">DateTimeField</span>\n    <span class=\"n\">range_type</span> <span class=\"o\">=</span> <span class=\"n\">DateTimeTZRange</span></div>\n\n\n<div class=\"viewcode-block\" id=\"DateRangeField\"><a class=\"viewcode-back\" href=\"../../../../../../ref/contrib/postgres/forms/#django.contrib.postgres.forms.DateRangeField\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">DateRangeField</span><span class=\"p\">(</span><span class=\"n\">BaseRangeField</span><span class=\"p\">):</span>\n    <span class=\"n\">default_error_messages</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;invalid&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Enter two valid dates.&quot;</span><span class=\"p\">)}</span>\n    <span class=\"n\">base_field</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">DateField</span>\n    <span class=\"n\">range_type</span> <span class=\"o\">=</span> <span class=\"n\">DateRange</span></div>\n</pre></div>", "current_page_name": "_modules/django/contrib/postgres/forms/ranges", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}
