{"parents": [{"link": "../../../", "title": "Module code"}, {"link": "../../", "title": "django"}], "title": "django.contrib.sitemaps", "body": "<h1>Source code for django.contrib.sitemaps</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">urllib.parse</span> <span class=\"kn\">import</span> <span class=\"n\">urlencode</span>\n<span class=\"kn\">from</span> <span class=\"nn\">urllib.request</span> <span class=\"kn\">import</span> <span class=\"n\">urlopen</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django.apps</span> <span class=\"kn\">import</span> <span class=\"n\">apps</span> <span class=\"k\">as</span> <span class=\"n\">django_apps</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.conf</span> <span class=\"kn\">import</span> <span class=\"n\">settings</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core</span> <span class=\"kn\">import</span> <span class=\"n\">paginator</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.exceptions</span> <span class=\"kn\">import</span> <span class=\"n\">ImproperlyConfigured</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.urls</span> <span class=\"kn\">import</span> <span class=\"n\">NoReverseMatch</span><span class=\"p\">,</span> <span class=\"n\">reverse</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils</span> <span class=\"kn\">import</span> <span class=\"n\">translation</span>\n\n<span class=\"n\">PING_URL</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;https://www.google.com/webmasters/tools/ping&quot;</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">SitemapNotFound</span><span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<div class=\"viewcode-block\" id=\"ping_google\"><a class=\"viewcode-back\" href=\"../../../../ref/contrib/sitemaps/#django.contrib.sitemaps.ping_google\">[docs]</a><span class=\"k\">def</span> <span class=\"nf\">ping_google</span><span class=\"p\">(</span><span class=\"n\">sitemap_url</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">ping_url</span><span class=\"o\">=</span><span class=\"n\">PING_URL</span><span class=\"p\">,</span> <span class=\"n\">sitemap_uses_https</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Alert Google that the sitemap for the current site has been updated.</span>\n<span class=\"sd\">    If sitemap_url is provided, it should be an absolute path to the sitemap</span>\n<span class=\"sd\">    for this site -- e.g., &#39;/sitemap.xml&#39;. If sitemap_url is not provided, this</span>\n<span class=\"sd\">    function will attempt to deduce it by using urls.reverse().</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n    <span class=\"n\">sitemap_full_url</span> <span class=\"o\">=</span> <span class=\"n\">_get_sitemap_full_url</span><span class=\"p\">(</span><span class=\"n\">sitemap_url</span><span class=\"p\">,</span> <span class=\"n\">sitemap_uses_https</span><span class=\"p\">)</span>\n    <span class=\"n\">params</span> <span class=\"o\">=</span> <span class=\"n\">urlencode</span><span class=\"p\">({</span><span class=\"s2\">&quot;sitemap&quot;</span><span class=\"p\">:</span> <span class=\"n\">sitemap_full_url</span><span class=\"p\">})</span>\n    <span class=\"n\">urlopen</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">?</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">ping_url</span><span class=\"p\">,</span> <span class=\"n\">params</span><span class=\"p\">))</span></div>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">_get_sitemap_full_url</span><span class=\"p\">(</span><span class=\"n\">sitemap_url</span><span class=\"p\">,</span> <span class=\"n\">sitemap_uses_https</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">):</span>\n    <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">django_apps</span><span class=\"o\">.</span><span class=\"n\">is_installed</span><span class=\"p\">(</span><span class=\"s2\">&quot;django.contrib.sites&quot;</span><span class=\"p\">):</span>\n        <span class=\"k\">raise</span> <span class=\"n\">ImproperlyConfigured</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;ping_google requires django.contrib.sites, which isn&#39;t installed.&quot;</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">sitemap_url</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"c1\"># First, try to get the &quot;index&quot; sitemap URL.</span>\n            <span class=\"n\">sitemap_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;django.contrib.sitemaps.views.index&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"n\">NoReverseMatch</span><span class=\"p\">:</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Next, try for the &quot;global&quot; sitemap URL.</span>\n                <span class=\"n\">sitemap_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;django.contrib.sitemaps.views.sitemap&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"n\">NoReverseMatch</span><span class=\"p\">:</span>\n                <span class=\"k\">pass</span>\n\n    <span class=\"k\">if</span> <span class=\"n\">sitemap_url</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n        <span class=\"k\">raise</span> <span class=\"n\">SitemapNotFound</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;You didn&#39;t provide a sitemap_url, and the sitemap URL couldn&#39;t be &quot;</span>\n            <span class=\"s2\">&quot;auto-detected.&quot;</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"n\">Site</span> <span class=\"o\">=</span> <span class=\"n\">django_apps</span><span class=\"o\">.</span><span class=\"n\">get_model</span><span class=\"p\">(</span><span class=\"s2\">&quot;sites.Site&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">current_site</span> <span class=\"o\">=</span> <span class=\"n\">Site</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_current</span><span class=\"p\">()</span>\n    <span class=\"n\">scheme</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;https&quot;</span> <span class=\"k\">if</span> <span class=\"n\">sitemap_uses_https</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;http&quot;</span>\n    <span class=\"k\">return</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">://</span><span class=\"si\">%s%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">scheme</span><span class=\"p\">,</span> <span class=\"n\">current_site</span><span class=\"o\">.</span><span class=\"n\">domain</span><span class=\"p\">,</span> <span class=\"n\">sitemap_url</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"Sitemap\"><a class=\"viewcode-back\" href=\"../../../../ref/contrib/sitemaps/#django.contrib.sitemaps.Sitemap\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">Sitemap</span><span class=\"p\">:</span>\n    <span class=\"c1\"># This limit is defined by Google. See the index documentation at</span>\n    <span class=\"c1\"># https://www.sitemaps.org/protocol.html#index.</span>\n    <span class=\"n\">limit</span> <span class=\"o\">=</span> <span class=\"mi\">50000</span>\n\n    <span class=\"c1\"># If protocol is None, the URLs in the sitemap will use the protocol</span>\n    <span class=\"c1\"># with which the sitemap was requested.</span>\n    <span class=\"n\">protocol</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"c1\"># Enables generating URLs for all languages.</span>\n    <span class=\"n\">i18n</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n    <span class=\"c1\"># Override list of languages to use.</span>\n    <span class=\"n\">languages</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"c1\"># Enables generating alternate/hreflang links.</span>\n    <span class=\"n\">alternates</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n    <span class=\"c1\"># Add an alternate/hreflang link with value &#39;x-default&#39;.</span>\n    <span class=\"n\">x_default</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">attr</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">AttributeError</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">default</span>\n        <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"n\">attr</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">i18n</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Split the (item, lang_code) tuples again for the location,</span>\n                <span class=\"c1\"># priority, lastmod and changefreq method calls.</span>\n                <span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">lang_code</span> <span class=\"o\">=</span> <span class=\"n\">item</span>\n            <span class=\"k\">return</span> <span class=\"n\">attr</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">attr</span>\n\n<div class=\"viewcode-block\" id=\"Sitemap.get_languages_for_item\"><a class=\"viewcode-back\" href=\"../../../../ref/contrib/sitemaps/#django.contrib.sitemaps.Sitemap.get_languages_for_item\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_languages_for_item</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Languages for which this item is displayed.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_languages</span><span class=\"p\">()</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_languages</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">languages</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">languages</span>\n        <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">lang_code</span> <span class=\"k\">for</span> <span class=\"n\">lang_code</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">LANGUAGES</span><span class=\"p\">]</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_items</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">i18n</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Create (item, lang_code) tuples for all items and languages.</span>\n            <span class=\"c1\"># This is necessary to paginate with all languages already considered.</span>\n            <span class=\"n\">items</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n                <span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">lang_code</span><span class=\"p\">)</span>\n                <span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n                <span class=\"k\">for</span> <span class=\"n\">lang_code</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_languages_for_item</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span>\n            <span class=\"p\">]</span>\n            <span class=\"k\">return</span> <span class=\"n\">items</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_location</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">force_lang_code</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">i18n</span><span class=\"p\">:</span>\n            <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">lang_code</span> <span class=\"o\">=</span> <span class=\"n\">item</span>\n            <span class=\"c1\"># Activate language from item-tuple or forced one before calling location.</span>\n            <span class=\"k\">with</span> <span class=\"n\">translation</span><span class=\"o\">.</span><span class=\"n\">override</span><span class=\"p\">(</span><span class=\"n\">force_lang_code</span> <span class=\"ow\">or</span> <span class=\"n\">lang_code</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get</span><span class=\"p\">(</span><span class=\"s2\">&quot;location&quot;</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get</span><span class=\"p\">(</span><span class=\"s2\">&quot;location&quot;</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">paginator</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">paginator</span><span class=\"o\">.</span><span class=\"n\">Paginator</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_items</span><span class=\"p\">(),</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">limit</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"Sitemap.items\"><a class=\"viewcode-back\" href=\"../../../../ref/contrib/sitemaps/#django.contrib.sitemaps.Sitemap.items\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">items</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"p\">[]</span></div>\n\n<div class=\"viewcode-block\" id=\"Sitemap.location\"><a class=\"viewcode-back\" href=\"../../../../ref/contrib/sitemaps/#django.contrib.sitemaps.Sitemap.location\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">location</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">item</span><span class=\"o\">.</span><span class=\"n\">get_absolute_url</span><span class=\"p\">()</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_protocol</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">protocol</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"c1\"># Determine protocol</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">protocol</span> <span class=\"ow\">or</span> <span class=\"n\">protocol</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;https&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_domain</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">site</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"c1\"># Determine domain</span>\n        <span class=\"k\">if</span> <span class=\"n\">site</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">django_apps</span><span class=\"o\">.</span><span class=\"n\">is_installed</span><span class=\"p\">(</span><span class=\"s2\">&quot;django.contrib.sites&quot;</span><span class=\"p\">):</span>\n                <span class=\"n\">Site</span> <span class=\"o\">=</span> <span class=\"n\">django_apps</span><span class=\"o\">.</span><span class=\"n\">get_model</span><span class=\"p\">(</span><span class=\"s2\">&quot;sites.Site&quot;</span><span class=\"p\">)</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"n\">site</span> <span class=\"o\">=</span> <span class=\"n\">Site</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_current</span><span class=\"p\">()</span>\n                <span class=\"k\">except</span> <span class=\"n\">Site</span><span class=\"o\">.</span><span class=\"n\">DoesNotExist</span><span class=\"p\">:</span>\n                    <span class=\"k\">pass</span>\n            <span class=\"k\">if</span> <span class=\"n\">site</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"n\">ImproperlyConfigured</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;To use sitemaps, either enable the sites framework or pass &quot;</span>\n                    <span class=\"s2\">&quot;a Site/RequestSite object in your view.&quot;</span>\n                <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">site</span><span class=\"o\">.</span><span class=\"n\">domain</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_urls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">page</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">site</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">protocol</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">protocol</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_protocol</span><span class=\"p\">(</span><span class=\"n\">protocol</span><span class=\"p\">)</span>\n        <span class=\"n\">domain</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_domain</span><span class=\"p\">(</span><span class=\"n\">site</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_urls</span><span class=\"p\">(</span><span class=\"n\">page</span><span class=\"p\">,</span> <span class=\"n\">protocol</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"Sitemap.get_latest_lastmod\"><a class=\"viewcode-back\" href=\"../../../../ref/contrib/sitemaps/#django.contrib.sitemaps.Sitemap.get_latest_lastmod\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_latest_lastmod</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"s2\">&quot;lastmod&quot;</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n        <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lastmod</span><span class=\"p\">):</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"nb\">max</span><span class=\"p\">([</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lastmod</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()],</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"ne\">TypeError</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">None</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">lastmod</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_urls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">page</span><span class=\"p\">,</span> <span class=\"n\">protocol</span><span class=\"p\">,</span> <span class=\"n\">domain</span><span class=\"p\">):</span>\n        <span class=\"n\">urls</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">latest_lastmod</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"n\">all_items_lastmod</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>  <span class=\"c1\"># track if all items have a lastmod</span>\n\n        <span class=\"n\">paginator_page</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">paginator</span><span class=\"o\">.</span><span class=\"n\">page</span><span class=\"p\">(</span><span class=\"n\">page</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">item</span> <span class=\"ow\">in</span> <span class=\"n\">paginator_page</span><span class=\"o\">.</span><span class=\"n\">object_list</span><span class=\"p\">:</span>\n            <span class=\"n\">loc</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">protocol</span><span class=\"si\">}</span><span class=\"s2\">://</span><span class=\"si\">{</span><span class=\"n\">domain</span><span class=\"si\">}{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_location</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n            <span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get</span><span class=\"p\">(</span><span class=\"s2\">&quot;priority&quot;</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">)</span>\n            <span class=\"n\">lastmod</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get</span><span class=\"p\">(</span><span class=\"s2\">&quot;lastmod&quot;</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">all_items_lastmod</span><span class=\"p\">:</span>\n                <span class=\"n\">all_items_lastmod</span> <span class=\"o\">=</span> <span class=\"n\">lastmod</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n                <span class=\"k\">if</span> <span class=\"n\">all_items_lastmod</span> <span class=\"ow\">and</span> <span class=\"p\">(</span>\n                    <span class=\"n\">latest_lastmod</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">lastmod</span> <span class=\"o\">&gt;</span> <span class=\"n\">latest_lastmod</span>\n                <span class=\"p\">):</span>\n                    <span class=\"n\">latest_lastmod</span> <span class=\"o\">=</span> <span class=\"n\">lastmod</span>\n\n            <span class=\"n\">url_info</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n                <span class=\"s2\">&quot;item&quot;</span><span class=\"p\">:</span> <span class=\"n\">item</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;location&quot;</span><span class=\"p\">:</span> <span class=\"n\">loc</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;lastmod&quot;</span><span class=\"p\">:</span> <span class=\"n\">lastmod</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;changefreq&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get</span><span class=\"p\">(</span><span class=\"s2\">&quot;changefreq&quot;</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;priority&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">priority</span> <span class=\"k\">if</span> <span class=\"n\">priority</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;&quot;</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;alternates&quot;</span><span class=\"p\">:</span> <span class=\"p\">[],</span>\n            <span class=\"p\">}</span>\n\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">i18n</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">alternates</span><span class=\"p\">:</span>\n                <span class=\"n\">item_languages</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_languages_for_item</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n                <span class=\"k\">for</span> <span class=\"n\">lang_code</span> <span class=\"ow\">in</span> <span class=\"n\">item_languages</span><span class=\"p\">:</span>\n                    <span class=\"n\">loc</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">protocol</span><span class=\"si\">}</span><span class=\"s2\">://</span><span class=\"si\">{</span><span class=\"n\">domain</span><span class=\"si\">}{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_location</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">lang_code</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n                    <span class=\"n\">url_info</span><span class=\"p\">[</span><span class=\"s2\">&quot;alternates&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                        <span class=\"p\">{</span>\n                            <span class=\"s2\">&quot;location&quot;</span><span class=\"p\">:</span> <span class=\"n\">loc</span><span class=\"p\">,</span>\n                            <span class=\"s2\">&quot;lang_code&quot;</span><span class=\"p\">:</span> <span class=\"n\">lang_code</span><span class=\"p\">,</span>\n                        <span class=\"p\">}</span>\n                    <span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">x_default</span> <span class=\"ow\">and</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">LANGUAGE_CODE</span> <span class=\"ow\">in</span> <span class=\"n\">item_languages</span><span class=\"p\">:</span>\n                    <span class=\"n\">lang_code</span> <span class=\"o\">=</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">LANGUAGE_CODE</span>\n                    <span class=\"n\">loc</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"n\">protocol</span><span class=\"si\">}</span><span class=\"s2\">://</span><span class=\"si\">{</span><span class=\"n\">domain</span><span class=\"si\">}{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_location</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"n\">lang_code</span><span class=\"p\">)</span><span class=\"si\">}</span><span class=\"s2\">&quot;</span>\n                    <span class=\"n\">loc</span> <span class=\"o\">=</span> <span class=\"n\">loc</span><span class=\"o\">.</span><span class=\"n\">replace</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s2\">&quot;/</span><span class=\"si\">{</span><span class=\"n\">lang_code</span><span class=\"si\">}</span><span class=\"s2\">/&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;/&quot;</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n                    <span class=\"n\">url_info</span><span class=\"p\">[</span><span class=\"s2\">&quot;alternates&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                        <span class=\"p\">{</span>\n                            <span class=\"s2\">&quot;location&quot;</span><span class=\"p\">:</span> <span class=\"n\">loc</span><span class=\"p\">,</span>\n                            <span class=\"s2\">&quot;lang_code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;x-default&quot;</span><span class=\"p\">,</span>\n                        <span class=\"p\">}</span>\n                    <span class=\"p\">)</span>\n\n            <span class=\"n\">urls</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">url_info</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">all_items_lastmod</span> <span class=\"ow\">and</span> <span class=\"n\">latest_lastmod</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">latest_lastmod</span> <span class=\"o\">=</span> <span class=\"n\">latest_lastmod</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">urls</span></div>\n\n\n<div class=\"viewcode-block\" id=\"GenericSitemap\"><a class=\"viewcode-back\" href=\"../../../../ref/contrib/sitemaps/#django.contrib.sitemaps.GenericSitemap\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">GenericSitemap</span><span class=\"p\">(</span><span class=\"n\">Sitemap</span><span class=\"p\">):</span>\n    <span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">changefreq</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">info_dict</span><span class=\"p\">,</span> <span class=\"n\">priority</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">changefreq</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">protocol</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"n\">info_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;queryset&quot;</span><span class=\"p\">]</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_field</span> <span class=\"o\">=</span> <span class=\"n\">info_dict</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;date_field&quot;</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">priority</span> <span class=\"ow\">or</span> <span class=\"n\">priority</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">changefreq</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">changefreq</span> <span class=\"ow\">or</span> <span class=\"n\">changefreq</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">protocol</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">protocol</span> <span class=\"ow\">or</span> <span class=\"n\">protocol</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">items</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"c1\"># Make sure to return a clone; we don&#39;t want premature evaluation.</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">lastmod</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">item</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_field</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">item</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_field</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_latest_lastmod</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_field</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span><span class=\"s2\">&quot;-&quot;</span> <span class=\"o\">+</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_field</span><span class=\"p\">)</span>\n                <span class=\"o\">.</span><span class=\"n\">values_list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_field</span><span class=\"p\">,</span> <span class=\"n\">flat</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n                <span class=\"o\">.</span><span class=\"n\">first</span><span class=\"p\">()</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">None</span></div>\n</pre></div>", "current_page_name": "_modules/django/contrib/sitemaps", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}
