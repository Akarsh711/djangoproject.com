{"parents": [{"link": "../../../", "title": "\u201cHow-to\u201d guides"}, {"link": "../../", "title": "How to deploy Django"}, {"link": "../", "title": "How to deploy with WSGI"}], "prev": {"link": "../modwsgi/", "title": "How to use Django with Apache and <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code>"}, "next": {"link": "../../asgi/", "title": "How to deploy with ASGI"}, "title": "How to authenticate against Django\u2019s user database from Apache", "meta": {}, "body": "<div class=\"section\" id=\"s-how-to-authenticate-against-django-s-user-database-from-apache\">\n<span id=\"how-to-authenticate-against-django-s-user-database-from-apache\"></span><h1>How to authenticate against Django\u2019s user database from Apache<a class=\"headerlink\" href=\"#how-to-authenticate-against-django-s-user-database-from-apache\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>Since keeping multiple authentication databases in sync is a common problem when\ndealing with Apache, you can configure Apache to authenticate against Django\u2019s\n<a class=\"reference internal\" href=\"../../../../topics/auth/\"><span class=\"doc\">authentication system</span></a> directly. This requires Apache\nversion &gt;= 2.2 and mod_wsgi &gt;= 2.0. For example, you could:</p>\n<ul class=\"simple\">\n<li>Serve static/media files directly from Apache only to authenticated users.</li>\n<li>Authenticate access to a <a class=\"reference external\" href=\"https://subversion.apache.org/\">Subversion</a> repository against Django users with\na certain permission.</li>\n<li>Allow certain users to connect to a WebDAV share created with <a class=\"reference external\" href=\"https://httpd.apache.org/docs/2.2/mod/mod_dav.html\">mod_dav</a>.</li>\n</ul>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">If you have installed a <a class=\"reference internal\" href=\"../../../../topics/auth/customizing/#auth-custom-user\"><span class=\"std std-ref\">custom user model</span></a> and\nwant to use this default auth handler, it must support an <code class=\"docutils literal notranslate\"><span class=\"pre\">is_active</span></code>\nattribute. If you want to use group based authorization, your custom user\nmust have a relation named \u2018groups\u2019, referring to a related object that has\na \u2018name\u2019 field. You can also specify your own custom mod_wsgi\nauth handler if your custom cannot conform to these requirements.</p>\n</div>\n<div class=\"section\" id=\"s-authentication-with-mod-wsgi\">\n<span id=\"authentication-with-mod-wsgi\"></span><h2>Authentication with <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code><a class=\"headerlink\" href=\"#authentication-with-mod-wsgi\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">The use of <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIApplicationGroup</span> <span class=\"pre\">%{GLOBAL}</span></code> in the configurations below\npresumes that your Apache instance is running only one Django application.\nIf you are running more than one Django application, please refer to the\n<a class=\"reference external\" href=\"https://modwsgi.readthedocs.io/en/develop/user-guides/configuration-guidelines.html#defining-application-groups\">Defining Application Groups</a> section of the mod_wsgi docs for more\ninformation about this setting.</p>\n</div>\n<p>Make sure that mod_wsgi is installed and activated and that you have\nfollowed the steps to set up <a class=\"reference internal\" href=\"../modwsgi/\"><span class=\"doc\">Apache with mod_wsgi</span></a>.</p>\n<p>Next, edit your Apache configuration to add a location that you want\nonly authenticated users to be able to view:</p>\n<div class=\"highlight-apache notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">WSGIScriptAlias</span><span class=\"w\"> </span>/<span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"></span>\n<span class=\"nb\">WSGIPythonPath</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com</span><span class=\"w\"></span>\n\n<span class=\"nb\">WSGIProcessGroup</span><span class=\"w\"> </span>%{GLOBAL}<span class=\"w\"></span>\n<span class=\"nb\">WSGIApplicationGroup</span><span class=\"w\"> </span>%{GLOBAL}<span class=\"w\"></span>\n\n<span class=\"nt\">&lt;Location</span><span class=\"w\"> </span><span class=\"s\">&quot;/secret&quot;</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">AuthType</span><span class=\"w\"> </span>Basic<span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">AuthName</span><span class=\"w\"> </span><span class=\"s2\">&quot;Top Secret&quot;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">Require</span><span class=\"w\"> </span>valid-user<span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">AuthBasicProvider</span><span class=\"w\"> </span>wsgi<span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">WSGIAuthUserScript</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"></span>\n<span class=\"nt\">&lt;/Location&gt;</span><span class=\"w\"></span>\n</pre></div>\n</div>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIAuthUserScript</span></code> directive tells mod_wsgi to execute the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">check_password</span></code> function in specified wsgi script, passing the user name and\npassword that it receives from the prompt. In this example, the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIAuthUserScript</span></code> is the same as the <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIScriptAlias</span></code> that defines your\napplication <a class=\"reference internal\" href=\"../\"><span class=\"doc\">that is created by django-admin startproject</span></a>.</p>\n<div class=\"admonition-using-apache-2-2-with-authentication admonition\">\n<p class=\"first admonition-title\">Using Apache 2.2 with authentication</p>\n<p>Make sure that <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_auth_basic</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_authz_user</span></code> are loaded.</p>\n<p>These might be compiled statically into Apache, or you might need to use\nLoadModule to load them dynamically in your <code class=\"docutils literal notranslate\"><span class=\"pre\">httpd.conf</span></code>:</p>\n<div class=\"last highlight-apache notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">LoadModule</span><span class=\"w\"> </span>auth_basic_module<span class=\"w\"> </span>modules/mod_auth_basic.so<span class=\"w\"></span>\n<span class=\"nb\">LoadModule</span><span class=\"w\"> </span>authz_user_module<span class=\"w\"> </span>modules/mod_authz_user.so<span class=\"w\"></span>\n</pre></div>\n</div>\n</div>\n<p>Finally, edit your WSGI script <code class=\"docutils literal notranslate\"><span class=\"pre\">mysite.wsgi</span></code> to tie Apache\u2019s authentication\nto your site\u2019s authentication mechanisms by importing the <code class=\"docutils literal notranslate\"><span class=\"pre\">check_password</span></code>\nfunction:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">os</span>\n\n<span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"p\">[</span><span class=\"s2\">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;mysite.settings&quot;</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.handlers.modwsgi</span> <span class=\"kn\">import</span> <span class=\"n\">check_password</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.handlers.wsgi</span> <span class=\"kn\">import</span> <span class=\"n\">WSGIHandler</span>\n\n<span class=\"n\">application</span> <span class=\"o\">=</span> <span class=\"n\">WSGIHandler</span><span class=\"p\">()</span>\n</pre></div>\n</div>\n<p>Requests beginning with <code class=\"docutils literal notranslate\"><span class=\"pre\">/secret/</span></code> will now require a user to authenticate.</p>\n<p>The mod_wsgi <a class=\"reference external\" href=\"https://modwsgi.readthedocs.io/en/develop/user-guides/access-control-mechanisms.html\">access control mechanisms documentation</a> provides additional\ndetails and information about alternative methods of authentication.</p>\n<div class=\"section\" id=\"s-authorization-with-mod-wsgi-and-django-groups\">\n<span id=\"authorization-with-mod-wsgi-and-django-groups\"></span><h3>Authorization with <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code> and Django groups<a class=\"headerlink\" href=\"#authorization-with-mod-wsgi-and-django-groups\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>mod_wsgi also provides functionality to restrict a particular location to\nmembers of a group.</p>\n<p>In this case, the Apache configuration should look like this:</p>\n<div class=\"highlight-apache notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">WSGIScriptAlias</span><span class=\"w\"> </span>/<span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"></span>\n\n<span class=\"nb\">WSGIProcessGroup</span><span class=\"w\"> </span>%{GLOBAL}<span class=\"w\"></span>\n<span class=\"nb\">WSGIApplicationGroup</span><span class=\"w\"> </span>%{GLOBAL}<span class=\"w\"></span>\n\n<span class=\"nt\">&lt;Location</span><span class=\"w\"> </span><span class=\"s\">&quot;/secret&quot;</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">AuthType</span><span class=\"w\"> </span>Basic<span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">AuthName</span><span class=\"w\"> </span><span class=\"s2\">&quot;Top Secret&quot;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">AuthBasicProvider</span><span class=\"w\"> </span>wsgi<span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">WSGIAuthUserScript</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">WSGIAuthGroupScript</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">Require</span><span class=\"w\"> </span><span class=\"k\">group</span><span class=\"w\"> </span>secret-agents<span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">Require</span><span class=\"w\"> </span>valid-user<span class=\"w\"></span>\n<span class=\"nt\">&lt;/Location&gt;</span><span class=\"w\"></span>\n</pre></div>\n</div>\n<p>To support the <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIAuthGroupScript</span></code> directive, the same WSGI script\n<code class=\"docutils literal notranslate\"><span class=\"pre\">mysite.wsgi</span></code> must also import the <code class=\"docutils literal notranslate\"><span class=\"pre\">groups_for_user</span></code> function which\nreturns a list groups the given user belongs to.</p>\n<div class=\"highlight-python notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.handlers.modwsgi</span> <span class=\"kn\">import</span> <span class=\"n\">check_password</span><span class=\"p\">,</span> <span class=\"n\">groups_for_user</span>\n</pre></div>\n</div>\n<p>Requests for <code class=\"docutils literal notranslate\"><span class=\"pre\">/secret/</span></code> will now also require user to be a member of the\n\u201csecret-agents\u201d group.</p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["howto/deployment/asgi/index", "How to deploy with ASGI", "N", "next"], ["howto/deployment/wsgi/modwsgi", "How to use Django with Apache and <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code>", "P", "previous"]], "sourcename": "howto/deployment/wsgi/apache-auth.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">How to authenticate against Django\u2019s user database from Apache</a><ul>\n<li><a class=\"reference internal\" href=\"#authentication-with-mod-wsgi\">Authentication with <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code></a><ul>\n<li><a class=\"reference internal\" href=\"#authorization-with-mod-wsgi-and-django-groups\">Authorization with <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code> and Django groups</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "howto/deployment/wsgi/apache-auth", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}