{"parents": [{"link": "../../../", "title": "\u201cHow-to\u201d guides"}, {"link": "../../", "title": "How to deploy Django"}, {"link": "../", "title": "How to deploy with WSGI"}], "prev": {"link": "../uwsgi/", "title": "How to use Django with uWSGI"}, "next": {"link": "../apache-auth/", "title": "How to authenticate against Django\u2019s user database from Apache"}, "title": "How to use Django with Apache and <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code>", "meta": {}, "body": "<div class=\"section\" id=\"s-how-to-use-django-with-apache-and-mod-wsgi\">\n<span id=\"how-to-use-django-with-apache-and-mod-wsgi\"></span><h1>How to use Django with Apache and <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code><a class=\"headerlink\" href=\"#how-to-use-django-with-apache-and-mod-wsgi\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>Deploying Django with <a class=\"reference external\" href=\"https://httpd.apache.org/\">Apache</a> and <a class=\"reference external\" href=\"https://modwsgi.readthedocs.io/en/develop/\">mod_wsgi</a> is a tried and tested way to get\nDjango into production.</p>\n<p>mod_wsgi is an Apache module which can host any Python <a class=\"reference external\" href=\"https://wsgi.readthedocs.io/en/latest/\">WSGI</a> application,\nincluding Django. Django will work with any version of Apache which supports\nmod_wsgi.</p>\n<p>The <a class=\"reference external\" href=\"https://modwsgi.readthedocs.io/\">official mod_wsgi documentation</a> is your source for all the details about\nhow to use mod_wsgi. You\u2019ll probably want to start with the <a class=\"reference external\" href=\"https://modwsgi.readthedocs.io/en/develop/installation.html\">installation and\nconfiguration documentation</a>.</p>\n<div class=\"section\" id=\"s-basic-configuration\">\n<span id=\"basic-configuration\"></span><h2>Basic configuration<a class=\"headerlink\" href=\"#basic-configuration\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Once you\u2019ve got mod_wsgi installed and activated, edit your Apache server\u2019s\n<a class=\"reference external\" href=\"https://cwiki.apache.org/confluence/display/httpd/DistrosDefaultLayout\">httpd.conf</a> file and add the following.</p>\n<div class=\"highlight-apache notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">WSGIScriptAlias</span><span class=\"w\"> </span>/<span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"></span>\n<span class=\"nb\">WSGIPythonHome</span><span class=\"w\"> </span><span class=\"sx\">/path/to/venv</span><span class=\"w\"></span>\n<span class=\"nb\">WSGIPythonPath</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com</span><span class=\"w\"></span>\n\n<span class=\"nt\">&lt;Directory</span><span class=\"w\"> </span><span class=\"s\">/path/to/mysite.com/mysite</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"nt\">&lt;Files</span><span class=\"w\"> </span><span class=\"s\">wsgi.py</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"nb\">Require</span><span class=\"w\"> </span><span class=\"k\">all</span><span class=\"w\"> </span>granted<span class=\"w\"></span>\n<span class=\"nt\">&lt;/Files&gt;</span><span class=\"w\"></span>\n<span class=\"nt\">&lt;/Directory&gt;</span><span class=\"w\"></span>\n</pre></div>\n</div>\n<p>The first bit in the <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIScriptAlias</span></code> line is the base URL path you want to\nserve your application at (<code class=\"docutils literal notranslate\"><span class=\"pre\">/</span></code> indicates the root url), and the second is the\nlocation of a \u201cWSGI file\u201d \u2013 see below \u2013 on your system, usually inside of\nyour project package (<code class=\"docutils literal notranslate\"><span class=\"pre\">mysite</span></code> in this example). This tells Apache to serve\nany request below the given URL using the WSGI application defined in that\nfile.</p>\n<p>If you install your project\u2019s Python dependencies inside a <a class=\"reference external\" href=\"https://docs.python.org/3/library/venv.html#module-venv\" title=\"(in Python v3.11)\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">virtual</span>\n<span class=\"pre\">environment</span></code></a>, add the path using <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIPythonHome</span></code>. See the <a class=\"reference external\" href=\"https://modwsgi.readthedocs.io/en/develop/user-guides/virtual-environments.html\">mod_wsgi\nvirtual environment guide</a> for more details.</p>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIPythonPath</span></code> line ensures that your project package is available for\nimport on the Python path; in other words, that <code class=\"docutils literal notranslate\"><span class=\"pre\">import</span> <span class=\"pre\">mysite</span></code> works.</p>\n<p>The <code class=\"docutils literal notranslate\"><span class=\"pre\">&lt;Directory&gt;</span></code> piece ensures that Apache can access your <code class=\"file docutils literal notranslate\"><span class=\"pre\">wsgi.py</span></code>\nfile.</p>\n<p>Next we\u2019ll need to ensure this <code class=\"file docutils literal notranslate\"><span class=\"pre\">wsgi.py</span></code> with a WSGI application object\nexists. As of Django version 1.4, <a class=\"reference internal\" href=\"../../../../ref/django-admin/#django-admin-startproject\"><code class=\"xref std std-djadmin docutils literal notranslate\"><span class=\"pre\">startproject</span></code></a> will have created one\nfor you; otherwise, you\u2019ll need to create it. See the <a class=\"reference internal\" href=\"../\"><span class=\"doc\">WSGI overview\ndocumentation</span></a> for the default contents you\nshould put in this file, and what else you can add to it.</p>\n<div class=\"admonition warning\">\n<p class=\"first admonition-title\">Warning</p>\n<p>If multiple Django sites are run in a single mod_wsgi process, all of them\nwill use the settings of whichever one happens to run first. This can be\nsolved by changing:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"o\">.</span><span class=\"n\">setdefault</span><span class=\"p\">(</span><span class=\"s2\">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;{{ project_name }}.settings&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>in <code class=\"docutils literal notranslate\"><span class=\"pre\">wsgi.py</span></code>, to:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">os</span><span class=\"o\">.</span><span class=\"n\">environ</span><span class=\"p\">[</span><span class=\"s2\">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;{{ project_name }}.settings&quot;</span>\n</pre></div>\n</div>\n<p class=\"last\">or by <a class=\"reference internal\" href=\"#daemon-mode\"><span class=\"std std-ref\">using mod_wsgi daemon mode</span></a> and ensuring that each\nsite runs in its own daemon process.</p>\n</div>\n<div class=\"admonition-fixing-unicodeencodeerror-for-file-uploads admonition\">\n<p class=\"first admonition-title\">Fixing <code class=\"docutils literal notranslate\"><span class=\"pre\">UnicodeEncodeError</span></code> for file uploads</p>\n<p>If you get a <code class=\"docutils literal notranslate\"><span class=\"pre\">UnicodeEncodeError</span></code> when uploading or writing files with\nfile names or content that contains non-ASCII characters, make sure Apache\nis configured to support UTF-8 encoding:</p>\n<div class=\"highlight-shell notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">export</span> <span class=\"nv\">LANG</span><span class=\"o\">=</span><span class=\"s1\">&#39;en_US.UTF-8&#39;</span>\n<span class=\"nb\">export</span> <span class=\"nv\">LC_ALL</span><span class=\"o\">=</span><span class=\"s1\">&#39;en_US.UTF-8&#39;</span>\n</pre></div>\n</div>\n<p>A common location to put this configuration is <code class=\"docutils literal notranslate\"><span class=\"pre\">/etc/apache2/envvars</span></code>.</p>\n<p>Alternatively, if you are <a class=\"reference internal\" href=\"#daemon-mode\"><span class=\"std std-ref\">using mod_wsgi daemon mode</span></a>\nyou can add <code class=\"docutils literal notranslate\"><span class=\"pre\">lang</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">locale</span></code> options to the <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIDaemonProcess</span></code>\ndirective:</p>\n<div class=\"highlight-text notranslate\"><div class=\"highlight\"><pre><span></span>WSGIDaemonProcess example.com lang=&#39;en_US.UTF-8&#39; locale=&#39;en_US.UTF-8&#39;\n</pre></div>\n</div>\n<p class=\"last\">See the <a class=\"reference internal\" href=\"../../../../ref/unicode/#unicode-files\"><span class=\"std std-ref\">Files</span></a> section of the Unicode reference guide for\ndetails.</p>\n</div>\n</div>\n<div class=\"section\" id=\"s-using-mod-wsgi-daemon-mode\">\n<span id=\"s-daemon-mode\"></span><span id=\"using-mod-wsgi-daemon-mode\"></span><span id=\"daemon-mode\"></span><h2>Using <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code> daemon mode<a class=\"headerlink\" href=\"#using-mod-wsgi-daemon-mode\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>\u201cDaemon mode\u201d is the recommended mode for running mod_wsgi (on non-Windows\nplatforms). To create the required daemon process group and delegate the\nDjango instance to run in it, you will need to add appropriate\n<code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIDaemonProcess</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIProcessGroup</span></code> directives. A further change\nrequired to the above configuration if you use daemon mode is that you can\u2019t\nuse <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIPythonPath</span></code>; instead you should use the <code class=\"docutils literal notranslate\"><span class=\"pre\">python-path</span></code> option to\n<code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIDaemonProcess</span></code>, for example:</p>\n<div class=\"highlight-apache notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">WSGIDaemonProcess</span><span class=\"w\"> </span>example.com<span class=\"w\"> </span>python-home=/path/to/venv<span class=\"w\"> </span>python-path=/path/to/mysite.com<span class=\"w\"></span>\n<span class=\"nb\">WSGIProcessGroup</span><span class=\"w\"> </span>example.com<span class=\"w\"></span>\n</pre></div>\n</div>\n<p>If you want to serve your project in a subdirectory\n(<code class=\"docutils literal notranslate\"><span class=\"pre\">https://example.com/mysite</span></code> in this example), you can add <code class=\"docutils literal notranslate\"><span class=\"pre\">WSGIScriptAlias</span></code>\nto the configuration above:</p>\n<div class=\"highlight-apache notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">WSGIScriptAlias</span><span class=\"w\"> </span><span class=\"sx\">/mysite</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"> </span>process-group=example.com<span class=\"w\"></span>\n</pre></div>\n</div>\n<p>See the official mod_wsgi documentation for <a class=\"reference external\" href=\"https://modwsgi.readthedocs.io/en/develop/user-guides/quick-configuration-guide.html#delegation-to-daemon-process\">details on setting up daemon\nmode</a>.</p>\n</div>\n<div class=\"section\" id=\"s-serving-files\">\n<span id=\"s-id1\"></span><span id=\"serving-files\"></span><span id=\"id1\"></span><h2>Serving files<a class=\"headerlink\" href=\"#serving-files\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Django doesn\u2019t serve files itself; it leaves that job to whichever web\nserver you choose.</p>\n<p>We recommend using a separate web server \u2013 i.e., one that\u2019s not also running\nDjango \u2013 for serving media. Here are some good choices:</p>\n<ul class=\"simple\">\n<li><a class=\"reference external\" href=\"https://nginx.org/en/\">Nginx</a></li>\n<li>A stripped-down version of <a class=\"reference external\" href=\"https://httpd.apache.org/\">Apache</a></li>\n</ul>\n<p>If, however, you have no option but to serve media files on the same Apache\n<code class=\"docutils literal notranslate\"><span class=\"pre\">VirtualHost</span></code> as Django, you can set up Apache to serve some URLs as\nstatic media, and others using the mod_wsgi interface to Django.</p>\n<p>This example sets up Django at the site root, but serves <code class=\"docutils literal notranslate\"><span class=\"pre\">robots.txt</span></code>,\n<code class=\"docutils literal notranslate\"><span class=\"pre\">favicon.ico</span></code>, and anything in the <code class=\"docutils literal notranslate\"><span class=\"pre\">/static/</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">/media/</span></code> URL space as\na static file. All other URLs will be served using mod_wsgi:</p>\n<div class=\"highlight-apache notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">Alias</span><span class=\"w\"> </span><span class=\"sx\">/robots.txt</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/static/robots.txt</span><span class=\"w\"></span>\n<span class=\"nb\">Alias</span><span class=\"w\"> </span><span class=\"sx\">/favicon.ico</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/static/favicon.ico</span><span class=\"w\"></span>\n\n<span class=\"nb\">Alias</span><span class=\"w\"> </span><span class=\"sx\">/media/</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/media/</span><span class=\"w\"></span>\n<span class=\"nb\">Alias</span><span class=\"w\"> </span><span class=\"sx\">/static/</span><span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/static/</span><span class=\"w\"></span>\n\n<span class=\"nt\">&lt;Directory</span><span class=\"w\"> </span><span class=\"s\">/path/to/mysite.com/static</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"nb\">Require</span><span class=\"w\"> </span><span class=\"k\">all</span><span class=\"w\"> </span>granted<span class=\"w\"></span>\n<span class=\"nt\">&lt;/Directory&gt;</span><span class=\"w\"></span>\n\n<span class=\"nt\">&lt;Directory</span><span class=\"w\"> </span><span class=\"s\">/path/to/mysite.com/media</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"nb\">Require</span><span class=\"w\"> </span><span class=\"k\">all</span><span class=\"w\"> </span>granted<span class=\"w\"></span>\n<span class=\"nt\">&lt;/Directory&gt;</span><span class=\"w\"></span>\n\n<span class=\"nb\">WSGIScriptAlias</span><span class=\"w\"> </span>/<span class=\"w\"> </span><span class=\"sx\">/path/to/mysite.com/mysite/wsgi.py</span><span class=\"w\"></span>\n\n<span class=\"nt\">&lt;Directory</span><span class=\"w\"> </span><span class=\"s\">/path/to/mysite.com/mysite</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"nt\">&lt;Files</span><span class=\"w\"> </span><span class=\"s\">wsgi.py</span><span class=\"nt\">&gt;</span><span class=\"w\"></span>\n<span class=\"nb\">Require</span><span class=\"w\"> </span><span class=\"k\">all</span><span class=\"w\"> </span>granted<span class=\"w\"></span>\n<span class=\"nt\">&lt;/Files&gt;</span><span class=\"w\"></span>\n<span class=\"nt\">&lt;/Directory&gt;</span><span class=\"w\"></span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"s-serving-the-admin-files\">\n<span id=\"s-id3\"></span><span id=\"serving-the-admin-files\"></span><span id=\"id3\"></span><h2>Serving the admin files<a class=\"headerlink\" href=\"#serving-the-admin-files\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>When <a class=\"reference internal\" href=\"../../../../ref/contrib/staticfiles/#module-django.contrib.staticfiles\" title=\"django.contrib.staticfiles: An app for handling static files.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">django.contrib.staticfiles</span></code></a> is in <a class=\"reference internal\" href=\"../../../../ref/settings/#std-setting-INSTALLED_APPS\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">INSTALLED_APPS</span></code></a>, the\nDjango development server automatically serves the static files of the\nadmin app (and any other installed apps). This is however not the case when you\nuse any other server arrangement. You\u2019re responsible for setting up Apache, or\nwhichever web server you\u2019re using, to serve the admin files.</p>\n<p>The admin files live in (<a class=\"reference external\" href=\"https://github.com/django/django/blob/main/django/contrib/admin/static/admin\">django/contrib/admin/static/admin</a>) of the\nDjango distribution.</p>\n<p>We <strong>strongly</strong> recommend using <a class=\"reference internal\" href=\"../../../../ref/contrib/staticfiles/#module-django.contrib.staticfiles\" title=\"django.contrib.staticfiles: An app for handling static files.\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">django.contrib.staticfiles</span></code></a> to handle the\nadmin files (along with a web server as outlined in the previous section; this\nmeans using the <a class=\"reference internal\" href=\"../../../../ref/contrib/staticfiles/#django-admin-collectstatic\"><code class=\"xref std std-djadmin docutils literal notranslate\"><span class=\"pre\">collectstatic</span></code></a> management command to collect the\nstatic files in <a class=\"reference internal\" href=\"../../../../ref/settings/#std-setting-STATIC_ROOT\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">STATIC_ROOT</span></code></a>, and then configuring your web server to\nserve <a class=\"reference internal\" href=\"../../../../ref/settings/#std-setting-STATIC_ROOT\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">STATIC_ROOT</span></code></a> at <a class=\"reference internal\" href=\"../../../../ref/settings/#std-setting-STATIC_URL\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">STATIC_URL</span></code></a>), but here are three\nother approaches:</p>\n<ol class=\"arabic simple\">\n<li>Create a symbolic link to the admin static files from within your\ndocument root (this may require <code class=\"docutils literal notranslate\"><span class=\"pre\">+FollowSymLinks</span></code> in your Apache\nconfiguration).</li>\n<li>Use an <code class=\"docutils literal notranslate\"><span class=\"pre\">Alias</span></code> directive, as demonstrated above, to alias the appropriate\nURL (probably <a class=\"reference internal\" href=\"../../../../ref/settings/#std-setting-STATIC_URL\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">STATIC_URL</span></code></a> + <code class=\"docutils literal notranslate\"><span class=\"pre\">admin/</span></code>) to the actual location of\nthe admin files.</li>\n<li>Copy the admin static files so that they live within your Apache\ndocument root.</li>\n</ol>\n</div>\n<div class=\"section\" id=\"s-authenticating-against-django-s-user-database-from-apache\">\n<span id=\"authenticating-against-django-s-user-database-from-apache\"></span><h2>Authenticating against Django\u2019s user database from Apache<a class=\"headerlink\" href=\"#authenticating-against-django-s-user-database-from-apache\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Django provides a handler to allow Apache to authenticate users directly\nagainst Django\u2019s authentication backends. See the <a class=\"reference internal\" href=\"../apache-auth/\"><span class=\"doc\">mod_wsgi authentication\ndocumentation</span></a>.</p>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["howto/deployment/wsgi/apache-auth", "How to authenticate against Django\u2019s user database from Apache", "N", "next"], ["howto/deployment/wsgi/uwsgi", "How to use Django with uWSGI", "P", "previous"]], "sourcename": "howto/deployment/wsgi/modwsgi.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">How to use Django with Apache and <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code></a><ul>\n<li><a class=\"reference internal\" href=\"#basic-configuration\">Basic configuration</a></li>\n<li><a class=\"reference internal\" href=\"#using-mod-wsgi-daemon-mode\">Using <code class=\"docutils literal notranslate\"><span class=\"pre\">mod_wsgi</span></code> daemon mode</a></li>\n<li><a class=\"reference internal\" href=\"#serving-files\">Serving files</a></li>\n<li><a class=\"reference internal\" href=\"#serving-the-admin-files\">Serving the admin files</a></li>\n<li><a class=\"reference internal\" href=\"#authenticating-against-django-s-user-database-from-apache\">Authenticating against Django\u2019s user database from Apache</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "howto/deployment/wsgi/modwsgi", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}
