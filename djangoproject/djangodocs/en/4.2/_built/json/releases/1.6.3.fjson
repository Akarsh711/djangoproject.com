{"parents": [{"link": "../", "title": "Release notes"}], "prev": {"link": "../1.6.4/", "title": "Django 1.6.4 release notes"}, "next": {"link": "../1.6.2/", "title": "Django 1.6.2 release notes"}, "title": "Django 1.6.3 release notes", "meta": {}, "body": "<div class=\"section\" id=\"s-django-1-6-3-release-notes\">\n<span id=\"django-1-6-3-release-notes\"></span><h1>Django 1.6.3 release notes<a class=\"headerlink\" href=\"#django-1-6-3-release-notes\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p><em>April 21, 2014</em></p>\n<p>Django 1.6.3 fixes several bugs in 1.6.2, including three security issues,\nand makes one backwards-incompatible change:</p>\n<div class=\"section\" id=\"s-unexpected-code-execution-using-reverse\">\n<span id=\"unexpected-code-execution-using-reverse\"></span><h2>Unexpected code execution using <code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code><a class=\"headerlink\" href=\"#unexpected-code-execution-using-reverse\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Django\u2019s URL handling is based on a mapping of regex patterns\n(representing the URLs) to callable views, and Django\u2019s own processing\nconsists of matching a requested URL against those patterns to\ndetermine the appropriate view to invoke.</p>\n<p>Django also provides a convenience function \u2013 <code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code> \u2013 which performs\nthis process in the opposite direction. The <code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code> function takes\ninformation about a view and returns a URL which would invoke that view. Use\nof <code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code> is encouraged for application developers, as the output of\n<code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code> is always based on the current URL patterns, meaning developers\ndo not need to change other code when making changes to URLs.</p>\n<p>One argument signature for <code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code> is to pass a dotted Python\npath to the desired view. In this situation, Django will import the\nmodule indicated by that dotted path as part of generating the\nresulting URL. If such a module has import-time side effects, those\nside effects will occur.</p>\n<p>Thus it is possible for an attacker to cause unexpected code\nexecution, given the following conditions:</p>\n<ol class=\"arabic simple\">\n<li>One or more views are present which construct a URL based on user\ninput (commonly, a \u201cnext\u201d parameter in a querystring indicating\nwhere to redirect upon successful completion of an action).</li>\n<li>One or more modules are known to an attacker to exist on the\nserver\u2019s Python import path, which perform code execution with side\neffects on importing.</li>\n</ol>\n<p>To remedy this, <code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code> will now only accept and import dotted\npaths based on the view-containing modules listed in the project\u2019s <a class=\"reference internal\" href=\"../../topics/http/urls/\"><span class=\"doc\">URL\npattern configuration</span></a>, so as to ensure that only modules\nthe developer intended to be imported in this fashion can or will be imported.</p>\n</div>\n<div class=\"section\" id=\"s-caching-of-anonymous-pages-could-reveal-csrf-token\">\n<span id=\"caching-of-anonymous-pages-could-reveal-csrf-token\"></span><h2>Caching of anonymous pages could reveal CSRF token<a class=\"headerlink\" href=\"#caching-of-anonymous-pages-could-reveal-csrf-token\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Django includes both a <a class=\"reference internal\" href=\"../../topics/cache/\"><span class=\"doc\">caching framework</span></a> and a system\nfor <a class=\"reference internal\" href=\"../../ref/csrf/\"><span class=\"doc\">preventing cross-site request forgery (CSRF) attacks</span></a>. The CSRF-protection system is based on a random nonce\nsent to the client in a cookie which must be sent by the client on future\nrequests and, in forms, a hidden value which must be submitted back with the\nform.</p>\n<p>The caching framework includes an option to cache responses to\nanonymous (i.e., unauthenticated) clients.</p>\n<p>When the first anonymous request to a given page is by a client which\ndid not have a CSRF cookie, the cache framework will also cache the\nCSRF cookie and serve the same nonce to other anonymous clients who\ndo not have a CSRF cookie. This can allow an attacker to obtain a\nvalid CSRF cookie value and perform attacks which bypass the check for\nthe cookie.</p>\n<p>To remedy this, the caching framework will no longer cache such\nresponses. The heuristic for this will be:</p>\n<ol class=\"arabic simple\">\n<li>If the incoming request did not submit any cookies, and</li>\n<li>If the response did send one or more cookies, and</li>\n<li>If the <code class=\"docutils literal notranslate\"><span class=\"pre\">Vary:</span> <span class=\"pre\">Cookie</span></code> header is set on the response, then the\nresponse will not be cached.</li>\n</ol>\n</div>\n<div class=\"section\" id=\"s-mysql-typecasting\">\n<span id=\"mysql-typecasting\"></span><h2>MySQL typecasting<a class=\"headerlink\" href=\"#mysql-typecasting\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>The MySQL database is known to \u201ctypecast\u201d on certain queries; for\nexample, when querying a table which contains string values, but using\na query which filters based on an integer value, MySQL will first\nsilently coerce the strings to integers and return a result based on that.</p>\n<p>If a query is performed without first converting values to the\nappropriate type, this can produce unexpected results, similar to what\nwould occur if the query itself had been manipulated.</p>\n<p>Django\u2019s model field classes are aware of their own types and most\nsuch classes perform explicit conversion of query arguments to the\ncorrect database-level type before querying. However, three model\nfield classes did not correctly convert their arguments:</p>\n<ul class=\"simple\">\n<li><a class=\"reference internal\" href=\"../../ref/models/fields/#django.db.models.FilePathField\" title=\"django.db.models.FilePathField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">FilePathField</span></code></a></li>\n<li><a class=\"reference internal\" href=\"../../ref/models/fields/#django.db.models.GenericIPAddressField\" title=\"django.db.models.GenericIPAddressField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">GenericIPAddressField</span></code></a></li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">IPAddressField</span></code></li>\n</ul>\n<p>These three fields have been updated to convert their arguments to the\ncorrect types before querying.</p>\n<p>Additionally, developers of custom model fields are now warned via\ndocumentation to ensure their custom field classes will perform\nappropriate type conversions, and users of the <a class=\"reference internal\" href=\"../../ref/models/querysets/#django.db.models.query.QuerySet.raw\" title=\"django.db.models.query.QuerySet.raw\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">raw()</span></code></a> and <a class=\"reference internal\" href=\"../../ref/models/querysets/#django.db.models.query.QuerySet.extra\" title=\"django.db.models.query.QuerySet.extra\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">extra()</span></code></a> query methods \u2013 which allow the\ndeveloper to supply raw SQL or SQL fragments \u2013 will be advised to ensure they\nperform appropriate manual type conversions prior to executing queries.</p>\n</div>\n<div class=\"section\" id=\"s-select-for-update-requires-a-transaction\">\n<span id=\"select-for-update-requires-a-transaction\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">select_for_update()</span></code> requires a transaction<a class=\"headerlink\" href=\"#select-for-update-requires-a-transaction\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Historically, queries that use\n<a class=\"reference internal\" href=\"../../ref/models/querysets/#django.db.models.query.QuerySet.select_for_update\" title=\"django.db.models.query.QuerySet.select_for_update\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">select_for_update()</span></code></a> could be\nexecuted in autocommit mode, outside of a transaction. Before Django\n1.6, Django\u2019s automatic transactions mode allowed this to be used to\nlock records until the next write operation. Django 1.6 introduced\ndatabase-level autocommit; since then, execution in such a context\nvoids the effect of <code class=\"docutils literal notranslate\"><span class=\"pre\">select_for_update()</span></code>. It is, therefore, assumed\nnow to be an error and raises an exception.</p>\n<p>This change was made because such errors can be caused by including an\napp which expects global transactions (e.g. <a class=\"reference internal\" href=\"../../ref/settings/#std-setting-DATABASE-ATOMIC_REQUESTS\"><code class=\"xref std std-setting docutils literal notranslate\"><span class=\"pre\">ATOMIC_REQUESTS</span></code></a> set to <code class=\"docutils literal notranslate\"><span class=\"pre\">True</span></code>), or Django\u2019s old autocommit\nbehavior, in a project which runs without them; and further, such\nerrors may manifest as data-corruption bugs.</p>\n<p>This change may cause test failures if you use <code class=\"docutils literal notranslate\"><span class=\"pre\">select_for_update()</span></code>\nin a test class which is a subclass of\n<a class=\"reference internal\" href=\"../../topics/testing/tools/#django.test.TransactionTestCase\" title=\"django.test.TransactionTestCase\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TransactionTestCase</span></code></a> rather than\n<a class=\"reference internal\" href=\"../../topics/testing/tools/#django.test.TestCase\" title=\"django.test.TestCase\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TestCase</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-other-bugfixes-and-changes\">\n<span id=\"other-bugfixes-and-changes\"></span><h2>Other bugfixes and changes<a class=\"headerlink\" href=\"#other-bugfixes-and-changes\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<ul class=\"simple\">\n<li>Content retrieved from the GeoIP library is now properly decoded from its\ndefault <code class=\"docutils literal notranslate\"><span class=\"pre\">iso-8859-1</span></code> encoding\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/21996\">#21996</a>).</li>\n<li>Fixed <code class=\"docutils literal notranslate\"><span class=\"pre\">AttributeError</span></code> when using\n<a class=\"reference internal\" href=\"../../ref/models/querysets/#django.db.models.query.QuerySet.bulk_create\" title=\"django.db.models.query.QuerySet.bulk_create\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">bulk_create()</span></code></a> with <code class=\"docutils literal notranslate\"><span class=\"pre\">ForeignObject</span></code>\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/21566\">#21566</a>).</li>\n<li>Fixed crash of <code class=\"docutils literal notranslate\"><span class=\"pre\">QuerySet</span></code>s that use <code class=\"docutils literal notranslate\"><span class=\"pre\">F()</span> <span class=\"pre\">+</span> <span class=\"pre\">timedelta()</span></code> when their query\nwas compiled more once\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/21643\">#21643</a>).</li>\n<li>Prevented custom <code class=\"docutils literal notranslate\"><span class=\"pre\">widget</span></code> class attribute of\n<a class=\"reference internal\" href=\"../../ref/forms/fields/#django.forms.IntegerField\" title=\"django.forms.IntegerField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">IntegerField</span></code></a> subclasses from being overwritten by the\ncode in their <code class=\"docutils literal notranslate\"><span class=\"pre\">__init__</span></code> method\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/22245\">#22245</a>).</li>\n<li>Improved <a class=\"reference internal\" href=\"../../ref/utils/#django.utils.html.strip_tags\" title=\"django.utils.html.strip_tags\"><code class=\"xref py py-func docutils literal notranslate\"><span class=\"pre\">strip_tags()</span></code></a> accuracy (but it still cannot\nguarantee an HTML-safe result, as stated in the documentation).</li>\n<li>Fixed a regression in the <a class=\"reference internal\" href=\"../../ref/contrib/gis/#module-django.contrib.gis\" title=\"django.contrib.gis: Geographic Information System (GIS) extensions for Django\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">django.contrib.gis</span></code></a> SQL compiler for\nnon-concrete fields (<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/22250\">#22250</a>).</li>\n<li>Fixed <a class=\"reference internal\" href=\"../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.preserve_filters\" title=\"django.contrib.admin.ModelAdmin.preserve_filters\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">ModelAdmin.preserve_filters</span></code></a> when running a site with\na URL prefix (<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/21795\">#21795</a>).</li>\n<li>Fixed a crash in the <code class=\"docutils literal notranslate\"><span class=\"pre\">find_command</span></code> management utility when the <code class=\"docutils literal notranslate\"><span class=\"pre\">PATH</span></code>\nenvironment variable wasn\u2019t set\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/22256\">#22256</a>).</li>\n<li>Fixed <a class=\"reference internal\" href=\"../../ref/django-admin/#django-admin-changepassword\"><code class=\"xref std std-djadmin docutils literal notranslate\"><span class=\"pre\">changepassword</span></code></a> on Windows\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/22364\">#22364</a>).</li>\n<li>Avoided shadowing deadlock exceptions on MySQL\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/22291\">#22291</a>).</li>\n<li>Wrapped database exceptions in <code class=\"docutils literal notranslate\"><span class=\"pre\">_set_autocommit</span></code>\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/22321\">#22321</a>).</li>\n<li>Fixed atomicity when closing a database connection or when the database server\ndisconnects (<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/21239\">#21239</a> and <a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/21202\">#21202</a>)</li>\n<li>Fixed regression in <code class=\"docutils literal notranslate\"><span class=\"pre\">prefetch_related</span></code> that caused the related objects\nquery to include an unnecessary join\n(<a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/21760\">#21760</a>).</li>\n</ul>\n<p>Additionally, Django\u2019s vendored version of six, <code class=\"docutils literal notranslate\"><span class=\"pre\">django.utils.six</span></code> has been\nupgraded to the latest release (1.6.1).</p>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["releases/1.6.2", "Django 1.6.2 release notes", "N", "next"], ["releases/1.6.4", "Django 1.6.4 release notes", "P", "previous"]], "sourcename": "releases/1.6.3.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Django 1.6.3 release notes</a><ul>\n<li><a class=\"reference internal\" href=\"#unexpected-code-execution-using-reverse\">Unexpected code execution using <code class=\"docutils literal notranslate\"><span class=\"pre\">reverse()</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#caching-of-anonymous-pages-could-reveal-csrf-token\">Caching of anonymous pages could reveal CSRF token</a></li>\n<li><a class=\"reference internal\" href=\"#mysql-typecasting\">MySQL typecasting</a></li>\n<li><a class=\"reference internal\" href=\"#select-for-update-requires-a-transaction\"><code class=\"docutils literal notranslate\"><span class=\"pre\">select_for_update()</span></code> requires a transaction</a></li>\n<li><a class=\"reference internal\" href=\"#other-bugfixes-and-changes\">Other bugfixes and changes</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "releases/1.6.3", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}