{"parents": [{"link": "../../../../", "title": "Module code"}, {"link": "../../../", "title": "django"}, {"link": "../", "title": "django.contrib.admin"}], "title": "django.contrib.admin.options", "body": "<h1>Source code for django.contrib.admin.options</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">import</span> <span class=\"nn\">copy</span>\n<span class=\"kn\">import</span> <span class=\"nn\">enum</span>\n<span class=\"kn\">import</span> <span class=\"nn\">json</span>\n<span class=\"kn\">import</span> <span class=\"nn\">re</span>\n<span class=\"kn\">from</span> <span class=\"nn\">functools</span> <span class=\"kn\">import</span> <span class=\"n\">partial</span><span class=\"p\">,</span> <span class=\"n\">update_wrapper</span>\n<span class=\"kn\">from</span> <span class=\"nn\">urllib.parse</span> <span class=\"kn\">import</span> <span class=\"n\">quote</span> <span class=\"k\">as</span> <span class=\"n\">urlquote</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django</span> <span class=\"kn\">import</span> <span class=\"n\">forms</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.conf</span> <span class=\"kn\">import</span> <span class=\"n\">settings</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib</span> <span class=\"kn\">import</span> <span class=\"n\">messages</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin</span> <span class=\"kn\">import</span> <span class=\"n\">helpers</span><span class=\"p\">,</span> <span class=\"n\">widgets</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.checks</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">BaseModelAdminChecks</span><span class=\"p\">,</span>\n    <span class=\"n\">InlineModelAdminChecks</span><span class=\"p\">,</span>\n    <span class=\"n\">ModelAdminChecks</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.exceptions</span> <span class=\"kn\">import</span> <span class=\"n\">DisallowedModelAdminToField</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.templatetags.admin_urls</span> <span class=\"kn\">import</span> <span class=\"n\">add_preserved_filters</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.utils</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">NestedObjects</span><span class=\"p\">,</span>\n    <span class=\"n\">construct_change_message</span><span class=\"p\">,</span>\n    <span class=\"n\">flatten_fieldsets</span><span class=\"p\">,</span>\n    <span class=\"n\">get_deleted_objects</span><span class=\"p\">,</span>\n    <span class=\"n\">lookup_spawns_duplicates</span><span class=\"p\">,</span>\n    <span class=\"n\">model_format_dict</span><span class=\"p\">,</span>\n    <span class=\"n\">model_ngettext</span><span class=\"p\">,</span>\n    <span class=\"n\">quote</span><span class=\"p\">,</span>\n    <span class=\"n\">unquote</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.widgets</span> <span class=\"kn\">import</span> <span class=\"n\">AutocompleteSelect</span><span class=\"p\">,</span> <span class=\"n\">AutocompleteSelectMultiple</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth</span> <span class=\"kn\">import</span> <span class=\"n\">get_permission_codename</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.exceptions</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">FieldDoesNotExist</span><span class=\"p\">,</span>\n    <span class=\"n\">FieldError</span><span class=\"p\">,</span>\n    <span class=\"n\">PermissionDenied</span><span class=\"p\">,</span>\n    <span class=\"n\">ValidationError</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.paginator</span> <span class=\"kn\">import</span> <span class=\"n\">Paginator</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db</span> <span class=\"kn\">import</span> <span class=\"n\">models</span><span class=\"p\">,</span> <span class=\"n\">router</span><span class=\"p\">,</span> <span class=\"n\">transaction</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models.constants</span> <span class=\"kn\">import</span> <span class=\"n\">LOOKUP_SEP</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.forms.formsets</span> <span class=\"kn\">import</span> <span class=\"n\">DELETION_FIELD_NAME</span><span class=\"p\">,</span> <span class=\"n\">all_valid</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.forms.models</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">BaseInlineFormSet</span><span class=\"p\">,</span>\n    <span class=\"n\">inlineformset_factory</span><span class=\"p\">,</span>\n    <span class=\"n\">modelform_defines_fields</span><span class=\"p\">,</span>\n    <span class=\"n\">modelform_factory</span><span class=\"p\">,</span>\n    <span class=\"n\">modelformset_factory</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.forms.widgets</span> <span class=\"kn\">import</span> <span class=\"n\">CheckboxSelectMultiple</span><span class=\"p\">,</span> <span class=\"n\">SelectMultiple</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.http</span> <span class=\"kn\">import</span> <span class=\"n\">HttpResponseRedirect</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.http.response</span> <span class=\"kn\">import</span> <span class=\"n\">HttpResponseBase</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.template.response</span> <span class=\"kn\">import</span> <span class=\"n\">SimpleTemplateResponse</span><span class=\"p\">,</span> <span class=\"n\">TemplateResponse</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.urls</span> <span class=\"kn\">import</span> <span class=\"n\">reverse</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.decorators</span> <span class=\"kn\">import</span> <span class=\"n\">method_decorator</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.html</span> <span class=\"kn\">import</span> <span class=\"n\">format_html</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.http</span> <span class=\"kn\">import</span> <span class=\"n\">urlencode</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.safestring</span> <span class=\"kn\">import</span> <span class=\"n\">mark_safe</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.text</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">capfirst</span><span class=\"p\">,</span>\n    <span class=\"n\">format_lazy</span><span class=\"p\">,</span>\n    <span class=\"n\">get_text_list</span><span class=\"p\">,</span>\n    <span class=\"n\">smart_split</span><span class=\"p\">,</span>\n    <span class=\"n\">unescape_string_literal</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.translation</span> <span class=\"kn\">import</span> <span class=\"n\">gettext</span> <span class=\"k\">as</span> <span class=\"n\">_</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.translation</span> <span class=\"kn\">import</span> <span class=\"n\">ngettext</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views.decorators.csrf</span> <span class=\"kn\">import</span> <span class=\"n\">csrf_protect</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views.generic</span> <span class=\"kn\">import</span> <span class=\"n\">RedirectView</span>\n\n<span class=\"n\">IS_POPUP_VAR</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;_popup&quot;</span>\n<span class=\"n\">TO_FIELD_VAR</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;_to_field&quot;</span>\n<span class=\"n\">IS_FACETS_VAR</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;_facets&quot;</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">ShowFacets</span><span class=\"p\">(</span><span class=\"n\">enum</span><span class=\"o\">.</span><span class=\"n\">Enum</span><span class=\"p\">):</span>\n    <span class=\"n\">NEVER</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;NEVER&quot;</span>\n    <span class=\"n\">ALLOW</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;ALLOW&quot;</span>\n    <span class=\"n\">ALWAYS</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;ALWAYS&quot;</span>\n\n\n<span class=\"n\">HORIZONTAL</span><span class=\"p\">,</span> <span class=\"n\">VERTICAL</span> <span class=\"o\">=</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">2</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">get_content_type_for_model</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">):</span>\n    <span class=\"c1\"># Since this module gets imported in the application&#39;s root package,</span>\n    <span class=\"c1\"># it cannot import models from other applications at the module level.</span>\n    <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.contenttypes.models</span> <span class=\"kn\">import</span> <span class=\"n\">ContentType</span>\n\n    <span class=\"k\">return</span> <span class=\"n\">ContentType</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">get_for_model</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">for_concrete_model</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">def</span> <span class=\"nf\">get_ul_class</span><span class=\"p\">(</span><span class=\"n\">radio_style</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"s2\">&quot;radiolist&quot;</span> <span class=\"k\">if</span> <span class=\"n\">radio_style</span> <span class=\"o\">==</span> <span class=\"n\">VERTICAL</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;radiolist inline&quot;</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">IncorrectLookupParameters</span><span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<span class=\"c1\"># Defaults for formfield_overrides. ModelAdmin subclasses can change this</span>\n<span class=\"c1\"># by adding to ModelAdmin.formfield_overrides.</span>\n\n<span class=\"n\">FORMFIELD_FOR_DBFIELD_DEFAULTS</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">DateTimeField</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">&quot;form_class&quot;</span><span class=\"p\">:</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">SplitDateTimeField</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminSplitDateTime</span><span class=\"p\">,</span>\n    <span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">DateField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminDateWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">TimeField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminTimeWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">TextField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminTextareaWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">URLField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminURLFieldWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">IntegerField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminIntegerFieldWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">BigIntegerField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminBigIntegerFieldWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CharField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminTextInputWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ImageField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminFileWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">FileField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminFileWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">EmailField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminEmailInputWidget</span><span class=\"p\">},</span>\n    <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">UUIDField</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">:</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminUUIDInputWidget</span><span class=\"p\">},</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">csrf_protect_m</span> <span class=\"o\">=</span> <span class=\"n\">method_decorator</span><span class=\"p\">(</span><span class=\"n\">csrf_protect</span><span class=\"p\">)</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">BaseModelAdmin</span><span class=\"p\">(</span><span class=\"n\">metaclass</span><span class=\"o\">=</span><span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">MediaDefiningClass</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Functionality common to both ModelAdmin and InlineAdmin.&quot;&quot;&quot;</span>\n\n    <span class=\"n\">autocomplete_fields</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">raw_id_fields</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">fields</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">exclude</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">fieldsets</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">ModelForm</span>\n    <span class=\"n\">filter_vertical</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">filter_horizontal</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">radio_fields</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"n\">prepopulated_fields</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"n\">formfield_overrides</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n    <span class=\"n\">readonly_fields</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">ordering</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">sortable_by</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">view_on_site</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">show_full_result_count</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">checks_class</span> <span class=\"o\">=</span> <span class=\"n\">BaseModelAdminChecks</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">check</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">checks_class</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">check</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"c1\"># Merge FORMFIELD_FOR_DBFIELD_DEFAULTS with the formfield_overrides</span>\n        <span class=\"c1\"># rather than simply overwriting.</span>\n        <span class=\"n\">overrides</span> <span class=\"o\">=</span> <span class=\"n\">copy</span><span class=\"o\">.</span><span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"n\">FORMFIELD_FOR_DBFIELD_DEFAULTS</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">v</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_overrides</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"n\">overrides</span><span class=\"o\">.</span><span class=\"n\">setdefault</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"p\">{})</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_overrides</span> <span class=\"o\">=</span> <span class=\"n\">overrides</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">formfield_for_dbfield</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for specifying the form Field instance for a given database Field</span>\n<span class=\"sd\">        instance.</span>\n\n<span class=\"sd\">        If kwargs are given, they&#39;re passed to the form Field&#39;s constructor.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"c1\"># If the field specifies choices, we don&#39;t need to look for special</span>\n        <span class=\"c1\"># admin widgets - we just need to use a select widget of some kind.</span>\n        <span class=\"k\">if</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">choices</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_for_choice_field</span><span class=\"p\">(</span><span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># ForeignKey or ManyToManyFields</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ForeignKey</span><span class=\"p\">,</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ManyToManyField</span><span class=\"p\">)):</span>\n            <span class=\"c1\"># Combine the field kwargs with any options for formfield_overrides.</span>\n            <span class=\"c1\"># Make sure the passed in **kwargs override anything in</span>\n            <span class=\"c1\"># formfield_overrides because **kwargs is more specific, and should</span>\n            <span class=\"c1\"># always win.</span>\n            <span class=\"k\">if</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"vm\">__class__</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_overrides</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_overrides</span><span class=\"p\">[</span><span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"p\">],</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">}</span>\n\n            <span class=\"c1\"># Get the correct formfield.</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ForeignKey</span><span class=\"p\">):</span>\n                <span class=\"n\">formfield</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_for_foreignkey</span><span class=\"p\">(</span><span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ManyToManyField</span><span class=\"p\">):</span>\n                <span class=\"n\">formfield</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_for_manytomany</span><span class=\"p\">(</span><span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n            <span class=\"c1\"># For non-raw_id fields, wrap the widget with a wrapper that adds</span>\n            <span class=\"c1\"># extra HTML -- the &quot;add other&quot; interface -- to the end of the</span>\n            <span class=\"c1\"># rendered output. formfield can be None if it came from a</span>\n            <span class=\"c1\"># OneToOneField with parent_link=True or a M2M intermediary.</span>\n            <span class=\"k\">if</span> <span class=\"n\">formfield</span> <span class=\"ow\">and</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">raw_id_fields</span><span class=\"p\">:</span>\n                <span class=\"n\">related_modeladmin</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span>\n                    <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"o\">.</span><span class=\"n\">model</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">wrapper_kwargs</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n                <span class=\"k\">if</span> <span class=\"n\">related_modeladmin</span><span class=\"p\">:</span>\n                    <span class=\"n\">wrapper_kwargs</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span>\n                        <span class=\"n\">can_add_related</span><span class=\"o\">=</span><span class=\"n\">related_modeladmin</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n                        <span class=\"n\">can_change_related</span><span class=\"o\">=</span><span class=\"n\">related_modeladmin</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span>\n                            <span class=\"n\">request</span>\n                        <span class=\"p\">),</span>\n                        <span class=\"n\">can_delete_related</span><span class=\"o\">=</span><span class=\"n\">related_modeladmin</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span>\n                            <span class=\"n\">request</span>\n                        <span class=\"p\">),</span>\n                        <span class=\"n\">can_view_related</span><span class=\"o\">=</span><span class=\"n\">related_modeladmin</span><span class=\"o\">.</span><span class=\"n\">has_view_permission</span><span class=\"p\">(</span>\n                            <span class=\"n\">request</span>\n                        <span class=\"p\">),</span>\n                    <span class=\"p\">)</span>\n                <span class=\"n\">formfield</span><span class=\"o\">.</span><span class=\"n\">widget</span> <span class=\"o\">=</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">RelatedFieldWidgetWrapper</span><span class=\"p\">(</span>\n                    <span class=\"n\">formfield</span><span class=\"o\">.</span><span class=\"n\">widget</span><span class=\"p\">,</span>\n                    <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"p\">,</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"p\">,</span>\n                    <span class=\"o\">**</span><span class=\"n\">wrapper_kwargs</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n\n            <span class=\"k\">return</span> <span class=\"n\">formfield</span>\n\n        <span class=\"c1\"># If we&#39;ve got overrides for the formfield defined, use &#39;em. **kwargs</span>\n        <span class=\"c1\"># passed to formfield_for_dbfield override the defaults.</span>\n        <span class=\"k\">for</span> <span class=\"n\">klass</span> <span class=\"ow\">in</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"n\">mro</span><span class=\"p\">():</span>\n            <span class=\"k\">if</span> <span class=\"n\">klass</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_overrides</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"o\">**</span><span class=\"n\">copy</span><span class=\"o\">.</span><span class=\"n\">deepcopy</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_overrides</span><span class=\"p\">[</span><span class=\"n\">klass</span><span class=\"p\">]),</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">}</span>\n                <span class=\"k\">return</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">formfield</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># For any other type of field, just call its formfield() method.</span>\n        <span class=\"k\">return</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">formfield</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">formfield_for_choice_field</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Get a form Field for a database Field that has declared choices.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"c1\"># If the field is named as a radio_field, use a RadioSelect</span>\n        <span class=\"k\">if</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">radio_fields</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Avoid stomping on custom widget/choices arguments.</span>\n            <span class=\"k\">if</span> <span class=\"s2\">&quot;widget&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminRadioSelect</span><span class=\"p\">(</span>\n                    <span class=\"n\">attrs</span><span class=\"o\">=</span><span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;class&quot;</span><span class=\"p\">:</span> <span class=\"n\">get_ul_class</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">radio_fields</span><span class=\"p\">[</span><span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">]),</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"s2\">&quot;choices&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;choices&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">get_choices</span><span class=\"p\">(</span>\n                    <span class=\"n\">include_blank</span><span class=\"o\">=</span><span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">blank</span><span class=\"p\">,</span> <span class=\"n\">blank_choice</span><span class=\"o\">=</span><span class=\"p\">[(</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;None&quot;</span><span class=\"p\">))]</span>\n                <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">formfield</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_field_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">db</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        If the ModelAdmin specifies ordering, the queryset should respect that</span>\n<span class=\"sd\">        ordering.  Otherwise don&#39;t specify the queryset, let the field decide</span>\n<span class=\"sd\">        (return None in that case).</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">related_admin</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">related_admin</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">ordering</span> <span class=\"o\">=</span> <span class=\"n\">related_admin</span><span class=\"o\">.</span><span class=\"n\">get_ordering</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">ordering</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"n\">ordering</span> <span class=\"o\">!=</span> <span class=\"p\">():</span>\n                <span class=\"k\">return</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_default_manager</span><span class=\"o\">.</span><span class=\"n\">using</span><span class=\"p\">(</span><span class=\"n\">db</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span>\n                    <span class=\"o\">*</span><span class=\"n\">ordering</span>\n                <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">formfield_for_foreignkey</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Get a form Field for a ForeignKey.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">db</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;using&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;widget&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_autocomplete_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">AutocompleteSelect</span><span class=\"p\">(</span>\n                    <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"p\">,</span> <span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">db</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">raw_id_fields</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">ForeignKeyRawIdWidget</span><span class=\"p\">(</span>\n                    <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"p\">,</span> <span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">db</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">radio_fields</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">AdminRadioSelect</span><span class=\"p\">(</span>\n                    <span class=\"n\">attrs</span><span class=\"o\">=</span><span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;class&quot;</span><span class=\"p\">:</span> <span class=\"n\">get_ul_class</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">radio_fields</span><span class=\"p\">[</span><span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">]),</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;empty_label&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                    <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;empty_label&quot;</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;None&quot;</span><span class=\"p\">))</span> <span class=\"k\">if</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">blank</span> <span class=\"k\">else</span> <span class=\"kc\">None</span>\n                <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;queryset&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_field_queryset</span><span class=\"p\">(</span><span class=\"n\">db</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">queryset</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;queryset&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">formfield</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">formfield_for_manytomany</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Get a form Field for a ManyToManyField.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"c1\"># If it uses an intermediary model that isn&#39;t auto created, don&#39;t show</span>\n        <span class=\"c1\"># a field in admin.</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"o\">.</span><span class=\"n\">through</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">auto_created</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n        <span class=\"n\">db</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;using&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;widget&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">autocomplete_fields</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_autocomplete_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">autocomplete_fields</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">AutocompleteSelectMultiple</span><span class=\"p\">(</span>\n                    <span class=\"n\">db_field</span><span class=\"p\">,</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"p\">,</span>\n                    <span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">db</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">raw_id_fields</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">ManyToManyRawIdWidget</span><span class=\"p\">(</span>\n                    <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"p\">,</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"p\">,</span>\n                    <span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">db</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"p\">[</span><span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter_vertical</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter_horizontal</span><span class=\"p\">]:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;widget&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">FilteredSelectMultiple</span><span class=\"p\">(</span>\n                    <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter_vertical</span>\n                <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;queryset&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_field_queryset</span><span class=\"p\">(</span><span class=\"n\">db</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">queryset</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;queryset&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span>\n\n        <span class=\"n\">form_field</span> <span class=\"o\">=</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">formfield</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">form_field</span><span class=\"o\">.</span><span class=\"n\">widget</span><span class=\"p\">,</span> <span class=\"n\">SelectMultiple</span><span class=\"p\">)</span>\n            <span class=\"ow\">and</span> <span class=\"n\">form_field</span><span class=\"o\">.</span><span class=\"n\">widget</span><span class=\"o\">.</span><span class=\"n\">allow_multiple_selected</span>\n            <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span>\n                <span class=\"n\">form_field</span><span class=\"o\">.</span><span class=\"n\">widget</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">CheckboxSelectMultiple</span><span class=\"p\">,</span> <span class=\"n\">AutocompleteSelectMultiple</span><span class=\"p\">)</span>\n            <span class=\"p\">)</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;Hold down \u201cControl\u201d, or \u201cCommand\u201d on a Mac, to select more than one.&quot;</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">help_text</span> <span class=\"o\">=</span> <span class=\"n\">form_field</span><span class=\"o\">.</span><span class=\"n\">help_text</span>\n            <span class=\"n\">form_field</span><span class=\"o\">.</span><span class=\"n\">help_text</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                <span class=\"n\">format_lazy</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\"> </span><span class=\"si\">{}</span><span class=\"s2\">&quot;</span><span class=\"p\">,</span> <span class=\"n\">help_text</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">help_text</span> <span class=\"k\">else</span> <span class=\"n\">msg</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">form_field</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_autocomplete_fields</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a list of ForeignKey and/or ManyToMany fields which should use</span>\n<span class=\"sd\">        an autocomplete widget.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">autocomplete_fields</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_view_on_site_url</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">obj</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">view_on_site</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">view_on_site</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">view_on_site</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"s2\">&quot;get_absolute_url&quot;</span><span class=\"p\">):</span>\n            <span class=\"c1\"># use the ContentType lookup if view_on_site is True</span>\n            <span class=\"k\">return</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;admin:view_on_site&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;content_type_id&quot;</span><span class=\"p\">:</span> <span class=\"n\">get_content_type_for_model</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;object_id&quot;</span><span class=\"p\">:</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n                <span class=\"p\">},</span>\n                <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_empty_value_display</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return the empty_value_display set on ModelAdmin or AdminSite.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">mark_safe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">empty_value_display</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"ne\">AttributeError</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">mark_safe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">empty_value_display</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_exclude</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for specifying exclude.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">exclude</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_fields</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for specifying fields.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fields</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fields</span>\n        <span class=\"c1\"># _get_form_for_get_fields() is implemented in subclasses.</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_form_for_get_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"o\">*</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">base_fields</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_readonly_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)]</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_fieldsets</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for specifying fieldsets.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fieldsets</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fieldsets</span>\n        <span class=\"k\">return</span> <span class=\"p\">[(</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"p\">{</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)})]</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_inlines</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Hook for specifying custom inlines.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">inlines</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_ordering</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for specifying field ordering.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">ordering</span> <span class=\"ow\">or</span> <span class=\"p\">()</span>  <span class=\"c1\"># otherwise we might try to *None, which is bad ;)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_readonly_fields</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for specifying custom readonly fields.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">readonly_fields</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_prepopulated_fields</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for specifying custom prepopulated fields.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">prepopulated_fields</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a QuerySet of all model instances that can be edited by the</span>\n<span class=\"sd\">        admin site. This is used by changelist_view.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">qs</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_default_manager</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">()</span>\n        <span class=\"c1\"># TODO: this should be handled by some parameter to the ChangeList.</span>\n        <span class=\"n\">ordering</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_ordering</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">ordering</span><span class=\"p\">:</span>\n            <span class=\"n\">qs</span> <span class=\"o\">=</span> <span class=\"n\">qs</span><span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">ordering</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">qs</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_sortable_by</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Hook for specifying which fields can be sorted in the changelist.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sortable_by</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">sortable_by</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span>\n            <span class=\"k\">else</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_list_display</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"c1\"># RemovedInDjango60Warning: when the deprecation ends, replace with:</span>\n    <span class=\"c1\"># def lookup_allowed(self, lookup, value, request):</span>\n    <span class=\"k\">def</span> <span class=\"nf\">lookup_allowed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">lookup</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.filters</span> <span class=\"kn\">import</span> <span class=\"n\">SimpleListFilter</span>\n\n        <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span>\n        <span class=\"c1\"># Check FKey lookups that are allowed, so that popups produced by</span>\n        <span class=\"c1\"># ForeignKeyRawIdWidget, on the basis of ForeignKey.limit_choices_to,</span>\n        <span class=\"c1\"># are allowed to work.</span>\n        <span class=\"k\">for</span> <span class=\"n\">fk_lookup</span> <span class=\"ow\">in</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">related_fkey_lookups</span><span class=\"p\">:</span>\n            <span class=\"c1\"># As ``limit_choices_to`` can be a callable, invoke it here.</span>\n            <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"n\">fk_lookup</span><span class=\"p\">):</span>\n                <span class=\"n\">fk_lookup</span> <span class=\"o\">=</span> <span class=\"n\">fk_lookup</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">lookup</span><span class=\"p\">,</span> <span class=\"n\">value</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">widgets</span><span class=\"o\">.</span><span class=\"n\">url_params_from_lookup_dict</span><span class=\"p\">(</span>\n                <span class=\"n\">fk_lookup</span>\n            <span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span>\n\n        <span class=\"n\">relation_parts</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">prev_field</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n        <span class=\"k\">for</span> <span class=\"n\">part</span> <span class=\"ow\">in</span> <span class=\"n\">lookup</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"n\">LOOKUP_SEP</span><span class=\"p\">):</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">get_field</span><span class=\"p\">(</span><span class=\"n\">part</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"n\">FieldDoesNotExist</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Lookups on nonexistent fields are ok, since they&#39;re ignored</span>\n                <span class=\"c1\"># later.</span>\n                <span class=\"k\">break</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">prev_field</span> <span class=\"ow\">or</span> <span class=\"p\">(</span>\n                <span class=\"n\">prev_field</span><span class=\"o\">.</span><span class=\"n\">is_relation</span>\n                <span class=\"ow\">and</span> <span class=\"n\">field</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">parents</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">()</span>\n                <span class=\"ow\">and</span> <span class=\"n\">field</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">auto_field</span>\n                <span class=\"ow\">and</span> <span class=\"p\">(</span>\n                    <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">auto_field</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span>\n                    <span class=\"ow\">or</span> <span class=\"n\">part</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">prev_field</span><span class=\"p\">,</span> <span class=\"s2\">&quot;to_fields&quot;</span><span class=\"p\">,</span> <span class=\"p\">[])</span>\n                <span class=\"p\">)</span>\n            <span class=\"p\">):</span>\n                <span class=\"n\">relation_parts</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">part</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"p\">,</span> <span class=\"s2\">&quot;path_infos&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n                <span class=\"c1\"># This is not a relational field, so further parts</span>\n                <span class=\"c1\"># must be transforms.</span>\n                <span class=\"k\">break</span>\n            <span class=\"n\">prev_field</span> <span class=\"o\">=</span> <span class=\"n\">field</span>\n            <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">path_infos</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">to_opts</span><span class=\"o\">.</span><span class=\"n\">model</span>\n\n        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">relation_parts</span><span class=\"p\">)</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">1</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Either a local field filter, or no fields at all.</span>\n            <span class=\"k\">return</span> <span class=\"kc\">True</span>\n        <span class=\"n\">valid_lookups</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_hierarchy</span><span class=\"p\">}</span>\n        <span class=\"c1\"># RemovedInDjango60Warning: when the deprecation ends, replace with:</span>\n        <span class=\"c1\"># for filter_item in self.get_list_filter(request):</span>\n        <span class=\"n\">list_filter</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_list_filter</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">request</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_filter</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">filter_item</span> <span class=\"ow\">in</span> <span class=\"n\">list_filter</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">filter_item</span><span class=\"p\">,</span> <span class=\"nb\">type</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"nb\">issubclass</span><span class=\"p\">(</span>\n                <span class=\"n\">filter_item</span><span class=\"p\">,</span> <span class=\"n\">SimpleListFilter</span>\n            <span class=\"p\">):</span>\n                <span class=\"n\">valid_lookups</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">filter_item</span><span class=\"o\">.</span><span class=\"n\">parameter_name</span><span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">filter_item</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"nb\">list</span><span class=\"p\">,</span> <span class=\"nb\">tuple</span><span class=\"p\">)):</span>\n                <span class=\"n\">valid_lookups</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">filter_item</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">])</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">valid_lookups</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">filter_item</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Is it a valid relational lookup?</span>\n        <span class=\"k\">return</span> <span class=\"ow\">not</span> <span class=\"p\">{</span>\n            <span class=\"n\">LOOKUP_SEP</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">relation_parts</span><span class=\"p\">),</span>\n            <span class=\"n\">LOOKUP_SEP</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">relation_parts</span> <span class=\"o\">+</span> <span class=\"p\">[</span><span class=\"n\">part</span><span class=\"p\">]),</span>\n        <span class=\"p\">}</span><span class=\"o\">.</span><span class=\"n\">isdisjoint</span><span class=\"p\">(</span><span class=\"n\">valid_lookups</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">to_field_allowed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">to_field</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return True if the model associated with this admin should be</span>\n<span class=\"sd\">        allowed to be referenced by the specified field.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">get_field</span><span class=\"p\">(</span><span class=\"n\">to_field</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"n\">FieldDoesNotExist</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">False</span>\n\n        <span class=\"c1\"># Always allow referencing the primary key since it&#39;s already possible</span>\n        <span class=\"c1\"># to get this information from the change view URL.</span>\n        <span class=\"k\">if</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">primary_key</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"kc\">True</span>\n\n        <span class=\"c1\"># Allow reverse relationships to models defining m2m fields if they</span>\n        <span class=\"c1\"># target the specified field.</span>\n        <span class=\"k\">for</span> <span class=\"n\">many_to_many</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">many_to_many</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">many_to_many</span><span class=\"o\">.</span><span class=\"n\">m2m_target_field_name</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"n\">to_field</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span>\n\n        <span class=\"c1\"># Make sure at least one of the models registered for this site</span>\n        <span class=\"c1\"># references this field through a FK or a M2M relationship.</span>\n        <span class=\"n\">registered_models</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">admin</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"n\">registered_models</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">)</span>\n            <span class=\"k\">for</span> <span class=\"n\">inline</span> <span class=\"ow\">in</span> <span class=\"n\">admin</span><span class=\"o\">.</span><span class=\"n\">inlines</span><span class=\"p\">:</span>\n                <span class=\"n\">registered_models</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)</span>\n\n        <span class=\"n\">related_objects</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"n\">f</span>\n            <span class=\"k\">for</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">get_fields</span><span class=\"p\">(</span><span class=\"n\">include_hidden</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">auto_created</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">concrete</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">related_object</span> <span class=\"ow\">in</span> <span class=\"n\">related_objects</span><span class=\"p\">:</span>\n            <span class=\"n\">related_model</span> <span class=\"o\">=</span> <span class=\"n\">related_object</span><span class=\"o\">.</span><span class=\"n\">related_model</span>\n            <span class=\"n\">remote_field</span> <span class=\"o\">=</span> <span class=\"n\">related_object</span><span class=\"o\">.</span><span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span>\n                <span class=\"nb\">any</span><span class=\"p\">(</span><span class=\"nb\">issubclass</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">related_model</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">model</span> <span class=\"ow\">in</span> <span class=\"n\">registered_models</span><span class=\"p\">)</span>\n                <span class=\"ow\">and</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">remote_field</span><span class=\"p\">,</span> <span class=\"s2\">&quot;get_related_field&quot;</span><span class=\"p\">)</span>\n                <span class=\"ow\">and</span> <span class=\"n\">remote_field</span><span class=\"o\">.</span><span class=\"n\">get_related_field</span><span class=\"p\">()</span> <span class=\"o\">==</span> <span class=\"n\">field</span>\n            <span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"kc\">True</span>\n\n        <span class=\"k\">return</span> <span class=\"kc\">False</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_add_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return True if the given request has permission to add an object.</span>\n<span class=\"sd\">        Can be overridden by the user in subclasses.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span>\n        <span class=\"n\">codename</span> <span class=\"o\">=</span> <span class=\"n\">get_permission_codename</span><span class=\"p\">(</span><span class=\"s2\">&quot;add&quot;</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">has_perm</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">.</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">codename</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_change_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return True if the given request has permission to change the given</span>\n<span class=\"sd\">        Django model instance, the default implementation doesn&#39;t examine the</span>\n<span class=\"sd\">        `obj` parameter.</span>\n\n<span class=\"sd\">        Can be overridden by the user in subclasses. In such case it should</span>\n<span class=\"sd\">        return True if the given request has permission to change the `obj`</span>\n<span class=\"sd\">        model instance. If `obj` is None, this should return True if the given</span>\n<span class=\"sd\">        request has permission to change *any* object of the given type.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span>\n        <span class=\"n\">codename</span> <span class=\"o\">=</span> <span class=\"n\">get_permission_codename</span><span class=\"p\">(</span><span class=\"s2\">&quot;change&quot;</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">has_perm</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">.</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">codename</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_delete_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return True if the given request has permission to delete the given</span>\n<span class=\"sd\">        Django model instance, the default implementation doesn&#39;t examine the</span>\n<span class=\"sd\">        `obj` parameter.</span>\n\n<span class=\"sd\">        Can be overridden by the user in subclasses. In such case it should</span>\n<span class=\"sd\">        return True if the given request has permission to delete the `obj`</span>\n<span class=\"sd\">        model instance. If `obj` is None, this should return True if the given</span>\n<span class=\"sd\">        request has permission to delete *any* object of the given type.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span>\n        <span class=\"n\">codename</span> <span class=\"o\">=</span> <span class=\"n\">get_permission_codename</span><span class=\"p\">(</span><span class=\"s2\">&quot;delete&quot;</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">has_perm</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">.</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">codename</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_view_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return True if the given request has permission to view the given</span>\n<span class=\"sd\">        Django model instance. The default implementation doesn&#39;t examine the</span>\n<span class=\"sd\">        `obj` parameter.</span>\n\n<span class=\"sd\">        If overridden by the user in subclasses, it should return True if the</span>\n<span class=\"sd\">        given request has permission to view the `obj` model instance. If `obj`</span>\n<span class=\"sd\">        is None, it should return True if the request has permission to view</span>\n<span class=\"sd\">        any object of the given type.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span>\n        <span class=\"n\">codename_view</span> <span class=\"o\">=</span> <span class=\"n\">get_permission_codename</span><span class=\"p\">(</span><span class=\"s2\">&quot;view&quot;</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">)</span>\n        <span class=\"n\">codename_change</span> <span class=\"o\">=</span> <span class=\"n\">get_permission_codename</span><span class=\"p\">(</span><span class=\"s2\">&quot;change&quot;</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">has_perm</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">.</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">codename_view</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">has_perm</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">.</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">codename_change</span><span class=\"p\">))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_view_or_change_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_module_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return True if the given request has any permission in the given</span>\n<span class=\"sd\">        app label.</span>\n\n<span class=\"sd\">        Can be overridden by the user in subclasses. In such case it should</span>\n<span class=\"sd\">        return True if the given request has permission to view the module on</span>\n<span class=\"sd\">        the admin index page and access the module&#39;s index page. Overriding it</span>\n<span class=\"sd\">        does not restrict access to the add, change or delete views. Use</span>\n<span class=\"sd\">        `ModelAdmin.has_(add|change|delete)_permission` for that.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">has_module_perms</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"ModelAdmin\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">ModelAdmin</span><span class=\"p\">(</span><span class=\"n\">BaseModelAdmin</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;Encapsulate all admin options and functionality for a given model.&quot;&quot;&quot;</span>\n\n    <span class=\"n\">list_display</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"s2\">&quot;__str__&quot;</span><span class=\"p\">,)</span>\n    <span class=\"n\">list_display_links</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">list_filter</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">list_select_related</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"n\">list_per_page</span> <span class=\"o\">=</span> <span class=\"mi\">100</span>\n    <span class=\"n\">list_max_show_all</span> <span class=\"o\">=</span> <span class=\"mi\">200</span>\n    <span class=\"n\">list_editable</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">search_fields</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">search_help_text</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">date_hierarchy</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">save_as</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"n\">save_as_continue</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">save_on_top</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"n\">paginator</span> <span class=\"o\">=</span> <span class=\"n\">Paginator</span>\n    <span class=\"n\">preserve_filters</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">show_facets</span> <span class=\"o\">=</span> <span class=\"n\">ShowFacets</span><span class=\"o\">.</span><span class=\"n\">ALLOW</span>\n    <span class=\"n\">inlines</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n\n    <span class=\"c1\"># Custom templates (designed to be over-ridden in subclasses)</span>\n    <span class=\"n\">add_form_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">change_form_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">change_list_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">delete_confirmation_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">delete_selected_confirmation_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">object_history_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">popup_response_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"c1\"># Actions</span>\n    <span class=\"n\">actions</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n    <span class=\"n\">action_form</span> <span class=\"o\">=</span> <span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">ActionForm</span>\n    <span class=\"n\">actions_on_top</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">actions_on_bottom</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"n\">actions_selection_counter</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">checks_class</span> <span class=\"o\">=</span> <span class=\"n\">ModelAdminChecks</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">admin_site</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">model</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span> <span class=\"o\">=</span> <span class=\"n\">admin_site</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__str__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">.</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__repr__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"p\">(</span>\n            <span class=\"sa\">f</span><span class=\"s2\">&quot;&lt;</span><span class=\"si\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__qualname__</span><span class=\"si\">}</span><span class=\"s2\">: model=</span><span class=\"si\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"vm\">__qualname__</span><span class=\"si\">}</span><span class=\"s2\"> &quot;</span>\n            <span class=\"sa\">f</span><span class=\"s2\">&quot;site=</span><span class=\"si\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"si\">!r}</span><span class=\"s2\">&gt;&quot;</span>\n        <span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_inline_instances\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_inline_instances\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_inline_instances</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">inline_instances</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">inline_class</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_inlines</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n            <span class=\"n\">inline</span> <span class=\"o\">=</span> <span class=\"n\">inline_class</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"p\">(</span>\n                    <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_view_or_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n                    <span class=\"ow\">or</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n                    <span class=\"ow\">or</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n                <span class=\"p\">):</span>\n                    <span class=\"k\">continue</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n                    <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">max_num</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n            <span class=\"n\">inline_instances</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">inline</span><span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">inline_instances</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_urls\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_urls\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_urls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.urls</span> <span class=\"kn\">import</span> <span class=\"n\">path</span>\n\n        <span class=\"k\">def</span> <span class=\"nf\">wrap</span><span class=\"p\">(</span><span class=\"n\">view</span><span class=\"p\">):</span>\n            <span class=\"k\">def</span> <span class=\"nf\">wrapper</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">admin_view</span><span class=\"p\">(</span><span class=\"n\">view</span><span class=\"p\">)(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n            <span class=\"n\">wrapper</span><span class=\"o\">.</span><span class=\"n\">model_admin</span> <span class=\"o\">=</span> <span class=\"bp\">self</span>\n            <span class=\"k\">return</span> <span class=\"n\">update_wrapper</span><span class=\"p\">(</span><span class=\"n\">wrapper</span><span class=\"p\">,</span> <span class=\"n\">view</span><span class=\"p\">)</span>\n\n        <span class=\"n\">info</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span>\n\n        <span class=\"k\">return</span> <span class=\"p\">[</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">changelist_view</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_changelist&quot;</span> <span class=\"o\">%</span> <span class=\"n\">info</span><span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s2\">&quot;add/&quot;</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_view</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_add&quot;</span> <span class=\"o\">%</span> <span class=\"n\">info</span><span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;&lt;path:object_id&gt;/history/&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">history_view</span><span class=\"p\">),</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_history&quot;</span> <span class=\"o\">%</span> <span class=\"n\">info</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;&lt;path:object_id&gt;/delete/&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">delete_view</span><span class=\"p\">),</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_delete&quot;</span> <span class=\"o\">%</span> <span class=\"n\">info</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;&lt;path:object_id&gt;/change/&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">change_view</span><span class=\"p\">),</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_change&quot;</span> <span class=\"o\">%</span> <span class=\"n\">info</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"c1\"># For backwards compatibility (was the change url before 1.9)</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;&lt;path:object_id&gt;/&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">wrap</span><span class=\"p\">(</span>\n                    <span class=\"n\">RedirectView</span><span class=\"o\">.</span><span class=\"n\">as_view</span><span class=\"p\">(</span>\n                        <span class=\"n\">pattern_name</span><span class=\"o\">=</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_change&quot;</span>\n                        <span class=\"o\">%</span> <span class=\"p\">((</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,)</span> <span class=\"o\">+</span> <span class=\"n\">info</span><span class=\"p\">)</span>\n                    <span class=\"p\">)</span>\n                <span class=\"p\">),</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">]</span></div>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">urls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_urls</span><span class=\"p\">()</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">media</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">extra</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&quot;</span> <span class=\"k\">if</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEBUG</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;.min&quot;</span>\n        <span class=\"n\">js</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"s2\">&quot;vendor/jquery/jquery</span><span class=\"si\">%s</span><span class=\"s2\">.js&quot;</span> <span class=\"o\">%</span> <span class=\"n\">extra</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;jquery.init.js&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;core.js&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;admin/RelatedObjectLookups.js&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;actions.js&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;urlify.js&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;prepopulate.js&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;vendor/xregexp/xregexp</span><span class=\"si\">%s</span><span class=\"s2\">.js&quot;</span> <span class=\"o\">%</span> <span class=\"n\">extra</span><span class=\"p\">,</span>\n        <span class=\"p\">]</span>\n        <span class=\"k\">return</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">Media</span><span class=\"p\">(</span><span class=\"n\">js</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;admin/js/</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"n\">url</span> <span class=\"k\">for</span> <span class=\"n\">url</span> <span class=\"ow\">in</span> <span class=\"n\">js</span><span class=\"p\">])</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_model_perms</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a dict of all perms for this model. This dict has the keys</span>\n<span class=\"sd\">        ``add``, ``change``, ``delete``, and ``view`` mapping to the True/False</span>\n<span class=\"sd\">        for each of those actions.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;add&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;change&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;delete&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;view&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n        <span class=\"p\">}</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_form_for_get_fields</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_form</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_form\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_form\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_form</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a Form class for use in the admin add view. This is used by</span>\n<span class=\"sd\">        add_view and change_view.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;fields&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">fields</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">fields</span> <span class=\"o\">=</span> <span class=\"n\">flatten_fieldsets</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_fieldsets</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">))</span>\n        <span class=\"n\">excluded</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_exclude</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">exclude</span> <span class=\"o\">=</span> <span class=\"p\">[]</span> <span class=\"k\">if</span> <span class=\"n\">excluded</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">excluded</span><span class=\"p\">)</span>\n        <span class=\"n\">readonly_fields</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_readonly_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">exclude</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"n\">readonly_fields</span><span class=\"p\">)</span>\n        <span class=\"c1\"># Exclude all fields if it&#39;s a change form and the user doesn&#39;t have</span>\n        <span class=\"c1\"># the change permission.</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"n\">change</span>\n            <span class=\"ow\">and</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s2\">&quot;user&quot;</span><span class=\"p\">)</span>\n            <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">exclude</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">excluded</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"s2\">&quot;_meta&quot;</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">exclude</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Take the custom ModelForm&#39;s Meta.exclude into account only if the</span>\n            <span class=\"c1\"># ModelAdmin doesn&#39;t define its own.</span>\n            <span class=\"n\">exclude</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">exclude</span><span class=\"p\">)</span>\n        <span class=\"c1\"># if exclude is an empty list we pass None to be consistent with the</span>\n        <span class=\"c1\"># default on modelform_factory</span>\n        <span class=\"n\">exclude</span> <span class=\"o\">=</span> <span class=\"n\">exclude</span> <span class=\"ow\">or</span> <span class=\"kc\">None</span>\n\n        <span class=\"c1\"># Remove declared form fields which are in readonly_fields.</span>\n        <span class=\"n\">new_attrs</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"o\">.</span><span class=\"n\">fromkeys</span><span class=\"p\">(</span>\n            <span class=\"n\">f</span> <span class=\"k\">for</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"n\">readonly_fields</span> <span class=\"k\">if</span> <span class=\"n\">f</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">declared_fields</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"nb\">type</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"p\">,),</span> <span class=\"n\">new_attrs</span><span class=\"p\">)</span>\n\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;form&quot;</span><span class=\"p\">:</span> <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">:</span> <span class=\"n\">fields</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;exclude&quot;</span><span class=\"p\">:</span> <span class=\"n\">exclude</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;formfield_callback&quot;</span><span class=\"p\">:</span> <span class=\"n\">partial</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_for_dbfield</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">modelform_defines_fields</span><span class=\"p\">(</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;form&quot;</span><span class=\"p\">]</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">ALL_FIELDS</span>\n\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">modelform_factory</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"n\">FieldError</span> <span class=\"k\">as</span> <span class=\"n\">e</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">FieldError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">. Check fields/fieldsets/exclude attributes of class </span><span class=\"si\">%s</span><span class=\"s2\">.&quot;</span>\n                <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">e</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n            <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_changelist\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_changelist\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_changelist</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return the ChangeList class for use on the changelist page.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.views.main</span> <span class=\"kn\">import</span> <span class=\"n\">ChangeList</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">ChangeList</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_changelist_instance</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a `ChangeList` instance based on `request`. May raise</span>\n<span class=\"sd\">        `IncorrectLookupParameters`.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">list_display</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_list_display</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">list_display_links</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_list_display_links</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">list_display</span><span class=\"p\">)</span>\n        <span class=\"c1\"># Add the action checkboxes if any actions are available.</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_actions</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n            <span class=\"n\">list_display</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s2\">&quot;action_checkbox&quot;</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">list_display</span><span class=\"p\">]</span>\n        <span class=\"n\">sortable_by</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_sortable_by</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">ChangeList</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_changelist</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">ChangeList</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">,</span>\n            <span class=\"n\">list_display</span><span class=\"p\">,</span>\n            <span class=\"n\">list_display_links</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_list_filter</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">date_hierarchy</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_search_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_list_select_related</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_per_page</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_max_show_all</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_editable</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"p\">,</span>\n            <span class=\"n\">sortable_by</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">search_help_text</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_object</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">from_field</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return an instance matching the field and value provided, the primary</span>\n<span class=\"sd\">        key is used if no field is provided. Return ``None`` if no match is</span>\n<span class=\"sd\">        found or the object_id fails validation.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">model</span>\n        <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">pk</span> <span class=\"k\">if</span> <span class=\"n\">from_field</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">get_field</span><span class=\"p\">(</span><span class=\"n\">from_field</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">object_id</span> <span class=\"o\">=</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">to_python</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"p\">{</span><span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"n\">object_id</span><span class=\"p\">})</span>\n        <span class=\"k\">except</span> <span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">DoesNotExist</span><span class=\"p\">,</span> <span class=\"n\">ValidationError</span><span class=\"p\">,</span> <span class=\"ne\">ValueError</span><span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_changelist_form\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_changelist_form\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_changelist_form</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a Form class for use in the Formset on the changelist page.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;formfield_callback&quot;</span><span class=\"p\">:</span> <span class=\"n\">partial</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_for_dbfield</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"n\">defaults</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">)</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">modelform_defines_fields</span><span class=\"p\">(</span>\n            <span class=\"n\">defaults</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;form&quot;</span><span class=\"p\">)</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">ALL_FIELDS</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">modelform_factory</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_changelist_formset\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_changelist_formset\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_changelist_formset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a FormSet class for use on the changelist page if list_editable</span>\n<span class=\"sd\">        is used.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;formfield_callback&quot;</span><span class=\"p\">:</span> <span class=\"n\">partial</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_for_dbfield</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">return</span> <span class=\"n\">modelformset_factory</span><span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_changelist_form</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"n\">extra</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span>\n            <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_editable</span><span class=\"p\">,</span>\n            <span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_formsets_with_inlines\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_formsets_with_inlines\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_formsets_with_inlines</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Yield formsets and the corresponding inlines.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">for</span> <span class=\"n\">inline</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_inline_instances</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n            <span class=\"k\">yield</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">get_formset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">),</span> <span class=\"n\">inline</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_paginator\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_paginator\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_paginator</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"p\">,</span> <span class=\"n\">per_page</span><span class=\"p\">,</span> <span class=\"n\">orphans</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">allow_empty_first_page</span><span class=\"o\">=</span><span class=\"kc\">True</span>\n    <span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">paginator</span><span class=\"p\">(</span><span class=\"n\">queryset</span><span class=\"p\">,</span> <span class=\"n\">per_page</span><span class=\"p\">,</span> <span class=\"n\">orphans</span><span class=\"p\">,</span> <span class=\"n\">allow_empty_first_page</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log_addition</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Log that an object has been successfully added.</span>\n\n<span class=\"sd\">        The default implementation creates an admin LogEntry object.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.models</span> <span class=\"kn\">import</span> <span class=\"n\">ADDITION</span><span class=\"p\">,</span> <span class=\"n\">LogEntry</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">LogEntry</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">log_action</span><span class=\"p\">(</span>\n            <span class=\"n\">user_id</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">content_type_id</span><span class=\"o\">=</span><span class=\"n\">get_content_type_for_model</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">object_id</span><span class=\"o\">=</span><span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">object_repr</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">),</span>\n            <span class=\"n\">action_flag</span><span class=\"o\">=</span><span class=\"n\">ADDITION</span><span class=\"p\">,</span>\n            <span class=\"n\">change_message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log_change</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Log that an object has been successfully changed.</span>\n\n<span class=\"sd\">        The default implementation creates an admin LogEntry object.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.models</span> <span class=\"kn\">import</span> <span class=\"n\">CHANGE</span><span class=\"p\">,</span> <span class=\"n\">LogEntry</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">LogEntry</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">log_action</span><span class=\"p\">(</span>\n            <span class=\"n\">user_id</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">content_type_id</span><span class=\"o\">=</span><span class=\"n\">get_content_type_for_model</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">object_id</span><span class=\"o\">=</span><span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">object_repr</span><span class=\"o\">=</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">),</span>\n            <span class=\"n\">action_flag</span><span class=\"o\">=</span><span class=\"n\">CHANGE</span><span class=\"p\">,</span>\n            <span class=\"n\">change_message</span><span class=\"o\">=</span><span class=\"n\">message</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">log_deletion</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">object_repr</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Log that an object will be deleted. Note that this method must be</span>\n<span class=\"sd\">        called before the deletion.</span>\n\n<span class=\"sd\">        The default implementation creates an admin LogEntry object.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.models</span> <span class=\"kn\">import</span> <span class=\"n\">DELETION</span><span class=\"p\">,</span> <span class=\"n\">LogEntry</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">LogEntry</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">log_action</span><span class=\"p\">(</span>\n            <span class=\"n\">user_id</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">content_type_id</span><span class=\"o\">=</span><span class=\"n\">get_content_type_for_model</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">object_id</span><span class=\"o\">=</span><span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n            <span class=\"n\">object_repr</span><span class=\"o\">=</span><span class=\"n\">object_repr</span><span class=\"p\">,</span>\n            <span class=\"n\">action_flag</span><span class=\"o\">=</span><span class=\"n\">DELETION</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">action_checkbox</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        A list_display column containing a checkbox widget.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">attrs</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;class&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;action-select&quot;</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;aria-label&quot;</span><span class=\"p\">:</span> <span class=\"n\">format_html</span><span class=\"p\">(</span><span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Select this object for an action - </span><span class=\"si\">{}</span><span class=\"s2\">&quot;</span><span class=\"p\">),</span> <span class=\"n\">obj</span><span class=\"p\">),</span>\n        <span class=\"p\">}</span>\n        <span class=\"n\">checkbox</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">CheckboxInput</span><span class=\"p\">(</span><span class=\"n\">attrs</span><span class=\"p\">,</span> <span class=\"k\">lambda</span> <span class=\"n\">value</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">checkbox</span><span class=\"o\">.</span><span class=\"n\">render</span><span class=\"p\">(</span><span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">ACTION_CHECKBOX_NAME</span><span class=\"p\">,</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">))</span>\n\n    <span class=\"nd\">@staticmethod</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_get_action_description</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"s2\">&quot;short_description&quot;</span><span class=\"p\">,</span> <span class=\"n\">capfirst</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">.</span><span class=\"n\">replace</span><span class=\"p\">(</span><span class=\"s2\">&quot;_&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot; &quot;</span><span class=\"p\">)))</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_base_actions</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Return the list of actions, prior to any request-based filtering.&quot;&quot;&quot;</span>\n        <span class=\"n\">actions</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">base_actions</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_action</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">actions</span> <span class=\"ow\">or</span> <span class=\"p\">[])</span>\n        <span class=\"c1\"># get_action might have returned None, so filter any of those out.</span>\n        <span class=\"n\">base_actions</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">action</span> <span class=\"k\">for</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"n\">base_actions</span> <span class=\"k\">if</span> <span class=\"n\">action</span><span class=\"p\">]</span>\n        <span class=\"n\">base_action_names</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"n\">name</span> <span class=\"k\">for</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">_</span> <span class=\"ow\">in</span> <span class=\"n\">base_actions</span><span class=\"p\">}</span>\n\n        <span class=\"c1\"># Gather actions from the admin site first</span>\n        <span class=\"k\">for</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">func</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">actions</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"n\">base_action_names</span><span class=\"p\">:</span>\n                <span class=\"k\">continue</span>\n            <span class=\"n\">description</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_action_description</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">)</span>\n            <span class=\"n\">actions</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">((</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">description</span><span class=\"p\">))</span>\n        <span class=\"c1\"># Add actions from this ModelAdmin.</span>\n        <span class=\"n\">actions</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"n\">base_actions</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">actions</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_filter_actions_by_permissions</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">actions</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Filter out any actions that the user doesn&#39;t have access to.&quot;&quot;&quot;</span>\n        <span class=\"n\">filtered_actions</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">action</span> <span class=\"ow\">in</span> <span class=\"n\">actions</span><span class=\"p\">:</span>\n            <span class=\"n\">callable</span> <span class=\"o\">=</span> <span class=\"n\">action</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">callable</span><span class=\"p\">,</span> <span class=\"s2\">&quot;allowed_permissions&quot;</span><span class=\"p\">):</span>\n                <span class=\"n\">filtered_actions</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">)</span>\n                <span class=\"k\">continue</span>\n            <span class=\"n\">permission_checks</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"s2\">&quot;has_</span><span class=\"si\">%s</span><span class=\"s2\">_permission&quot;</span> <span class=\"o\">%</span> <span class=\"n\">permission</span><span class=\"p\">)</span>\n                <span class=\"k\">for</span> <span class=\"n\">permission</span> <span class=\"ow\">in</span> <span class=\"n\">callable</span><span class=\"o\">.</span><span class=\"n\">allowed_permissions</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"nb\">any</span><span class=\"p\">(</span><span class=\"n\">has_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">has_permission</span> <span class=\"ow\">in</span> <span class=\"n\">permission_checks</span><span class=\"p\">):</span>\n                <span class=\"n\">filtered_actions</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">filtered_actions</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_actions\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/actions/#django.contrib.admin.ModelAdmin.get_actions\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_actions</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a dictionary mapping the names of all actions for this</span>\n<span class=\"sd\">        ModelAdmin to a tuple of (callable, name, description) for each action.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"c1\"># If self.actions is set to None that means actions are disabled on</span>\n        <span class=\"c1\"># this page.</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">actions</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"p\">{}</span>\n        <span class=\"n\">actions</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_filter_actions_by_permissions</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_base_actions</span><span class=\"p\">())</span>\n        <span class=\"k\">return</span> <span class=\"p\">{</span><span class=\"n\">name</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">desc</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">desc</span> <span class=\"ow\">in</span> <span class=\"n\">actions</span><span class=\"p\">}</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_action_choices</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">default_choices</span><span class=\"o\">=</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">BLANK_CHOICE_DASH</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a list of choices for use in a form object.  Each choice is a</span>\n<span class=\"sd\">        tuple (name, description).</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">choices</span> <span class=\"o\">=</span> <span class=\"p\">[]</span> <span class=\"o\">+</span> <span class=\"n\">default_choices</span>\n        <span class=\"k\">for</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">description</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_actions</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">():</span>\n            <span class=\"n\">choice</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">name</span><span class=\"p\">,</span> <span class=\"n\">description</span> <span class=\"o\">%</span> <span class=\"n\">model_format_dict</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">))</span>\n            <span class=\"n\">choices</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">choice</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">choices</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_action</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a given action from a parameter, which can either be a callable,</span>\n<span class=\"sd\">        or the name of a method on the ModelAdmin.  Return is a tuple of</span>\n<span class=\"sd\">        (callable, name, description).</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"c1\"># If the action is a callable, just use it.</span>\n        <span class=\"k\">if</span> <span class=\"n\">callable</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">):</span>\n            <span class=\"n\">func</span> <span class=\"o\">=</span> <span class=\"n\">action</span>\n            <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"n\">action</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n\n        <span class=\"c1\"># Next, look for a method. Grab it off self.__class__ to get an unbound</span>\n        <span class=\"c1\"># method instead of a bound one; this ensures that the calling</span>\n        <span class=\"c1\"># conventions are the same for functions and methods.</span>\n        <span class=\"k\">elif</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"p\">):</span>\n            <span class=\"n\">func</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Finally, look for a named method on the admin site</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">func</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">get_action</span><span class=\"p\">(</span><span class=\"n\">action</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"ne\">KeyError</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n        <span class=\"n\">description</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_action_description</span><span class=\"p\">(</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"p\">,</span> <span class=\"n\">description</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_list_display\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_list_display\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_list_display</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a sequence containing the fields to be displayed on the</span>\n<span class=\"sd\">        changelist.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_display</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_list_display_links\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_list_display_links\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_list_display_links</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">list_display</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a sequence containing the fields to be displayed as links</span>\n<span class=\"sd\">        on the changelist. The list_display parameter is the list of fields</span>\n<span class=\"sd\">        returned by get_list_display().</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_display_links</span>\n            <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_display_links</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span>\n            <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">list_display</span>\n        <span class=\"p\">):</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_display_links</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Use only the first item in list_display as link</span>\n            <span class=\"k\">return</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">list_display</span><span class=\"p\">)[:</span><span class=\"mi\">1</span><span class=\"p\">]</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_list_filter\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_list_filter\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_list_filter</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a sequence containing the fields to be displayed as filters in</span>\n<span class=\"sd\">        the right sidebar of the changelist page.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_filter</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_list_select_related\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_list_select_related\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_list_select_related</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a list of fields to add to the select_related() part of the</span>\n<span class=\"sd\">        changelist items query.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">list_select_related</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_search_fields\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_search_fields\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_search_fields</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a sequence containing the fields to be searched whenever</span>\n<span class=\"sd\">        somebody submits a search query.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">search_fields</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_search_results\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_search_results\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_search_results</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"p\">,</span> <span class=\"n\">search_term</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a tuple containing a queryset to implement the search</span>\n<span class=\"sd\">        and a boolean indicating if the results may contain duplicates.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"c1\"># Apply keyword searches.</span>\n        <span class=\"k\">def</span> <span class=\"nf\">construct_search</span><span class=\"p\">(</span><span class=\"n\">field_name</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">field_name</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s2\">&quot;^&quot;</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">__istartswith&quot;</span> <span class=\"o\">%</span> <span class=\"n\">field_name</span><span class=\"o\">.</span><span class=\"n\">removeprefix</span><span class=\"p\">(</span><span class=\"s2\">&quot;^&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"n\">field_name</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s2\">&quot;=&quot;</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">__iexact&quot;</span> <span class=\"o\">%</span> <span class=\"n\">field_name</span><span class=\"o\">.</span><span class=\"n\">removeprefix</span><span class=\"p\">(</span><span class=\"s2\">&quot;=&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">elif</span> <span class=\"n\">field_name</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">(</span><span class=\"s2\">&quot;@&quot;</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">__search&quot;</span> <span class=\"o\">%</span> <span class=\"n\">field_name</span><span class=\"o\">.</span><span class=\"n\">removeprefix</span><span class=\"p\">(</span><span class=\"s2\">&quot;@&quot;</span><span class=\"p\">)</span>\n            <span class=\"c1\"># Use field_name if it includes a lookup.</span>\n            <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span>\n            <span class=\"n\">lookup_fields</span> <span class=\"o\">=</span> <span class=\"n\">field_name</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"n\">LOOKUP_SEP</span><span class=\"p\">)</span>\n            <span class=\"c1\"># Go through the fields, following all relations.</span>\n            <span class=\"n\">prev_field</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n            <span class=\"k\">for</span> <span class=\"n\">path_part</span> <span class=\"ow\">in</span> <span class=\"n\">lookup_fields</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"n\">path_part</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;pk&quot;</span><span class=\"p\">:</span>\n                    <span class=\"n\">path_part</span> <span class=\"o\">=</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"o\">.</span><span class=\"n\">name</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"n\">field</span> <span class=\"o\">=</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">get_field</span><span class=\"p\">(</span><span class=\"n\">path_part</span><span class=\"p\">)</span>\n                <span class=\"k\">except</span> <span class=\"n\">FieldDoesNotExist</span><span class=\"p\">:</span>\n                    <span class=\"c1\"># Use valid query lookups.</span>\n                    <span class=\"k\">if</span> <span class=\"n\">prev_field</span> <span class=\"ow\">and</span> <span class=\"n\">prev_field</span><span class=\"o\">.</span><span class=\"n\">get_lookup</span><span class=\"p\">(</span><span class=\"n\">path_part</span><span class=\"p\">):</span>\n                        <span class=\"k\">return</span> <span class=\"n\">field_name</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">prev_field</span> <span class=\"o\">=</span> <span class=\"n\">field</span>\n                    <span class=\"k\">if</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"n\">field</span><span class=\"p\">,</span> <span class=\"s2\">&quot;path_infos&quot;</span><span class=\"p\">):</span>\n                        <span class=\"c1\"># Update opts to follow the relation.</span>\n                        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">path_infos</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">to_opts</span>\n            <span class=\"c1\"># Otherwise, use the field with icontains.</span>\n            <span class=\"k\">return</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">__icontains&quot;</span> <span class=\"o\">%</span> <span class=\"n\">field_name</span>\n\n        <span class=\"n\">may_have_duplicates</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"n\">search_fields</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_search_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">search_fields</span> <span class=\"ow\">and</span> <span class=\"n\">search_term</span><span class=\"p\">:</span>\n            <span class=\"n\">orm_lookups</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n                <span class=\"n\">construct_search</span><span class=\"p\">(</span><span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">search_field</span><span class=\"p\">))</span> <span class=\"k\">for</span> <span class=\"n\">search_field</span> <span class=\"ow\">in</span> <span class=\"n\">search_fields</span>\n            <span class=\"p\">]</span>\n            <span class=\"n\">term_queries</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n            <span class=\"k\">for</span> <span class=\"n\">bit</span> <span class=\"ow\">in</span> <span class=\"n\">smart_split</span><span class=\"p\">(</span><span class=\"n\">search_term</span><span class=\"p\">):</span>\n                <span class=\"k\">if</span> <span class=\"n\">bit</span><span class=\"o\">.</span><span class=\"n\">startswith</span><span class=\"p\">((</span><span class=\"s1\">&#39;&quot;&#39;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;&#39;&quot;</span><span class=\"p\">))</span> <span class=\"ow\">and</span> <span class=\"n\">bit</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">==</span> <span class=\"n\">bit</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">]:</span>\n                    <span class=\"n\">bit</span> <span class=\"o\">=</span> <span class=\"n\">unescape_string_literal</span><span class=\"p\">(</span><span class=\"n\">bit</span><span class=\"p\">)</span>\n                <span class=\"n\">or_queries</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Q</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span>\n                    <span class=\"p\">[(</span><span class=\"n\">orm_lookup</span><span class=\"p\">,</span> <span class=\"n\">bit</span><span class=\"p\">)</span> <span class=\"k\">for</span> <span class=\"n\">orm_lookup</span> <span class=\"ow\">in</span> <span class=\"n\">orm_lookups</span><span class=\"p\">],</span>\n                    <span class=\"n\">connector</span><span class=\"o\">=</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Q</span><span class=\"o\">.</span><span class=\"n\">OR</span><span class=\"p\">,</span>\n                <span class=\"p\">)</span>\n                <span class=\"n\">term_queries</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">or_queries</span><span class=\"p\">)</span>\n            <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Q</span><span class=\"o\">.</span><span class=\"n\">create</span><span class=\"p\">(</span><span class=\"n\">term_queries</span><span class=\"p\">))</span>\n            <span class=\"n\">may_have_duplicates</span> <span class=\"o\">|=</span> <span class=\"nb\">any</span><span class=\"p\">(</span>\n                <span class=\"n\">lookup_spawns_duplicates</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span> <span class=\"n\">search_spec</span><span class=\"p\">)</span>\n                <span class=\"k\">for</span> <span class=\"n\">search_spec</span> <span class=\"ow\">in</span> <span class=\"n\">orm_lookups</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">queryset</span><span class=\"p\">,</span> <span class=\"n\">may_have_duplicates</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return the preserved filters querystring.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">match</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">resolver_match</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">preserve_filters</span> <span class=\"ow\">and</span> <span class=\"n\">match</span><span class=\"p\">:</span>\n            <span class=\"n\">current_url</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">:</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">match</span><span class=\"o\">.</span><span class=\"n\">app_name</span><span class=\"p\">,</span> <span class=\"n\">match</span><span class=\"o\">.</span><span class=\"n\">url_name</span><span class=\"p\">)</span>\n            <span class=\"n\">changelist_url</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_changelist&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">current_url</span> <span class=\"o\">==</span> <span class=\"n\">changelist_url</span><span class=\"p\">:</span>\n                <span class=\"n\">preserved_filters</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">urlencode</span><span class=\"p\">()</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">preserved_filters</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;_changelist_filters&quot;</span><span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">preserved_filters</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">urlencode</span><span class=\"p\">({</span><span class=\"s2\">&quot;_changelist_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">})</span>\n        <span class=\"k\">return</span> <span class=\"s2\">&quot;&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">construct_change_message</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">add</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Construct a JSON structure describing changes from a changed object.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">construct_change_message</span><span class=\"p\">(</span><span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">add</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.message_user\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.message_user\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">message_user</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"n\">level</span><span class=\"o\">=</span><span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">INFO</span><span class=\"p\">,</span> <span class=\"n\">extra_tags</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">fail_silently</span><span class=\"o\">=</span><span class=\"kc\">False</span>\n    <span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Send a message to the user. The default implementation</span>\n<span class=\"sd\">        posts a message using the django.contrib.messages backend.</span>\n\n<span class=\"sd\">        Exposes almost the same API as messages.add_message(), but accepts the</span>\n<span class=\"sd\">        positional arguments in a different order to maintain backwards</span>\n<span class=\"sd\">        compatibility. For convenience, it accepts the `level` argument as</span>\n<span class=\"sd\">        a string rather than the usual level number.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">level</span><span class=\"p\">,</span> <span class=\"nb\">int</span><span class=\"p\">):</span>\n            <span class=\"c1\"># attempt to get the level if passed a string</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">level</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">constants</span><span class=\"p\">,</span> <span class=\"n\">level</span><span class=\"o\">.</span><span class=\"n\">upper</span><span class=\"p\">())</span>\n            <span class=\"k\">except</span> <span class=\"ne\">AttributeError</span><span class=\"p\">:</span>\n                <span class=\"n\">levels</span> <span class=\"o\">=</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">constants</span><span class=\"o\">.</span><span class=\"n\">DEFAULT_TAGS</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">()</span>\n                <span class=\"n\">levels_repr</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;, &quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"s2\">&quot;`</span><span class=\"si\">%s</span><span class=\"s2\">`&quot;</span> <span class=\"o\">%</span> <span class=\"n\">level</span> <span class=\"k\">for</span> <span class=\"n\">level</span> <span class=\"ow\">in</span> <span class=\"n\">levels</span><span class=\"p\">)</span>\n                <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;Bad message level string: `</span><span class=\"si\">%s</span><span class=\"s2\">`. Possible values are: </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span>\n                    <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">level</span><span class=\"p\">,</span> <span class=\"n\">levels_repr</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n\n        <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">add_message</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">level</span><span class=\"p\">,</span> <span class=\"n\">message</span><span class=\"p\">,</span> <span class=\"n\">extra_tags</span><span class=\"o\">=</span><span class=\"n\">extra_tags</span><span class=\"p\">,</span> <span class=\"n\">fail_silently</span><span class=\"o\">=</span><span class=\"n\">fail_silently</span>\n        <span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">save_form</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Given a ModelForm return an unsaved instance. ``change`` is True if</span>\n<span class=\"sd\">        the object is being changed, and False if it&#39;s being added.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"n\">commit</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.save_model\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.save_model\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">save_model</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Given a model instance save it to the database.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.delete_model\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.delete_model\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">delete_model</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Given a model instance delete it from the database.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.delete_queryset\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.delete_queryset\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">delete_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Given a queryset, delete it from the database.&quot;&quot;&quot;</span>\n        <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">delete</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.save_formset\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.save_formset\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">save_formset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formset</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Given an inline formset save it to the database.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">()</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.save_related\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.save_related\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">save_related</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Given the ``HttpRequest``, the parent ``ModelForm`` instance, the</span>\n<span class=\"sd\">        list of inline formsets and a boolean value based on whether the</span>\n<span class=\"sd\">        parent is being added or changed, save the related objects to the</span>\n<span class=\"sd\">        database. Note that at this point save_form() and save_model() have</span>\n<span class=\"sd\">        already been called.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">save_m2m</span><span class=\"p\">()</span>\n        <span class=\"k\">for</span> <span class=\"n\">formset</span> <span class=\"ow\">in</span> <span class=\"n\">formsets</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_formset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formset</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"n\">change</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">render_change_form</span><span class=\"p\">(</span>\n        <span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">add</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span>\n    <span class=\"p\">):</span>\n        <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span>\n        <span class=\"n\">preserved_filters</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">form_url</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n            <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">},</span> <span class=\"n\">form_url</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">view_on_site_url</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_view_on_site_url</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">has_editable_inline_admin_formsets</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"k\">for</span> <span class=\"n\">inline</span> <span class=\"ow\">in</span> <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s2\">&quot;inline_admin_formsets&quot;</span><span class=\"p\">]:</span>\n            <span class=\"k\">if</span> <span class=\"p\">(</span>\n                <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span>\n                <span class=\"ow\">or</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span>\n                <span class=\"ow\">or</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span>\n            <span class=\"p\">):</span>\n                <span class=\"n\">has_editable_inline_admin_formsets</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n                <span class=\"k\">break</span>\n        <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span>\n            <span class=\"p\">{</span>\n                <span class=\"s2\">&quot;add&quot;</span><span class=\"p\">:</span> <span class=\"n\">add</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;change&quot;</span><span class=\"p\">:</span> <span class=\"n\">change</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;has_view_permission&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;has_add_permission&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;has_change_permission&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;has_delete_permission&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;has_editable_inline_admin_formsets&quot;</span><span class=\"p\">:</span> <span class=\"p\">(</span>\n                    <span class=\"n\">has_editable_inline_admin_formsets</span>\n                <span class=\"p\">),</span>\n                <span class=\"s2\">&quot;has_file_field&quot;</span><span class=\"p\">:</span> <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s2\">&quot;adminform&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_multipart</span><span class=\"p\">()</span>\n                <span class=\"ow\">or</span> <span class=\"nb\">any</span><span class=\"p\">(</span>\n                    <span class=\"n\">admin_formset</span><span class=\"o\">.</span><span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">is_multipart</span><span class=\"p\">()</span>\n                    <span class=\"k\">for</span> <span class=\"n\">admin_formset</span> <span class=\"ow\">in</span> <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s2\">&quot;inline_admin_formsets&quot;</span><span class=\"p\">]</span>\n                <span class=\"p\">),</span>\n                <span class=\"s2\">&quot;has_absolute_url&quot;</span><span class=\"p\">:</span> <span class=\"n\">view_on_site_url</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;absolute_url&quot;</span><span class=\"p\">:</span> <span class=\"n\">view_on_site_url</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;form_url&quot;</span><span class=\"p\">:</span> <span class=\"n\">form_url</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;content_type_id&quot;</span><span class=\"p\">:</span> <span class=\"n\">get_content_type_for_model</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;save_as&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_as</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;save_on_top&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_on_top</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;to_field_var&quot;</span><span class=\"p\">:</span> <span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;is_popup_var&quot;</span><span class=\"p\">:</span> <span class=\"n\">IS_POPUP_VAR</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;app_label&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_label</span><span class=\"p\">,</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">add</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_form_template</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">form_template</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">add_form_template</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">form_template</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">change_form_template</span>\n\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span>\n            <span class=\"n\">form_template</span>\n            <span class=\"ow\">or</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/</span><span class=\"si\">%s</span><span class=\"s2\">/change_form.html&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/change_form.html&quot;</span> <span class=\"o\">%</span> <span class=\"n\">app_label</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;admin/change_form.html&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">],</span>\n            <span class=\"n\">context</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.response_add\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.response_add\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">response_add</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">post_url_continue</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Determine the HttpResponse for the add_view stage.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">_meta</span>\n        <span class=\"n\">preserved_filters</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">obj_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_change&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n            <span class=\"n\">args</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">quote</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">),),</span>\n            <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"c1\"># Add a link to the object&#39;s change form if the user can edit the obj.</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n            <span class=\"n\">obj_repr</span> <span class=\"o\">=</span> <span class=\"n\">format_html</span><span class=\"p\">(</span><span class=\"s1\">&#39;&lt;a href=&quot;</span><span class=\"si\">{}</span><span class=\"s1\">&quot;&gt;</span><span class=\"si\">{}</span><span class=\"s1\">&lt;/a&gt;&#39;</span><span class=\"p\">,</span> <span class=\"n\">urlquote</span><span class=\"p\">(</span><span class=\"n\">obj_url</span><span class=\"p\">),</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">obj_repr</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">msg_dict</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;obj&quot;</span><span class=\"p\">:</span> <span class=\"n\">obj_repr</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n        <span class=\"c1\"># Here, we distinguish between different save types by checking for</span>\n        <span class=\"c1\"># the presence of keys in request.POST.</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">to_field</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">to_field</span><span class=\"p\">:</span>\n                <span class=\"n\">attr</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">to_field</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">attr</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"o\">.</span><span class=\"n\">attname</span>\n            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">serializable_value</span><span class=\"p\">(</span><span class=\"n\">attr</span><span class=\"p\">)</span>\n            <span class=\"n\">popup_response_data</span> <span class=\"o\">=</span> <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;value&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">),</span>\n                    <span class=\"s2\">&quot;obj&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">),</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"p\">,</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">popup_response_template</span>\n                <span class=\"ow\">or</span> <span class=\"p\">[</span>\n                    <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/</span><span class=\"si\">%s</span><span class=\"s2\">/popup_response.html&quot;</span>\n                    <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                    <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/popup_response.html&quot;</span> <span class=\"o\">%</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;admin/popup_response.html&quot;</span><span class=\"p\">,</span>\n                <span class=\"p\">],</span>\n                <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;popup_response_data&quot;</span><span class=\"p\">:</span> <span class=\"n\">popup_response_data</span><span class=\"p\">,</span>\n                <span class=\"p\">},</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">elif</span> <span class=\"s2\">&quot;_continue&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span> <span class=\"ow\">or</span> <span class=\"p\">(</span>\n            <span class=\"c1\"># Redirecting after &quot;Save as new&quot;.</span>\n            <span class=\"s2\">&quot;_saveasnew&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n            <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_as_continue</span>\n            <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;The </span><span class=\"si\">{name}</span><span class=\"s2\"> \u201c</span><span class=\"si\">{obj}</span><span class=\"s2\">\u201d was added successfully.&quot;</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n                <span class=\"n\">msg</span> <span class=\"o\">+=</span> <span class=\"s2\">&quot; &quot;</span> <span class=\"o\">+</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;You may edit it again below.&quot;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">format_html</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">msg_dict</span><span class=\"p\">),</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">post_url_continue</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"n\">post_url_continue</span> <span class=\"o\">=</span> <span class=\"n\">obj_url</span>\n            <span class=\"n\">post_url_continue</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"p\">},</span>\n                <span class=\"n\">post_url_continue</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">post_url_continue</span><span class=\"p\">)</span>\n\n        <span class=\"k\">elif</span> <span class=\"s2\">&quot;_addanother&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">format_html</span><span class=\"p\">(</span>\n                <span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;The </span><span class=\"si\">{name}</span><span class=\"s2\"> \u201c</span><span class=\"si\">{obj}</span><span class=\"s2\">\u201d was added successfully. You may add another &quot;</span>\n                    <span class=\"s2\">&quot;</span><span class=\"si\">{name}</span><span class=\"s2\"> below.&quot;</span>\n                <span class=\"p\">),</span>\n                <span class=\"o\">**</span><span class=\"n\">msg_dict</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">path</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"p\">},</span> <span class=\"n\">redirect_url</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">redirect_url</span><span class=\"p\">)</span>\n\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">format_html</span><span class=\"p\">(</span>\n                <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;The </span><span class=\"si\">{name}</span><span class=\"s2\"> \u201c</span><span class=\"si\">{obj}</span><span class=\"s2\">\u201d was added successfully.&quot;</span><span class=\"p\">),</span> <span class=\"o\">**</span><span class=\"n\">msg_dict</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">response_post_save_add</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.response_change\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.response_change\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">response_change</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Determine the HttpResponse for the change_view stage.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">_meta</span>\n            <span class=\"n\">to_field</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">)</span>\n            <span class=\"n\">attr</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">to_field</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">to_field</span> <span class=\"k\">else</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"o\">.</span><span class=\"n\">attname</span>\n            <span class=\"n\">value</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">resolver_match</span><span class=\"o\">.</span><span class=\"n\">kwargs</span><span class=\"p\">[</span><span class=\"s2\">&quot;object_id&quot;</span><span class=\"p\">]</span>\n            <span class=\"n\">new_value</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">serializable_value</span><span class=\"p\">(</span><span class=\"n\">attr</span><span class=\"p\">)</span>\n            <span class=\"n\">popup_response_data</span> <span class=\"o\">=</span> <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;action&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;change&quot;</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;value&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">value</span><span class=\"p\">),</span>\n                    <span class=\"s2\">&quot;obj&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">),</span>\n                    <span class=\"s2\">&quot;new_value&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">new_value</span><span class=\"p\">),</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"p\">,</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">popup_response_template</span>\n                <span class=\"ow\">or</span> <span class=\"p\">[</span>\n                    <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/</span><span class=\"si\">%s</span><span class=\"s2\">/popup_response.html&quot;</span>\n                    <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                    <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/popup_response.html&quot;</span> <span class=\"o\">%</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;admin/popup_response.html&quot;</span><span class=\"p\">,</span>\n                <span class=\"p\">],</span>\n                <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;popup_response_data&quot;</span><span class=\"p\">:</span> <span class=\"n\">popup_response_data</span><span class=\"p\">,</span>\n                <span class=\"p\">},</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span>\n        <span class=\"n\">preserved_filters</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n        <span class=\"n\">msg_dict</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;obj&quot;</span><span class=\"p\">:</span> <span class=\"n\">format_html</span><span class=\"p\">(</span><span class=\"s1\">&#39;&lt;a href=&quot;</span><span class=\"si\">{}</span><span class=\"s1\">&quot;&gt;</span><span class=\"si\">{}</span><span class=\"s1\">&lt;/a&gt;&#39;</span><span class=\"p\">,</span> <span class=\"n\">urlquote</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">path</span><span class=\"p\">),</span> <span class=\"n\">obj</span><span class=\"p\">),</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;_continue&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">format_html</span><span class=\"p\">(</span>\n                <span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;The </span><span class=\"si\">{name}</span><span class=\"s2\"> \u201c</span><span class=\"si\">{obj}</span><span class=\"s2\">\u201d was changed successfully. You may edit it &quot;</span>\n                    <span class=\"s2\">&quot;again below.&quot;</span>\n                <span class=\"p\">),</span>\n                <span class=\"o\">**</span><span class=\"n\">msg_dict</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">path</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"p\">},</span> <span class=\"n\">redirect_url</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">redirect_url</span><span class=\"p\">)</span>\n\n        <span class=\"k\">elif</span> <span class=\"s2\">&quot;_saveasnew&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">format_html</span><span class=\"p\">(</span>\n                <span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;The </span><span class=\"si\">{name}</span><span class=\"s2\"> \u201c</span><span class=\"si\">{obj}</span><span class=\"s2\">\u201d was added successfully. You may edit it again &quot;</span>\n                    <span class=\"s2\">&quot;below.&quot;</span>\n                <span class=\"p\">),</span>\n                <span class=\"o\">**</span><span class=\"n\">msg_dict</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_change&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                <span class=\"n\">args</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"p\">,),</span>\n                <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"p\">},</span> <span class=\"n\">redirect_url</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">redirect_url</span><span class=\"p\">)</span>\n\n        <span class=\"k\">elif</span> <span class=\"s2\">&quot;_addanother&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">format_html</span><span class=\"p\">(</span>\n                <span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;The </span><span class=\"si\">{name}</span><span class=\"s2\"> \u201c</span><span class=\"si\">{obj}</span><span class=\"s2\">\u201d was changed successfully. You may add another &quot;</span>\n                    <span class=\"s2\">&quot;</span><span class=\"si\">{name}</span><span class=\"s2\"> below.&quot;</span>\n                <span class=\"p\">),</span>\n                <span class=\"o\">**</span><span class=\"n\">msg_dict</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_add&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">redirect_url</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"p\">},</span> <span class=\"n\">redirect_url</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">redirect_url</span><span class=\"p\">)</span>\n\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">format_html</span><span class=\"p\">(</span>\n                <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;The </span><span class=\"si\">{name}</span><span class=\"s2\"> \u201c</span><span class=\"si\">{obj}</span><span class=\"s2\">\u201d was changed successfully.&quot;</span><span class=\"p\">),</span> <span class=\"o\">**</span><span class=\"n\">msg_dict</span>\n            <span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">response_post_save_change</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_response_post_save</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_or_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n            <span class=\"n\">post_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_changelist&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">preserved_filters</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"n\">post_url</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">},</span> <span class=\"n\">post_url</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">post_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:index&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">post_url</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">response_post_save_add</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Figure out where to redirect after the &#39;Save&#39; button has been pressed</span>\n<span class=\"sd\">        when adding a new object.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_response_post_save</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">response_post_save_change</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Figure out where to redirect after the &#39;Save&#39; button has been pressed</span>\n<span class=\"sd\">        when editing an existing object.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_response_post_save</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">response_action</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Handle an admin action. This is called if a request is POSTed to the</span>\n<span class=\"sd\">        changelist; it returns an HttpResponse if the action was handled, and</span>\n<span class=\"sd\">        None otherwise.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"c1\"># There can be multiple action forms on the page (at the top</span>\n        <span class=\"c1\"># and bottom of the change list, for example). Get the action</span>\n        <span class=\"c1\"># whose button was pushed.</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">action_index</span> <span class=\"o\">=</span> <span class=\"nb\">int</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;index&quot;</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">))</span>\n        <span class=\"k\">except</span> <span class=\"ne\">ValueError</span><span class=\"p\">:</span>\n            <span class=\"n\">action_index</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n        <span class=\"c1\"># Construct the action form.</span>\n        <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">()</span>\n        <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">ACTION_CHECKBOX_NAME</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s2\">&quot;index&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Use the action whose button was pushed</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">({</span><span class=\"s2\">&quot;action&quot;</span><span class=\"p\">:</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">getlist</span><span class=\"p\">(</span><span class=\"s2\">&quot;action&quot;</span><span class=\"p\">)[</span><span class=\"n\">action_index</span><span class=\"p\">]})</span>\n        <span class=\"k\">except</span> <span class=\"ne\">IndexError</span><span class=\"p\">:</span>\n            <span class=\"c1\"># If we didn&#39;t get an action from the chosen form that&#39;s invalid</span>\n            <span class=\"c1\"># POST data, so by deleting action it&#39;ll fail the validation check</span>\n            <span class=\"c1\"># below. So no need to do anything here</span>\n            <span class=\"k\">pass</span>\n\n        <span class=\"n\">action_form</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">action_form</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">auto_id</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n        <span class=\"n\">action_form</span><span class=\"o\">.</span><span class=\"n\">fields</span><span class=\"p\">[</span><span class=\"s2\">&quot;action&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">choices</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_action_choices</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># If the form&#39;s valid we can handle the action.</span>\n        <span class=\"k\">if</span> <span class=\"n\">action_form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n            <span class=\"n\">action</span> <span class=\"o\">=</span> <span class=\"n\">action_form</span><span class=\"o\">.</span><span class=\"n\">cleaned_data</span><span class=\"p\">[</span><span class=\"s2\">&quot;action&quot;</span><span class=\"p\">]</span>\n            <span class=\"n\">select_across</span> <span class=\"o\">=</span> <span class=\"n\">action_form</span><span class=\"o\">.</span><span class=\"n\">cleaned_data</span><span class=\"p\">[</span><span class=\"s2\">&quot;select_across&quot;</span><span class=\"p\">]</span>\n            <span class=\"n\">func</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_actions</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)[</span><span class=\"n\">action</span><span class=\"p\">][</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n\n            <span class=\"c1\"># Get the list of selected PKs. If nothing&#39;s selected, we can&#39;t</span>\n            <span class=\"c1\"># perform an action on it, so bail. Except we want to perform</span>\n            <span class=\"c1\"># the action explicitly on all objects.</span>\n            <span class=\"n\">selected</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">getlist</span><span class=\"p\">(</span><span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">ACTION_CHECKBOX_NAME</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">selected</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">select_across</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Reminder that something needs to be selected or nothing will happen</span>\n                <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;Items must be selected in order to perform &quot;</span>\n                    <span class=\"s2\">&quot;actions on them. No items have been changed.&quot;</span>\n                <span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">WARNING</span><span class=\"p\">)</span>\n                <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">select_across</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Perform the action only on the selected objects</span>\n                <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">pk__in</span><span class=\"o\">=</span><span class=\"n\">selected</span><span class=\"p\">)</span>\n\n            <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"n\">func</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"p\">)</span>\n\n            <span class=\"c1\"># Actions may return an HttpResponse-like object, which will be</span>\n            <span class=\"c1\"># used as the response from the POST. If not, we&#39;ll be a good</span>\n            <span class=\"c1\"># little HTTP citizen and redirect back to the changelist page.</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">,</span> <span class=\"n\">HttpResponseBase</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"n\">response</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">get_full_path</span><span class=\"p\">())</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;No action selected.&quot;</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">WARNING</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.response_delete\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.response_delete\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">response_delete</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj_display</span><span class=\"p\">,</span> <span class=\"n\">obj_id</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Determine the HttpResponse for the delete_view stage.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">popup_response_data</span> <span class=\"o\">=</span> <span class=\"n\">json</span><span class=\"o\">.</span><span class=\"n\">dumps</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;action&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;delete&quot;</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;value&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj_id</span><span class=\"p\">),</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"p\">,</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">popup_response_template</span>\n                <span class=\"ow\">or</span> <span class=\"p\">[</span>\n                    <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/</span><span class=\"si\">%s</span><span class=\"s2\">/popup_response.html&quot;</span>\n                    <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                    <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/popup_response.html&quot;</span> <span class=\"o\">%</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;admin/popup_response.html&quot;</span><span class=\"p\">,</span>\n                <span class=\"p\">],</span>\n                <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;popup_response_data&quot;</span><span class=\"p\">:</span> <span class=\"n\">popup_response_data</span><span class=\"p\">,</span>\n                <span class=\"p\">},</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span>\n            <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;The </span><span class=\"si\">%(name)s</span><span class=\"s2\"> \u201c</span><span class=\"si\">%(obj)s</span><span class=\"s2\">\u201d was deleted successfully.&quot;</span><span class=\"p\">)</span>\n            <span class=\"o\">%</span> <span class=\"p\">{</span>\n                <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;obj&quot;</span><span class=\"p\">:</span> <span class=\"n\">obj_display</span><span class=\"p\">,</span>\n            <span class=\"p\">},</span>\n            <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n            <span class=\"n\">post_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_changelist&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">preserved_filters</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"n\">post_url</span> <span class=\"o\">=</span> <span class=\"n\">add_preserved_filters</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span><span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"n\">preserved_filters</span><span class=\"p\">,</span> <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">},</span> <span class=\"n\">post_url</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">post_url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:index&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">post_url</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">render_delete_form</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">):</span>\n        <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span>\n\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span>\n            <span class=\"n\">to_field_var</span><span class=\"o\">=</span><span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">,</span>\n            <span class=\"n\">is_popup_var</span><span class=\"o\">=</span><span class=\"n\">IS_POPUP_VAR</span><span class=\"p\">,</span>\n            <span class=\"n\">media</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">media</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">delete_confirmation_template</span>\n            <span class=\"ow\">or</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">{}</span><span class=\"s2\">/</span><span class=\"si\">{}</span><span class=\"s2\">/delete_confirmation.html&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span>\n                    <span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span>\n                <span class=\"p\">),</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">{}</span><span class=\"s2\">/delete_confirmation.html&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;admin/delete_confirmation.html&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">],</span>\n            <span class=\"n\">context</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_inline_formsets</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">inline_instances</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"c1\"># Edit permissions on parent model are required for editable inlines.</span>\n        <span class=\"n\">can_edit_parent</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">obj</span>\n            <span class=\"k\">else</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">inline_admin_formsets</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">inline</span><span class=\"p\">,</span> <span class=\"n\">formset</span> <span class=\"ow\">in</span> <span class=\"nb\">zip</span><span class=\"p\">(</span><span class=\"n\">inline_instances</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">):</span>\n            <span class=\"n\">fieldsets</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">get_fieldsets</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">))</span>\n            <span class=\"n\">readonly</span> <span class=\"o\">=</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">get_readonly_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">))</span>\n            <span class=\"k\">if</span> <span class=\"n\">can_edit_parent</span><span class=\"p\">:</span>\n                <span class=\"n\">has_add_permission</span> <span class=\"o\">=</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n                <span class=\"n\">has_change_permission</span> <span class=\"o\">=</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n                <span class=\"n\">has_delete_permission</span> <span class=\"o\">=</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"c1\"># Disable all edit-permissions, and override formset settings.</span>\n                <span class=\"n\">has_add_permission</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n                    <span class=\"n\">has_change_permission</span>\n                <span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"n\">has_delete_permission</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n                <span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">extra</span> <span class=\"o\">=</span> <span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">max_num</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n            <span class=\"n\">has_view_permission</span> <span class=\"o\">=</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_view_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"n\">prepopulated</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">get_prepopulated_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">))</span>\n            <span class=\"n\">inline_admin_formset</span> <span class=\"o\">=</span> <span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">InlineAdminFormSet</span><span class=\"p\">(</span>\n                <span class=\"n\">inline</span><span class=\"p\">,</span>\n                <span class=\"n\">formset</span><span class=\"p\">,</span>\n                <span class=\"n\">fieldsets</span><span class=\"p\">,</span>\n                <span class=\"n\">prepopulated</span><span class=\"p\">,</span>\n                <span class=\"n\">readonly</span><span class=\"p\">,</span>\n                <span class=\"n\">model_admin</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"p\">,</span>\n                <span class=\"n\">has_add_permission</span><span class=\"o\">=</span><span class=\"n\">has_add_permission</span><span class=\"p\">,</span>\n                <span class=\"n\">has_change_permission</span><span class=\"o\">=</span><span class=\"n\">has_change_permission</span><span class=\"p\">,</span>\n                <span class=\"n\">has_delete_permission</span><span class=\"o\">=</span><span class=\"n\">has_delete_permission</span><span class=\"p\">,</span>\n                <span class=\"n\">has_view_permission</span><span class=\"o\">=</span><span class=\"n\">has_view_permission</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">inline_admin_formsets</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">inline_admin_formset</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">inline_admin_formsets</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_changeform_initial_data\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_changeform_initial_data\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_changeform_initial_data</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Get the initial form data from the request&#39;s GET params.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">initial</span> <span class=\"o\">=</span> <span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">())</span>\n        <span class=\"k\">for</span> <span class=\"n\">k</span> <span class=\"ow\">in</span> <span class=\"n\">initial</span><span class=\"p\">:</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">get_field</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"n\">FieldDoesNotExist</span><span class=\"p\">:</span>\n                <span class=\"k\">continue</span>\n            <span class=\"c1\"># We have to special-case M2Ms as a list of comma-separated PKs.</span>\n            <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ManyToManyField</span><span class=\"p\">):</span>\n                <span class=\"n\">initial</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">initial</span><span class=\"p\">[</span><span class=\"n\">k</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"s2\">&quot;,&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">initial</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_obj_does_not_exist_redirect</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Create a message informing the user that the object doesn&#39;t exist</span>\n<span class=\"sd\">        and return a redirect to the admin index page.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%(name)s</span><span class=\"s2\"> with ID \u201c</span><span class=\"si\">%(key)s</span><span class=\"s2\">\u201d doesn\u2019t exist. Perhaps it was deleted?&quot;</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;key&quot;</span><span class=\"p\">:</span> <span class=\"n\">unquote</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">),</span>\n        <span class=\"p\">}</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">WARNING</span><span class=\"p\">)</span>\n        <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:index&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@csrf_protect_m</span>\n    <span class=\"k\">def</span> <span class=\"nf\">changeform_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">with</span> <span class=\"n\">transaction</span><span class=\"o\">.</span><span class=\"n\">atomic</span><span class=\"p\">(</span><span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">router</span><span class=\"o\">.</span><span class=\"n\">db_for_write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)):</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_changeform_view</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_changeform_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"p\">):</span>\n        <span class=\"n\">to_field</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">to_field</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">to_field_allowed</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">to_field</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">DisallowedModelAdminToField</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;The field </span><span class=\"si\">%s</span><span class=\"s2\"> cannot be referenced.&quot;</span> <span class=\"o\">%</span> <span class=\"n\">to_field</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span> <span class=\"ow\">and</span> <span class=\"s2\">&quot;_saveasnew&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"n\">object_id</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"n\">add</span> <span class=\"o\">=</span> <span class=\"n\">object_id</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">add</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n                <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n            <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_object</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">unquote</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">),</span> <span class=\"n\">to_field</span><span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n                    <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_or_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n                    <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">obj</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_obj_does_not_exist_redirect</span><span class=\"p\">(</span>\n                    <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span> <span class=\"n\">object_id</span>\n                <span class=\"p\">)</span>\n\n        <span class=\"n\">fieldsets</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_fieldsets</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">ModelForm</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_form</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"ow\">not</span> <span class=\"n\">add</span><span class=\"p\">,</span> <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"n\">flatten_fieldsets</span><span class=\"p\">(</span><span class=\"n\">fieldsets</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n            <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">ModelForm</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">FILES</span><span class=\"p\">,</span> <span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">inline_instances</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_formsets</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"p\">,</span>\n                <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"p\">,</span>\n                <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"ow\">not</span> <span class=\"n\">add</span><span class=\"p\">,</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">form_validated</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"n\">form_validated</span><span class=\"p\">:</span>\n                <span class=\"n\">new_object</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_form</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"ow\">not</span> <span class=\"n\">add</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">new_object</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">instance</span>\n            <span class=\"k\">if</span> <span class=\"n\">all_valid</span><span class=\"p\">(</span><span class=\"n\">formsets</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"n\">form_validated</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_model</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">new_object</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"ow\">not</span> <span class=\"n\">add</span><span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_related</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"ow\">not</span> <span class=\"n\">add</span><span class=\"p\">)</span>\n                <span class=\"n\">change_message</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">construct_change_message</span><span class=\"p\">(</span>\n                    <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">add</span>\n                <span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"n\">add</span><span class=\"p\">:</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">log_addition</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">new_object</span><span class=\"p\">,</span> <span class=\"n\">change_message</span><span class=\"p\">)</span>\n                    <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">response_add</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">new_object</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">log_change</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">new_object</span><span class=\"p\">,</span> <span class=\"n\">change_message</span><span class=\"p\">)</span>\n                    <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">response_change</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">new_object</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">form_validated</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">add</span><span class=\"p\">:</span>\n                <span class=\"n\">initial</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_changeform_initial_data</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n                <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">ModelForm</span><span class=\"p\">(</span><span class=\"n\">initial</span><span class=\"o\">=</span><span class=\"n\">initial</span><span class=\"p\">)</span>\n                <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">inline_instances</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_formsets</span><span class=\"p\">(</span>\n                    <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"kc\">False</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">form</span> <span class=\"o\">=</span> <span class=\"n\">ModelForm</span><span class=\"p\">(</span><span class=\"n\">instance</span><span class=\"o\">=</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n                <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">inline_instances</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_create_formsets</span><span class=\"p\">(</span>\n                    <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"kc\">True</span>\n                <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">add</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n            <span class=\"n\">readonly_fields</span> <span class=\"o\">=</span> <span class=\"n\">flatten_fieldsets</span><span class=\"p\">(</span><span class=\"n\">fieldsets</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">readonly_fields</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_readonly_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">admin_form</span> <span class=\"o\">=</span> <span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">AdminForm</span><span class=\"p\">(</span>\n            <span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">fieldsets</span><span class=\"p\">),</span>\n            <span class=\"c1\"># Clear prepopulated fields on a view-only form to avoid a crash.</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_prepopulated_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">add</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span> <span class=\"p\">{},</span>\n            <span class=\"n\">readonly_fields</span><span class=\"p\">,</span>\n            <span class=\"n\">model_admin</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n        <span class=\"n\">media</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">media</span> <span class=\"o\">+</span> <span class=\"n\">admin_form</span><span class=\"o\">.</span><span class=\"n\">media</span>\n\n        <span class=\"n\">inline_formsets</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_inline_formsets</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">inline_instances</span><span class=\"p\">,</span> <span class=\"n\">obj</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">inline_formset</span> <span class=\"ow\">in</span> <span class=\"n\">inline_formsets</span><span class=\"p\">:</span>\n            <span class=\"n\">media</span> <span class=\"o\">+=</span> <span class=\"n\">inline_formset</span><span class=\"o\">.</span><span class=\"n\">media</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">add</span><span class=\"p\">:</span>\n            <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Add </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">elif</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n            <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Change </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;View </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"n\">title</span> <span class=\"o\">%</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;subtitle&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">obj</span> <span class=\"k\">else</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;adminform&quot;</span><span class=\"p\">:</span> <span class=\"n\">admin_form</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;object_id&quot;</span><span class=\"p\">:</span> <span class=\"n\">object_id</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;original&quot;</span><span class=\"p\">:</span> <span class=\"n\">obj</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;is_popup&quot;</span><span class=\"p\">:</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span> <span class=\"ow\">or</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;to_field&quot;</span><span class=\"p\">:</span> <span class=\"n\">to_field</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;media&quot;</span><span class=\"p\">:</span> <span class=\"n\">media</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;inline_admin_formsets&quot;</span><span class=\"p\">:</span> <span class=\"n\">inline_formsets</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;errors&quot;</span><span class=\"p\">:</span> <span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">AdminErrorList</span><span class=\"p\">(</span><span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"c1\"># Hide the &quot;Save&quot; and &quot;Save and continue&quot; buttons if &quot;Save as New&quot; was</span>\n        <span class=\"c1\"># previously chosen to prevent the interface from getting confusing.</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span>\n            <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">form_validated</span>\n            <span class=\"ow\">and</span> <span class=\"s2\">&quot;_saveasnew&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s2\">&quot;show_save&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"s2\">&quot;show_save_and_continue&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n            <span class=\"c1\"># Use the change template instead of the add template.</span>\n            <span class=\"n\">add</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n        <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{})</span>\n\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">render_change_form</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">,</span> <span class=\"n\">add</span><span class=\"o\">=</span><span class=\"n\">add</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"ow\">not</span> <span class=\"n\">add</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"o\">=</span><span class=\"n\">form_url</span>\n        <span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.add_view\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.add_view\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">changeform_view</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.change_view\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.change_view\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">change_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"o\">=</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">changeform_view</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">form_url</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_edited_object_pks</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Return POST data values of list_editable primary keys.&quot;&quot;&quot;</span>\n        <span class=\"n\">pk_pattern</span> <span class=\"o\">=</span> <span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">compile</span><span class=\"p\">(</span>\n            <span class=\"sa\">r</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\">-\\d+-</span><span class=\"si\">{}</span><span class=\"s2\">$&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">re</span><span class=\"o\">.</span><span class=\"n\">escape</span><span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">),</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">value</span> <span class=\"k\">for</span> <span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">value</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span> <span class=\"k\">if</span> <span class=\"n\">pk_pattern</span><span class=\"o\">.</span><span class=\"n\">match</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">)]</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_list_editable_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Based on POST data, return a queryset of the objects that were edited</span>\n<span class=\"sd\">        via list_editable.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">object_pks</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_edited_object_pks</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"p\">)</span>\n        <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"n\">validate</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"o\">.</span><span class=\"n\">to_python</span>\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"k\">for</span> <span class=\"n\">pk</span> <span class=\"ow\">in</span> <span class=\"n\">object_pks</span><span class=\"p\">:</span>\n                <span class=\"n\">validate</span><span class=\"p\">(</span><span class=\"n\">pk</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"n\">ValidationError</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Disable the optimization if the POST data was tampered with.</span>\n            <span class=\"k\">return</span> <span class=\"n\">queryset</span>\n        <span class=\"k\">return</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"n\">pk__in</span><span class=\"o\">=</span><span class=\"n\">object_pks</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.changelist_view\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.changelist_view\">[docs]</a>    <span class=\"nd\">@csrf_protect_m</span>\n    <span class=\"k\">def</span> <span class=\"nf\">changelist_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        The &#39;change list&#39; admin view for this model.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.views.main</span> <span class=\"kn\">import</span> <span class=\"n\">ERROR_FLAG</span>\n\n        <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_or_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n\n        <span class=\"k\">try</span><span class=\"p\">:</span>\n            <span class=\"n\">cl</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_changelist_instance</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"k\">except</span> <span class=\"n\">IncorrectLookupParameters</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Wacky lookup parameters were given, so redirect to the main</span>\n            <span class=\"c1\"># changelist page, without parameters, and pass an &#39;invalid=1&#39;</span>\n            <span class=\"c1\"># parameter via the query string. If wacky parameters were given</span>\n            <span class=\"c1\"># and the &#39;invalid=1&#39; parameter was already in the query string,</span>\n            <span class=\"c1\"># something is screwed up with the database, so display an error</span>\n            <span class=\"c1\"># page.</span>\n            <span class=\"k\">if</span> <span class=\"n\">ERROR_FLAG</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"p\">:</span>\n                <span class=\"k\">return</span> <span class=\"n\">SimpleTemplateResponse</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;admin/invalid_setup.html&quot;</span><span class=\"p\">,</span>\n                    <span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Database error&quot;</span><span class=\"p\">),</span>\n                    <span class=\"p\">},</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">path</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;?&quot;</span> <span class=\"o\">+</span> <span class=\"n\">ERROR_FLAG</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;=1&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># If the request was POSTed, this might be a bulk action or a bulk</span>\n        <span class=\"c1\"># edit. Try to look up an action or confirmation first, but if this</span>\n        <span class=\"c1\"># isn&#39;t an action the POST will fall through to the bulk edit check,</span>\n        <span class=\"c1\"># below.</span>\n        <span class=\"n\">action_failed</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n        <span class=\"n\">selected</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">getlist</span><span class=\"p\">(</span><span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">ACTION_CHECKBOX_NAME</span><span class=\"p\">)</span>\n\n        <span class=\"n\">actions</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_actions</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"c1\"># Actions with no confirmation</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"n\">actions</span>\n            <span class=\"ow\">and</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span>\n            <span class=\"ow\">and</span> <span class=\"s2\">&quot;index&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n            <span class=\"ow\">and</span> <span class=\"s2\">&quot;_save&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n        <span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">selected</span><span class=\"p\">:</span>\n                <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">response_action</span><span class=\"p\">(</span>\n                    <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"o\">=</span><span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"n\">response</span><span class=\"p\">:</span>\n                    <span class=\"k\">return</span> <span class=\"n\">response</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">action_failed</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;Items must be selected in order to perform &quot;</span>\n                    <span class=\"s2\">&quot;actions on them. No items have been changed.&quot;</span>\n                <span class=\"p\">)</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">WARNING</span><span class=\"p\">)</span>\n                <span class=\"n\">action_failed</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n        <span class=\"c1\"># Actions with confirmation</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"n\">actions</span>\n            <span class=\"ow\">and</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span>\n            <span class=\"ow\">and</span> <span class=\"n\">helpers</span><span class=\"o\">.</span><span class=\"n\">ACTION_CHECKBOX_NAME</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n            <span class=\"ow\">and</span> <span class=\"s2\">&quot;index&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n            <span class=\"ow\">and</span> <span class=\"s2\">&quot;_save&quot;</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n        <span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"n\">selected</span><span class=\"p\">:</span>\n                <span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">response_action</span><span class=\"p\">(</span>\n                    <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"o\">=</span><span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n                <span class=\"p\">)</span>\n                <span class=\"k\">if</span> <span class=\"n\">response</span><span class=\"p\">:</span>\n                    <span class=\"k\">return</span> <span class=\"n\">response</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">action_failed</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">action_failed</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Redirect back to the changelist page to avoid resubmitting the</span>\n            <span class=\"c1\"># form if the user refreshes the browser or uses the &quot;No, take</span>\n            <span class=\"c1\"># me back&quot; button on the action confirmation page.</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">get_full_path</span><span class=\"p\">())</span>\n\n        <span class=\"c1\"># If we&#39;re allowing changelist editing, we need to construct a formset</span>\n        <span class=\"c1\"># for the changelist given all the fields to be edited. Then we&#39;ll</span>\n        <span class=\"c1\"># use the formset to validate/process POSTed data.</span>\n        <span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"c1\"># Handle POSTed bulk-edit data.</span>\n        <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span> <span class=\"ow\">and</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">list_editable</span> <span class=\"ow\">and</span> <span class=\"s2\">&quot;_save&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n                <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n            <span class=\"n\">FormSet</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_changelist_formset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"n\">modified_objects</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_list_editable_queryset</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">FormSet</span><span class=\"o\">.</span><span class=\"n\">get_default_prefix</span><span class=\"p\">()</span>\n            <span class=\"p\">)</span>\n            <span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"n\">FormSet</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">FILES</span><span class=\"p\">,</span> <span class=\"n\">queryset</span><span class=\"o\">=</span><span class=\"n\">modified_objects</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">():</span>\n                <span class=\"n\">changecount</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n                <span class=\"k\">with</span> <span class=\"n\">transaction</span><span class=\"o\">.</span><span class=\"n\">atomic</span><span class=\"p\">(</span><span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">router</span><span class=\"o\">.</span><span class=\"n\">db_for_write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)):</span>\n                    <span class=\"k\">for</span> <span class=\"n\">form</span> <span class=\"ow\">in</span> <span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">forms</span><span class=\"p\">:</span>\n                        <span class=\"k\">if</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">has_changed</span><span class=\"p\">():</span>\n                            <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_form</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n                            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_model</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n                            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">save_related</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"n\">formsets</span><span class=\"o\">=</span><span class=\"p\">[],</span> <span class=\"n\">change</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n                            <span class=\"n\">change_msg</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">construct_change_message</span><span class=\"p\">(</span>\n                                <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"kc\">None</span>\n                            <span class=\"p\">)</span>\n                            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">log_change</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">change_msg</span><span class=\"p\">)</span>\n                            <span class=\"n\">changecount</span> <span class=\"o\">+=</span> <span class=\"mi\">1</span>\n                <span class=\"k\">if</span> <span class=\"n\">changecount</span><span class=\"p\">:</span>\n                    <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">ngettext</span><span class=\"p\">(</span>\n                        <span class=\"s2\">&quot;</span><span class=\"si\">%(count)s</span><span class=\"s2\"> </span><span class=\"si\">%(name)s</span><span class=\"s2\"> was changed successfully.&quot;</span><span class=\"p\">,</span>\n                        <span class=\"s2\">&quot;</span><span class=\"si\">%(count)s</span><span class=\"s2\"> </span><span class=\"si\">%(name)s</span><span class=\"s2\"> were changed successfully.&quot;</span><span class=\"p\">,</span>\n                        <span class=\"n\">changecount</span><span class=\"p\">,</span>\n                    <span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"p\">{</span>\n                        <span class=\"s2\">&quot;count&quot;</span><span class=\"p\">:</span> <span class=\"n\">changecount</span><span class=\"p\">,</span>\n                        <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"n\">model_ngettext</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span> <span class=\"n\">changecount</span><span class=\"p\">),</span>\n                    <span class=\"p\">}</span>\n                    <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">message_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">messages</span><span class=\"o\">.</span><span class=\"n\">SUCCESS</span><span class=\"p\">)</span>\n\n                <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">get_full_path</span><span class=\"p\">())</span>\n\n        <span class=\"c1\"># Handle GET -- construct a formset for display.</span>\n        <span class=\"k\">elif</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">list_editable</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n            <span class=\"n\">FormSet</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_changelist_formset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"n\">FormSet</span><span class=\"p\">(</span><span class=\"n\">queryset</span><span class=\"o\">=</span><span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">result_list</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Build the list of media to be used by the formset.</span>\n        <span class=\"k\">if</span> <span class=\"n\">formset</span><span class=\"p\">:</span>\n            <span class=\"n\">media</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">media</span> <span class=\"o\">+</span> <span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">media</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">media</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">media</span>\n\n        <span class=\"c1\"># Build the action form and populate it with available actions.</span>\n        <span class=\"k\">if</span> <span class=\"n\">actions</span><span class=\"p\">:</span>\n            <span class=\"n\">action_form</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">action_form</span><span class=\"p\">(</span><span class=\"n\">auto_id</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span>\n            <span class=\"n\">action_form</span><span class=\"o\">.</span><span class=\"n\">fields</span><span class=\"p\">[</span><span class=\"s2\">&quot;action&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">choices</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_action_choices</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"n\">media</span> <span class=\"o\">+=</span> <span class=\"n\">action_form</span><span class=\"o\">.</span><span class=\"n\">media</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">action_form</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n        <span class=\"n\">selection_note_all</span> <span class=\"o\">=</span> <span class=\"n\">ngettext</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;</span><span class=\"si\">%(total_count)s</span><span class=\"s2\"> selected&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;All </span><span class=\"si\">%(total_count)s</span><span class=\"s2\"> selected&quot;</span><span class=\"p\">,</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">result_count</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;module_name&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name_plural</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;selection_note&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;0 of </span><span class=\"si\">%(cnt)s</span><span class=\"s2\"> selected&quot;</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"p\">{</span><span class=\"s2\">&quot;cnt&quot;</span><span class=\"p\">:</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">result_list</span><span class=\"p\">)},</span>\n            <span class=\"s2\">&quot;selection_note_all&quot;</span><span class=\"p\">:</span> <span class=\"n\">selection_note_all</span> <span class=\"o\">%</span> <span class=\"p\">{</span><span class=\"s2\">&quot;total_count&quot;</span><span class=\"p\">:</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">result_count</span><span class=\"p\">},</span>\n            <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">title</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;subtitle&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;is_popup&quot;</span><span class=\"p\">:</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">is_popup</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;to_field&quot;</span><span class=\"p\">:</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">to_field</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;cl&quot;</span><span class=\"p\">:</span> <span class=\"n\">cl</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;media&quot;</span><span class=\"p\">:</span> <span class=\"n\">media</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;has_add_permission&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"n\">cl</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;action_form&quot;</span><span class=\"p\">:</span> <span class=\"n\">action_form</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;actions_on_top&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">actions_on_top</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;actions_on_bottom&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">actions_on_bottom</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;actions_selection_counter&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">actions_selection_counter</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{}),</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">change_list_template</span>\n            <span class=\"ow\">or</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/</span><span class=\"si\">%s</span><span class=\"s2\">/change_list.html&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/change_list.html&quot;</span> <span class=\"o\">%</span> <span class=\"n\">app_label</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;admin/change_list.html&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">],</span>\n            <span class=\"n\">context</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_deleted_objects\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_deleted_objects\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_deleted_objects</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">objs</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Hook for customizing the delete process for the delete view and the</span>\n<span class=\"sd\">        &quot;delete selected&quot; action.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">get_deleted_objects</span><span class=\"p\">(</span><span class=\"n\">objs</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.delete_view\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.delete_view\">[docs]</a>    <span class=\"nd\">@csrf_protect_m</span>\n    <span class=\"k\">def</span> <span class=\"nf\">delete_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">with</span> <span class=\"n\">transaction</span><span class=\"o\">.</span><span class=\"n\">atomic</span><span class=\"p\">(</span><span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">router</span><span class=\"o\">.</span><span class=\"n\">db_for_write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)):</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_delete_view</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"p\">)</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_delete_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"p\">):</span>\n        <span class=\"s2\">&quot;The &#39;delete&#39; admin view for this model.&quot;</span>\n        <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span>\n\n        <span class=\"n\">to_field</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">TO_FIELD_VAR</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">to_field</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">to_field_allowed</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">to_field</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">DisallowedModelAdminToField</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;The field </span><span class=\"si\">%s</span><span class=\"s2\"> cannot be referenced.&quot;</span> <span class=\"o\">%</span> <span class=\"n\">to_field</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_object</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">unquote</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">),</span> <span class=\"n\">to_field</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">obj</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_obj_does_not_exist_redirect</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Populate deleted_objects, a data structure of all related objects that</span>\n        <span class=\"c1\"># will also be deleted.</span>\n        <span class=\"p\">(</span>\n            <span class=\"n\">deleted_objects</span><span class=\"p\">,</span>\n            <span class=\"n\">model_count</span><span class=\"p\">,</span>\n            <span class=\"n\">perms_needed</span><span class=\"p\">,</span>\n            <span class=\"n\">protected</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_deleted_objects</span><span class=\"p\">([</span><span class=\"n\">obj</span><span class=\"p\">],</span> <span class=\"n\">request</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">protected</span><span class=\"p\">:</span>  <span class=\"c1\"># The user has confirmed the deletion.</span>\n            <span class=\"k\">if</span> <span class=\"n\">perms_needed</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n            <span class=\"n\">obj_display</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n            <span class=\"n\">attr</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">to_field</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">to_field</span> <span class=\"k\">else</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">pk</span><span class=\"o\">.</span><span class=\"n\">attname</span>\n            <span class=\"n\">obj_id</span> <span class=\"o\">=</span> <span class=\"n\">obj</span><span class=\"o\">.</span><span class=\"n\">serializable_value</span><span class=\"p\">(</span><span class=\"n\">attr</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">log_deletion</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">obj_display</span><span class=\"p\">)</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">delete_model</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">response_delete</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj_display</span><span class=\"p\">,</span> <span class=\"n\">obj_id</span><span class=\"p\">)</span>\n\n        <span class=\"n\">object_name</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">perms_needed</span> <span class=\"ow\">or</span> <span class=\"n\">protected</span><span class=\"p\">:</span>\n            <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Cannot delete </span><span class=\"si\">%(name)s</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"p\">{</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"n\">object_name</span><span class=\"p\">}</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">title</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Are you sure?&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"n\">title</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;subtitle&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;object_name&quot;</span><span class=\"p\">:</span> <span class=\"n\">object_name</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;object&quot;</span><span class=\"p\">:</span> <span class=\"n\">obj</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;deleted_objects&quot;</span><span class=\"p\">:</span> <span class=\"n\">deleted_objects</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;model_count&quot;</span><span class=\"p\">:</span> <span class=\"nb\">dict</span><span class=\"p\">(</span><span class=\"n\">model_count</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">(),</span>\n            <span class=\"s2\">&quot;perms_lacking&quot;</span><span class=\"p\">:</span> <span class=\"n\">perms_needed</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;protected&quot;</span><span class=\"p\">:</span> <span class=\"n\">protected</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;app_label&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_label</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;is_popup&quot;</span><span class=\"p\">:</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span> <span class=\"ow\">or</span> <span class=\"n\">IS_POPUP_VAR</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;to_field&quot;</span><span class=\"p\">:</span> <span class=\"n\">to_field</span><span class=\"p\">,</span>\n            <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{}),</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">render_delete_form</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">context</span><span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.history_view\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.history_view\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">history_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">object_id</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"s2\">&quot;The &#39;history&#39; admin view for this model.&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.models</span> <span class=\"kn\">import</span> <span class=\"n\">LogEntry</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.views.main</span> <span class=\"kn\">import</span> <span class=\"n\">PAGE_VAR</span>\n\n        <span class=\"c1\"># First check if the user can see this history.</span>\n        <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span>\n        <span class=\"n\">obj</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_object</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">unquote</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">obj</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_get_obj_does_not_exist_redirect</span><span class=\"p\">(</span>\n                <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"p\">,</span> <span class=\"n\">object_id</span>\n            <span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_or_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n            <span class=\"k\">raise</span> <span class=\"n\">PermissionDenied</span>\n\n        <span class=\"c1\"># Then get the history for this object.</span>\n        <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span>\n        <span class=\"n\">action_list</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"n\">LogEntry</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">filter</span><span class=\"p\">(</span>\n                <span class=\"n\">object_id</span><span class=\"o\">=</span><span class=\"n\">unquote</span><span class=\"p\">(</span><span class=\"n\">object_id</span><span class=\"p\">),</span>\n                <span class=\"n\">content_type</span><span class=\"o\">=</span><span class=\"n\">get_content_type_for_model</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">),</span>\n            <span class=\"p\">)</span>\n            <span class=\"o\">.</span><span class=\"n\">select_related</span><span class=\"p\">()</span>\n            <span class=\"o\">.</span><span class=\"n\">order_by</span><span class=\"p\">(</span><span class=\"s2\">&quot;action_time&quot;</span><span class=\"p\">)</span>\n        <span class=\"p\">)</span>\n\n        <span class=\"n\">paginator</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_paginator</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">action_list</span><span class=\"p\">,</span> <span class=\"mi\">100</span><span class=\"p\">)</span>\n        <span class=\"n\">page_number</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">PAGE_VAR</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n        <span class=\"n\">page_obj</span> <span class=\"o\">=</span> <span class=\"n\">paginator</span><span class=\"o\">.</span><span class=\"n\">get_page</span><span class=\"p\">(</span><span class=\"n\">page_number</span><span class=\"p\">)</span>\n        <span class=\"n\">page_range</span> <span class=\"o\">=</span> <span class=\"n\">paginator</span><span class=\"o\">.</span><span class=\"n\">get_elided_page_range</span><span class=\"p\">(</span><span class=\"n\">page_obj</span><span class=\"o\">.</span><span class=\"n\">number</span><span class=\"p\">)</span>\n\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Change history: </span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"n\">obj</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;subtitle&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;action_list&quot;</span><span class=\"p\">:</span> <span class=\"n\">page_obj</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;page_range&quot;</span><span class=\"p\">:</span> <span class=\"n\">page_range</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;page_var&quot;</span><span class=\"p\">:</span> <span class=\"n\">PAGE_VAR</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;pagination_required&quot;</span><span class=\"p\">:</span> <span class=\"n\">paginator</span><span class=\"o\">.</span><span class=\"n\">count</span> <span class=\"o\">&gt;</span> <span class=\"mi\">100</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;module_name&quot;</span><span class=\"p\">:</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">capfirst</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name_plural</span><span class=\"p\">)),</span>\n            <span class=\"s2\">&quot;object&quot;</span><span class=\"p\">:</span> <span class=\"n\">obj</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;opts&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;preserved_filters&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_preserved_filters</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{}),</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">name</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">object_history_template</span>\n            <span class=\"ow\">or</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/</span><span class=\"si\">%s</span><span class=\"s2\">/object_history.html&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/object_history.html&quot;</span> <span class=\"o\">%</span> <span class=\"n\">app_label</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;admin/object_history.html&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">],</span>\n            <span class=\"n\">context</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"ModelAdmin.get_formset_kwargs\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.ModelAdmin.get_formset_kwargs\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_formset_kwargs</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">inline</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"p\">):</span>\n        <span class=\"n\">formset_params</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">:</span> <span class=\"n\">obj</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;prefix&quot;</span><span class=\"p\">:</span> <span class=\"n\">prefix</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;queryset&quot;</span><span class=\"p\">:</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;POST&quot;</span><span class=\"p\">:</span>\n            <span class=\"n\">formset_params</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span>\n                <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;data&quot;</span><span class=\"p\">:</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">(),</span>\n                    <span class=\"s2\">&quot;files&quot;</span><span class=\"p\">:</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">FILES</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;save_as_new&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;_saveasnew&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span><span class=\"p\">,</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">formset_params</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_create_formsets</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">change</span><span class=\"p\">):</span>\n        <span class=\"s2\">&quot;Helper function to generate formsets for add/change_view.&quot;</span>\n        <span class=\"n\">formsets</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">inline_instances</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">prefixes</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n        <span class=\"n\">get_formsets_args</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">request</span><span class=\"p\">]</span>\n        <span class=\"k\">if</span> <span class=\"n\">change</span><span class=\"p\">:</span>\n            <span class=\"n\">get_formsets_args</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">FormSet</span><span class=\"p\">,</span> <span class=\"n\">inline</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_formsets_with_inlines</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">get_formsets_args</span><span class=\"p\">):</span>\n            <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"n\">FormSet</span><span class=\"o\">.</span><span class=\"n\">get_default_prefix</span><span class=\"p\">()</span>\n            <span class=\"n\">prefixes</span><span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">prefixes</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"mi\">1</span>\n            <span class=\"k\">if</span> <span class=\"n\">prefixes</span><span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">]</span> <span class=\"o\">!=</span> <span class=\"mi\">1</span> <span class=\"ow\">or</span> <span class=\"ow\">not</span> <span class=\"n\">prefix</span><span class=\"p\">:</span>\n                <span class=\"n\">prefix</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">-</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">prefix</span><span class=\"p\">,</span> <span class=\"n\">prefixes</span><span class=\"p\">[</span><span class=\"n\">prefix</span><span class=\"p\">])</span>\n            <span class=\"n\">formset_params</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_formset_kwargs</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">inline</span><span class=\"p\">,</span> <span class=\"n\">prefix</span><span class=\"p\">)</span>\n            <span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"n\">FormSet</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">formset_params</span><span class=\"p\">)</span>\n\n            <span class=\"k\">def</span> <span class=\"nf\">user_deleted_form</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">formset</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">inline</span><span class=\"p\">):</span>\n                <span class=\"sd\">&quot;&quot;&quot;Return whether or not the user deleted the form.&quot;&quot;&quot;</span>\n                <span class=\"k\">return</span> <span class=\"p\">(</span>\n                    <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n                    <span class=\"ow\">and</span> <span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\">-</span><span class=\"si\">{}</span><span class=\"s2\">-DELETE&quot;</span><span class=\"o\">.</span><span class=\"n\">format</span><span class=\"p\">(</span><span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">prefix</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"p\">)</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n                <span class=\"p\">)</span>\n\n            <span class=\"c1\"># Bypass validation of each view-only inline form (since the form&#39;s</span>\n            <span class=\"c1\"># data won&#39;t be in request.POST), unless the form was deleted.</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">inline</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span> <span class=\"k\">if</span> <span class=\"n\">change</span> <span class=\"k\">else</span> <span class=\"kc\">None</span><span class=\"p\">):</span>\n                <span class=\"k\">for</span> <span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">form</span> <span class=\"ow\">in</span> <span class=\"nb\">enumerate</span><span class=\"p\">(</span><span class=\"n\">formset</span><span class=\"o\">.</span><span class=\"n\">initial_forms</span><span class=\"p\">):</span>\n                    <span class=\"k\">if</span> <span class=\"n\">user_deleted_form</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">formset</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"p\">,</span> <span class=\"n\">inline</span><span class=\"p\">):</span>\n                        <span class=\"k\">continue</span>\n                    <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">_errors</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n                    <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">cleaned_data</span> <span class=\"o\">=</span> <span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">initial</span>\n            <span class=\"n\">formsets</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">formset</span><span class=\"p\">)</span>\n            <span class=\"n\">inline_instances</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">inline</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">formsets</span><span class=\"p\">,</span> <span class=\"n\">inline_instances</span></div>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">InlineModelAdmin</span><span class=\"p\">(</span><span class=\"n\">BaseModelAdmin</span><span class=\"p\">):</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    Options for inline editing of ``model`` instances.</span>\n\n<span class=\"sd\">    Provide ``fk_name`` to specify the attribute name of the ``ForeignKey``</span>\n<span class=\"sd\">    from ``model`` to its parent. This is required if ``model`` has more than</span>\n<span class=\"sd\">    one ``ForeignKey`` to its parent.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">fk_name</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">formset</span> <span class=\"o\">=</span> <span class=\"n\">BaseInlineFormSet</span>\n    <span class=\"n\">extra</span> <span class=\"o\">=</span> <span class=\"mi\">3</span>\n    <span class=\"n\">min_num</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">max_num</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">verbose_name</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">verbose_name_plural</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">can_delete</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n    <span class=\"n\">show_change_link</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n    <span class=\"n\">checks_class</span> <span class=\"o\">=</span> <span class=\"n\">InlineModelAdminChecks</span>\n    <span class=\"n\">classes</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">parent_model</span><span class=\"p\">,</span> <span class=\"n\">admin_site</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_site</span> <span class=\"o\">=</span> <span class=\"n\">admin_site</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">parent_model</span> <span class=\"o\">=</span> <span class=\"n\">parent_model</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_registered_model</span> <span class=\"o\">=</span> <span class=\"n\">admin_site</span><span class=\"o\">.</span><span class=\"n\">is_registered</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">()</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose_name_plural</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose_name_plural</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name_plural</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose_name_plural</span> <span class=\"o\">=</span> <span class=\"n\">format_lazy</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">{}</span><span class=\"s2\">s&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">media</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">extra</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;&quot;</span> <span class=\"k\">if</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">DEBUG</span> <span class=\"k\">else</span> <span class=\"s2\">&quot;.min&quot;</span>\n        <span class=\"n\">js</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s2\">&quot;vendor/jquery/jquery</span><span class=\"si\">%s</span><span class=\"s2\">.js&quot;</span> <span class=\"o\">%</span> <span class=\"n\">extra</span><span class=\"p\">,</span> <span class=\"s2\">&quot;jquery.init.js&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;inlines.js&quot;</span><span class=\"p\">]</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter_vertical</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">filter_horizontal</span><span class=\"p\">:</span>\n            <span class=\"n\">js</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">([</span><span class=\"s2\">&quot;SelectBox.js&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;SelectFilter2.js&quot;</span><span class=\"p\">])</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">classes</span> <span class=\"ow\">and</span> <span class=\"s2\">&quot;collapse&quot;</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">classes</span><span class=\"p\">:</span>\n            <span class=\"n\">js</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"s2\">&quot;collapse.js&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">Media</span><span class=\"p\">(</span><span class=\"n\">js</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;admin/js/</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"n\">url</span> <span class=\"k\">for</span> <span class=\"n\">url</span> <span class=\"ow\">in</span> <span class=\"n\">js</span><span class=\"p\">])</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_extra</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Hook for customizing the number of extra inline forms.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">extra</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_min_num</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Hook for customizing the min number of inline forms.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">min_num</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_max_num</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Hook for customizing the max number of extra inline forms.&quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">max_num</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_formset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;Return a BaseInlineFormSet class for use in admin add/change views.&quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"s2\">&quot;fields&quot;</span> <span class=\"ow\">in</span> <span class=\"n\">kwargs</span><span class=\"p\">:</span>\n            <span class=\"n\">fields</span> <span class=\"o\">=</span> <span class=\"n\">kwargs</span><span class=\"o\">.</span><span class=\"n\">pop</span><span class=\"p\">(</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">)</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">fields</span> <span class=\"o\">=</span> <span class=\"n\">flatten_fieldsets</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_fieldsets</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">))</span>\n        <span class=\"n\">excluded</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_exclude</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">exclude</span> <span class=\"o\">=</span> <span class=\"p\">[]</span> <span class=\"k\">if</span> <span class=\"n\">excluded</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"k\">else</span> <span class=\"nb\">list</span><span class=\"p\">(</span><span class=\"n\">excluded</span><span class=\"p\">)</span>\n        <span class=\"n\">exclude</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_readonly_fields</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">))</span>\n        <span class=\"k\">if</span> <span class=\"n\">excluded</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"nb\">hasattr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"p\">,</span> <span class=\"s2\">&quot;_meta&quot;</span><span class=\"p\">)</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">exclude</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Take the custom ModelForm&#39;s Meta.exclude into account only if the</span>\n            <span class=\"c1\"># InlineModelAdmin doesn&#39;t define its own.</span>\n            <span class=\"n\">exclude</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">exclude</span><span class=\"p\">)</span>\n        <span class=\"c1\"># If exclude is an empty list we use None, since that&#39;s the actual</span>\n        <span class=\"c1\"># default.</span>\n        <span class=\"n\">exclude</span> <span class=\"o\">=</span> <span class=\"n\">exclude</span> <span class=\"ow\">or</span> <span class=\"kc\">None</span>\n        <span class=\"n\">can_delete</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">can_delete</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;form&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">form</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;formset&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formset</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;fk_name&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">fk_name</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">:</span> <span class=\"n\">fields</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;exclude&quot;</span><span class=\"p\">:</span> <span class=\"n\">exclude</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;formfield_callback&quot;</span><span class=\"p\">:</span> <span class=\"n\">partial</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">formfield_for_dbfield</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"o\">=</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;extra&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_extra</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;min_num&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_min_num</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;max_num&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_max_num</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;can_delete&quot;</span><span class=\"p\">:</span> <span class=\"n\">can_delete</span><span class=\"p\">,</span>\n            <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"n\">base_model_form</span> <span class=\"o\">=</span> <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;form&quot;</span><span class=\"p\">]</span>\n        <span class=\"n\">can_change</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">request</span> <span class=\"k\">else</span> <span class=\"kc\">True</span>\n        <span class=\"n\">can_add</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span> <span class=\"k\">if</span> <span class=\"n\">request</span> <span class=\"k\">else</span> <span class=\"kc\">True</span>\n\n        <span class=\"k\">class</span> <span class=\"nc\">DeleteProtectedModelForm</span><span class=\"p\">(</span><span class=\"n\">base_model_form</span><span class=\"p\">):</span>\n            <span class=\"k\">def</span> <span class=\"nf\">hand_clean_DELETE</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n                <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">                We don&#39;t validate the &#39;DELETE&#39; field itself because on</span>\n<span class=\"sd\">                templates it&#39;s not rendered using the field information, but</span>\n<span class=\"sd\">                just using a generic &quot;deletion_field&quot; of the InlineModelAdmin.</span>\n<span class=\"sd\">                &quot;&quot;&quot;</span>\n                <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cleaned_data</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"n\">DELETION_FIELD_NAME</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n                    <span class=\"n\">using</span> <span class=\"o\">=</span> <span class=\"n\">router</span><span class=\"o\">.</span><span class=\"n\">db_for_write</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">)</span>\n                    <span class=\"n\">collector</span> <span class=\"o\">=</span> <span class=\"n\">NestedObjects</span><span class=\"p\">(</span><span class=\"n\">using</span><span class=\"o\">=</span><span class=\"n\">using</span><span class=\"p\">)</span>\n                    <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">_state</span><span class=\"o\">.</span><span class=\"n\">adding</span><span class=\"p\">:</span>\n                        <span class=\"k\">return</span>\n                    <span class=\"n\">collector</span><span class=\"o\">.</span><span class=\"n\">collect</span><span class=\"p\">([</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"p\">])</span>\n                    <span class=\"k\">if</span> <span class=\"n\">collector</span><span class=\"o\">.</span><span class=\"n\">protected</span><span class=\"p\">:</span>\n                        <span class=\"n\">objs</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n                        <span class=\"k\">for</span> <span class=\"n\">p</span> <span class=\"ow\">in</span> <span class=\"n\">collector</span><span class=\"o\">.</span><span class=\"n\">protected</span><span class=\"p\">:</span>\n                            <span class=\"n\">objs</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span>\n                                <span class=\"c1\"># Translators: Model verbose name and instance</span>\n                                <span class=\"c1\"># representation, suitable to be an item in a</span>\n                                <span class=\"c1\"># list.</span>\n                                <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%(class_name)s</span><span class=\"s2\"> </span><span class=\"si\">%(instance)s</span><span class=\"s2\">&quot;</span><span class=\"p\">)</span>\n                                <span class=\"o\">%</span> <span class=\"p\">{</span><span class=\"s2\">&quot;class_name&quot;</span><span class=\"p\">:</span> <span class=\"n\">p</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span> <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">:</span> <span class=\"n\">p</span><span class=\"p\">}</span>\n                            <span class=\"p\">)</span>\n                        <span class=\"n\">params</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n                            <span class=\"s2\">&quot;class_name&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span>\n                            <span class=\"s2\">&quot;instance&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"p\">,</span>\n                            <span class=\"s2\">&quot;related_objects&quot;</span><span class=\"p\">:</span> <span class=\"n\">get_text_list</span><span class=\"p\">(</span><span class=\"n\">objs</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;and&quot;</span><span class=\"p\">)),</span>\n                        <span class=\"p\">}</span>\n                        <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"n\">_</span><span class=\"p\">(</span>\n                            <span class=\"s2\">&quot;Deleting </span><span class=\"si\">%(class_name)s</span><span class=\"s2\"> </span><span class=\"si\">%(instance)s</span><span class=\"s2\"> would require &quot;</span>\n                            <span class=\"s2\">&quot;deleting the following protected related objects: &quot;</span>\n                            <span class=\"s2\">&quot;</span><span class=\"si\">%(related_objects)s</span><span class=\"s2\">&quot;</span>\n                        <span class=\"p\">)</span>\n                        <span class=\"k\">raise</span> <span class=\"n\">ValidationError</span><span class=\"p\">(</span>\n                            <span class=\"n\">msg</span><span class=\"p\">,</span> <span class=\"n\">code</span><span class=\"o\">=</span><span class=\"s2\">&quot;deleting_protected&quot;</span><span class=\"p\">,</span> <span class=\"n\">params</span><span class=\"o\">=</span><span class=\"n\">params</span>\n                        <span class=\"p\">)</span>\n\n            <span class=\"k\">def</span> <span class=\"nf\">is_valid</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n                <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">is_valid</span><span class=\"p\">()</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">hand_clean_DELETE</span><span class=\"p\">()</span>\n                <span class=\"k\">return</span> <span class=\"n\">result</span>\n\n            <span class=\"k\">def</span> <span class=\"nf\">has_changed</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n                <span class=\"c1\"># Protect against unauthorized edits.</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">can_change</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">_state</span><span class=\"o\">.</span><span class=\"n\">adding</span><span class=\"p\">:</span>\n                    <span class=\"k\">return</span> <span class=\"kc\">False</span>\n                <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">can_add</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">instance</span><span class=\"o\">.</span><span class=\"n\">_state</span><span class=\"o\">.</span><span class=\"n\">adding</span><span class=\"p\">:</span>\n                    <span class=\"k\">return</span> <span class=\"kc\">False</span>\n                <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">has_changed</span><span class=\"p\">()</span>\n\n        <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;form&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">DeleteProtectedModelForm</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">]</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">modelform_defines_fields</span><span class=\"p\">(</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;form&quot;</span><span class=\"p\">]</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;fields&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">forms</span><span class=\"o\">.</span><span class=\"n\">ALL_FIELDS</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">inlineformset_factory</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">parent_model</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_get_form_for_get_fields</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_formset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">,</span> <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">form</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_queryset</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">get_queryset</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_view_or_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n            <span class=\"n\">queryset</span> <span class=\"o\">=</span> <span class=\"n\">queryset</span><span class=\"o\">.</span><span class=\"n\">none</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"n\">queryset</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_has_any_perms_for_target_model</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">perms</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        This method is called only when the ModelAdmin&#39;s model is for an</span>\n<span class=\"sd\">        ManyToManyField&#39;s implicit through model (if self.opts.auto_created).</span>\n<span class=\"sd\">        Return True if the user has any of the given permissions (&#39;add&#39;,</span>\n<span class=\"sd\">        &#39;change&#39;, etc.) for the model that points to the through model.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span>\n        <span class=\"c1\"># Find the target model of an auto-created many-to-many relationship.</span>\n        <span class=\"k\">for</span> <span class=\"n\">field</span> <span class=\"ow\">in</span> <span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">fields</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span> <span class=\"ow\">and</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"o\">.</span><span class=\"n\">model</span> <span class=\"o\">!=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">parent_model</span><span class=\"p\">:</span>\n                <span class=\"n\">opts</span> <span class=\"o\">=</span> <span class=\"n\">field</span><span class=\"o\">.</span><span class=\"n\">remote_field</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span>\n                <span class=\"k\">break</span>\n        <span class=\"k\">return</span> <span class=\"nb\">any</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">has_perm</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">.</span><span class=\"si\">%s</span><span class=\"s2\">&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">get_permission_codename</span><span class=\"p\">(</span><span class=\"n\">perm</span><span class=\"p\">,</span> <span class=\"n\">opts</span><span class=\"p\">))</span>\n            <span class=\"p\">)</span>\n            <span class=\"k\">for</span> <span class=\"n\">perm</span> <span class=\"ow\">in</span> <span class=\"n\">perms</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_add_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">auto_created</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Auto-created intermediate models don&#39;t have their own</span>\n            <span class=\"c1\"># permissions. The user needs to have the change permission for the</span>\n            <span class=\"c1\"># related model in order to be able to do anything with the</span>\n            <span class=\"c1\"># intermediate model.</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_has_any_perms_for_target_model</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">&quot;change&quot;</span><span class=\"p\">])</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">has_add_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_change_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">auto_created</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Same comment as has_add_permission().</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_has_any_perms_for_target_model</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">&quot;change&quot;</span><span class=\"p\">])</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">has_change_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_delete_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">auto_created</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Same comment as has_add_permission().</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_has_any_perms_for_target_model</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">&quot;change&quot;</span><span class=\"p\">])</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">has_delete_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">has_view_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">obj</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">opts</span><span class=\"o\">.</span><span class=\"n\">auto_created</span><span class=\"p\">:</span>\n            <span class=\"c1\"># Same comment as has_add_permission(). The &#39;change&#39; permission</span>\n            <span class=\"c1\"># also implies the &#39;view&#39; permission.</span>\n            <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_has_any_perms_for_target_model</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s2\">&quot;view&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;change&quot;</span><span class=\"p\">])</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">has_view_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n\n<div class=\"viewcode-block\" id=\"StackedInline\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.StackedInline\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">StackedInline</span><span class=\"p\">(</span><span class=\"n\">InlineModelAdmin</span><span class=\"p\">):</span>\n    <span class=\"n\">template</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;admin/edit_inline/stacked.html&quot;</span></div>\n\n\n<div class=\"viewcode-block\" id=\"TabularInline\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.TabularInline\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">TabularInline</span><span class=\"p\">(</span><span class=\"n\">InlineModelAdmin</span><span class=\"p\">):</span>\n    <span class=\"n\">template</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;admin/edit_inline/tabular.html&quot;</span></div>\n</pre></div>", "current_page_name": "_modules/django/contrib/admin/options", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}
