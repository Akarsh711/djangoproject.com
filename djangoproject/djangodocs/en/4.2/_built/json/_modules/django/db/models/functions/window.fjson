{"parents": [{"link": "../../../../../", "title": "Module code"}, {"link": "../../../../", "title": "django"}], "title": "django.db.models.functions.window", "body": "<h1>Source code for django.db.models.functions.window</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">django.db.models.expressions</span> <span class=\"kn\">import</span> <span class=\"n\">Func</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models.fields</span> <span class=\"kn\">import</span> <span class=\"n\">FloatField</span><span class=\"p\">,</span> <span class=\"n\">IntegerField</span>\n\n<span class=\"n\">__all__</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"s2\">&quot;CumeDist&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;DenseRank&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;FirstValue&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;Lag&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;LastValue&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;Lead&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;NthValue&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;Ntile&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;PercentRank&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;Rank&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;RowNumber&quot;</span><span class=\"p\">,</span>\n<span class=\"p\">]</span>\n\n\n<div class=\"viewcode-block\" id=\"CumeDist\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.CumeDist\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">CumeDist</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;CUME_DIST&quot;</span>\n    <span class=\"n\">output_field</span> <span class=\"o\">=</span> <span class=\"n\">FloatField</span><span class=\"p\">()</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n\n\n<div class=\"viewcode-block\" id=\"DenseRank\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.DenseRank\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">DenseRank</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;DENSE_RANK&quot;</span>\n    <span class=\"n\">output_field</span> <span class=\"o\">=</span> <span class=\"n\">IntegerField</span><span class=\"p\">()</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n\n\n<div class=\"viewcode-block\" id=\"FirstValue\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.FirstValue\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">FirstValue</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">arity</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;FIRST_VALUE&quot;</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">LagLeadFunction</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">expression</span><span class=\"p\">,</span> <span class=\"n\">offset</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">extra</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">expression</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\"> requires a non-null source expression.&quot;</span> <span class=\"o\">%</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">offset</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">offset</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\"> requires a positive integer for the offset.&quot;</span>\n                <span class=\"o\">%</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n            <span class=\"p\">)</span>\n        <span class=\"n\">args</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">expression</span><span class=\"p\">,</span> <span class=\"n\">offset</span><span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">default</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">args</span> <span class=\"o\">+=</span> <span class=\"p\">(</span><span class=\"n\">default</span><span class=\"p\">,)</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">extra</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_resolve_output_field</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">sources</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_source_expressions</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"n\">sources</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">output_field</span>\n\n\n<div class=\"viewcode-block\" id=\"Lag\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.Lag\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">Lag</span><span class=\"p\">(</span><span class=\"n\">LagLeadFunction</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;LAG&quot;</span></div>\n\n\n<div class=\"viewcode-block\" id=\"LastValue\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.LastValue\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">LastValue</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">arity</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;LAST_VALUE&quot;</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n\n\n<div class=\"viewcode-block\" id=\"Lead\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.Lead\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">Lead</span><span class=\"p\">(</span><span class=\"n\">LagLeadFunction</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;LEAD&quot;</span></div>\n\n\n<div class=\"viewcode-block\" id=\"NthValue\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.NthValue\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">NthValue</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;NTH_VALUE&quot;</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">expression</span><span class=\"p\">,</span> <span class=\"n\">nth</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">extra</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">expression</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\"> requires a non-null source expression.&quot;</span> <span class=\"o\">%</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n            <span class=\"p\">)</span>\n        <span class=\"k\">if</span> <span class=\"n\">nth</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span> <span class=\"ow\">or</span> <span class=\"n\">nth</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\"> requires a positive integer as for nth.&quot;</span> <span class=\"o\">%</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n            <span class=\"p\">)</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">expression</span><span class=\"p\">,</span> <span class=\"n\">nth</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">extra</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_resolve_output_field</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">sources</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_source_expressions</span><span class=\"p\">()</span>\n        <span class=\"k\">return</span> <span class=\"n\">sources</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">output_field</span></div>\n\n\n<div class=\"viewcode-block\" id=\"Ntile\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.Ntile\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">Ntile</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;NTILE&quot;</span>\n    <span class=\"n\">output_field</span> <span class=\"o\">=</span> <span class=\"n\">IntegerField</span><span class=\"p\">()</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">num_buckets</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">extra</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">num_buckets</span> <span class=\"o\">&lt;=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"ne\">ValueError</span><span class=\"p\">(</span><span class=\"s2\">&quot;num_buckets must be greater than 0.&quot;</span><span class=\"p\">)</span>\n        <span class=\"nb\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"n\">num_buckets</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">extra</span><span class=\"p\">)</span></div>\n\n\n<div class=\"viewcode-block\" id=\"PercentRank\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.PercentRank\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">PercentRank</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;PERCENT_RANK&quot;</span>\n    <span class=\"n\">output_field</span> <span class=\"o\">=</span> <span class=\"n\">FloatField</span><span class=\"p\">()</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n\n\n<div class=\"viewcode-block\" id=\"Rank\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.Rank\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">Rank</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;RANK&quot;</span>\n    <span class=\"n\">output_field</span> <span class=\"o\">=</span> <span class=\"n\">IntegerField</span><span class=\"p\">()</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n\n\n<div class=\"viewcode-block\" id=\"RowNumber\"><a class=\"viewcode-back\" href=\"../../../../../../ref/models/database-functions/#django.db.models.functions.RowNumber\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">RowNumber</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;ROW_NUMBER&quot;</span>\n    <span class=\"n\">output_field</span> <span class=\"o\">=</span> <span class=\"n\">IntegerField</span><span class=\"p\">()</span>\n    <span class=\"n\">window_compatible</span> <span class=\"o\">=</span> <span class=\"kc\">True</span></div>\n</pre></div>", "current_page_name": "_modules/django/db/models/functions/window", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}