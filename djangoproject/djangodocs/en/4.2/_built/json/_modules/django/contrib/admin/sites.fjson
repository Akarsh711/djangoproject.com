{"parents": [{"link": "../../../../", "title": "Module code"}, {"link": "../../../", "title": "django"}, {"link": "../", "title": "django.contrib.admin"}], "title": "django.contrib.admin.sites", "body": "<h1>Source code for django.contrib.admin.sites</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"kn\">from</span> <span class=\"nn\">functools</span> <span class=\"kn\">import</span> <span class=\"n\">update_wrapper</span>\n<span class=\"kn\">from</span> <span class=\"nn\">weakref</span> <span class=\"kn\">import</span> <span class=\"n\">WeakSet</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">django.apps</span> <span class=\"kn\">import</span> <span class=\"n\">apps</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.conf</span> <span class=\"kn\">import</span> <span class=\"n\">settings</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin</span> <span class=\"kn\">import</span> <span class=\"n\">ModelAdmin</span><span class=\"p\">,</span> <span class=\"n\">actions</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.views.autocomplete</span> <span class=\"kn\">import</span> <span class=\"n\">AutocompleteJsonView</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth</span> <span class=\"kn\">import</span> <span class=\"n\">REDIRECT_FIELD_NAME</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.core.exceptions</span> <span class=\"kn\">import</span> <span class=\"n\">ImproperlyConfigured</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models.base</span> <span class=\"kn\">import</span> <span class=\"n\">ModelBase</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.http</span> <span class=\"kn\">import</span> <span class=\"n\">Http404</span><span class=\"p\">,</span> <span class=\"n\">HttpResponsePermanentRedirect</span><span class=\"p\">,</span> <span class=\"n\">HttpResponseRedirect</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.template.response</span> <span class=\"kn\">import</span> <span class=\"n\">TemplateResponse</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.urls</span> <span class=\"kn\">import</span> <span class=\"n\">NoReverseMatch</span><span class=\"p\">,</span> <span class=\"n\">Resolver404</span><span class=\"p\">,</span> <span class=\"n\">resolve</span><span class=\"p\">,</span> <span class=\"n\">reverse</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.decorators</span> <span class=\"kn\">import</span> <span class=\"n\">method_decorator</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.functional</span> <span class=\"kn\">import</span> <span class=\"n\">LazyObject</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.module_loading</span> <span class=\"kn\">import</span> <span class=\"n\">import_string</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.text</span> <span class=\"kn\">import</span> <span class=\"n\">capfirst</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.translation</span> <span class=\"kn\">import</span> <span class=\"n\">gettext</span> <span class=\"k\">as</span> <span class=\"n\">_</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.utils.translation</span> <span class=\"kn\">import</span> <span class=\"n\">gettext_lazy</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views.decorators.cache</span> <span class=\"kn\">import</span> <span class=\"n\">never_cache</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views.decorators.common</span> <span class=\"kn\">import</span> <span class=\"n\">no_append_slash</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views.decorators.csrf</span> <span class=\"kn\">import</span> <span class=\"n\">csrf_protect</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.views.i18n</span> <span class=\"kn\">import</span> <span class=\"n\">JavaScriptCatalog</span>\n\n<span class=\"n\">all_sites</span> <span class=\"o\">=</span> <span class=\"n\">WeakSet</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">AlreadyRegistered</span><span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">NotRegistered</span><span class=\"p\">(</span><span class=\"ne\">Exception</span><span class=\"p\">):</span>\n    <span class=\"k\">pass</span>\n\n\n<div class=\"viewcode-block\" id=\"AdminSite\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.AdminSite\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">AdminSite</span><span class=\"p\">:</span>\n    <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">    An AdminSite object encapsulates an instance of the Django admin application, ready</span>\n<span class=\"sd\">    to be hooked in to your URLconf. Models are registered with the AdminSite using the</span>\n<span class=\"sd\">    register() method, and the get_urls() method can then be used to access Django view</span>\n<span class=\"sd\">    functions that present a full admin interface for the collection of registered</span>\n<span class=\"sd\">    models.</span>\n<span class=\"sd\">    &quot;&quot;&quot;</span>\n\n    <span class=\"c1\"># Text to put at the end of each page&#39;s &lt;title&gt;.</span>\n    <span class=\"n\">site_title</span> <span class=\"o\">=</span> <span class=\"n\">gettext_lazy</span><span class=\"p\">(</span><span class=\"s2\">&quot;Django site admin&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Text to put in each page&#39;s &lt;div id=&quot;site-name&quot;&gt;.</span>\n    <span class=\"n\">site_header</span> <span class=\"o\">=</span> <span class=\"n\">gettext_lazy</span><span class=\"p\">(</span><span class=\"s2\">&quot;Django administration&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># Text to put at the top of the admin index page.</span>\n    <span class=\"n\">index_title</span> <span class=\"o\">=</span> <span class=\"n\">gettext_lazy</span><span class=\"p\">(</span><span class=\"s2\">&quot;Site administration&quot;</span><span class=\"p\">)</span>\n\n    <span class=\"c1\"># URL for the &quot;View site&quot; link at the top of each admin page.</span>\n    <span class=\"n\">site_url</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;/&quot;</span>\n\n    <span class=\"n\">enable_nav_sidebar</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n    <span class=\"n\">empty_value_display</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;-&quot;</span>\n\n    <span class=\"n\">login_form</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">index_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">app_index_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">login_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">logout_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">password_change_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n    <span class=\"n\">password_change_done_template</span> <span class=\"o\">=</span> <span class=\"kc\">None</span>\n\n    <span class=\"n\">final_catch_all_view</span> <span class=\"o\">=</span> <span class=\"kc\">True</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;admin&quot;</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>  <span class=\"c1\"># model_class class -&gt; admin_class instance</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_actions</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s2\">&quot;delete_selected&quot;</span><span class=\"p\">:</span> <span class=\"n\">actions</span><span class=\"o\">.</span><span class=\"n\">delete_selected</span><span class=\"p\">}</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_global_actions</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_actions</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">()</span>\n        <span class=\"n\">all_sites</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__repr__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"sa\">f</span><span class=\"s2\">&quot;</span><span class=\"si\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"vm\">__class__</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"si\">}</span><span class=\"s2\">(name=</span><span class=\"si\">{</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"si\">!r}</span><span class=\"s2\">)&quot;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">check</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">app_configs</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Run the system checks on all ModelAdmins, except if they aren&#39;t</span>\n<span class=\"sd\">        customized at all.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"n\">app_configs</span> <span class=\"ow\">is</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">app_configs</span> <span class=\"o\">=</span> <span class=\"n\">apps</span><span class=\"o\">.</span><span class=\"n\">get_app_configs</span><span class=\"p\">()</span>\n        <span class=\"n\">app_configs</span> <span class=\"o\">=</span> <span class=\"nb\">set</span><span class=\"p\">(</span><span class=\"n\">app_configs</span><span class=\"p\">)</span>  <span class=\"c1\"># Speed up lookups below</span>\n\n        <span class=\"n\">errors</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"n\">modeladmins</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"n\">o</span> <span class=\"k\">for</span> <span class=\"n\">o</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">()</span> <span class=\"k\">if</span> <span class=\"n\">o</span><span class=\"o\">.</span><span class=\"vm\">__class__</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"n\">ModelAdmin</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">for</span> <span class=\"n\">modeladmin</span> <span class=\"ow\">in</span> <span class=\"n\">modeladmins</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">modeladmin</span><span class=\"o\">.</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">app_config</span> <span class=\"ow\">in</span> <span class=\"n\">app_configs</span><span class=\"p\">:</span>\n                <span class=\"n\">errors</span><span class=\"o\">.</span><span class=\"n\">extend</span><span class=\"p\">(</span><span class=\"n\">modeladmin</span><span class=\"o\">.</span><span class=\"n\">check</span><span class=\"p\">())</span>\n        <span class=\"k\">return</span> <span class=\"n\">errors</span>\n\n<div class=\"viewcode-block\" id=\"AdminSite.register\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.AdminSite.register\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">register</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">model_or_iterable</span><span class=\"p\">,</span> <span class=\"n\">admin_class</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">options</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Register the given model(s) with the given admin class.</span>\n\n<span class=\"sd\">        The model(s) should be Model classes, not instances.</span>\n\n<span class=\"sd\">        If an admin class isn&#39;t given, use ModelAdmin (the default admin</span>\n<span class=\"sd\">        options). If keyword arguments are given -- e.g., list_display --</span>\n<span class=\"sd\">        apply them as options to the admin class.</span>\n\n<span class=\"sd\">        If a model is already registered, raise AlreadyRegistered.</span>\n\n<span class=\"sd\">        If a model is abstract, raise ImproperlyConfigured.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">admin_class</span> <span class=\"o\">=</span> <span class=\"n\">admin_class</span> <span class=\"ow\">or</span> <span class=\"n\">ModelAdmin</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">model_or_iterable</span><span class=\"p\">,</span> <span class=\"n\">ModelBase</span><span class=\"p\">):</span>\n            <span class=\"n\">model_or_iterable</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">model_or_iterable</span><span class=\"p\">]</span>\n        <span class=\"k\">for</span> <span class=\"n\">model</span> <span class=\"ow\">in</span> <span class=\"n\">model_or_iterable</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">abstract</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"n\">ImproperlyConfigured</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;The model </span><span class=\"si\">%s</span><span class=\"s2\"> is abstract, so it cannot be registered with admin.&quot;</span>\n                    <span class=\"o\">%</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n                <span class=\"p\">)</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">model</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"p\">:</span>\n                <span class=\"n\">registered_admin</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"p\">[</span><span class=\"n\">model</span><span class=\"p\">])</span>\n                <span class=\"n\">msg</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;The model </span><span class=\"si\">%s</span><span class=\"s2\"> is already registered &quot;</span> <span class=\"o\">%</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n                <span class=\"k\">if</span> <span class=\"n\">registered_admin</span><span class=\"o\">.</span><span class=\"n\">endswith</span><span class=\"p\">(</span><span class=\"s2\">&quot;.ModelAdmin&quot;</span><span class=\"p\">):</span>\n                    <span class=\"c1\"># Most likely registered without a ModelAdmin subclass.</span>\n                    <span class=\"n\">msg</span> <span class=\"o\">+=</span> <span class=\"s2\">&quot;in app </span><span class=\"si\">%r</span><span class=\"s2\">.&quot;</span> <span class=\"o\">%</span> <span class=\"n\">registered_admin</span><span class=\"o\">.</span><span class=\"n\">removesuffix</span><span class=\"p\">(</span><span class=\"s2\">&quot;.ModelAdmin&quot;</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">msg</span> <span class=\"o\">+=</span> <span class=\"s2\">&quot;with </span><span class=\"si\">%r</span><span class=\"s2\">.&quot;</span> <span class=\"o\">%</span> <span class=\"n\">registered_admin</span>\n                <span class=\"k\">raise</span> <span class=\"n\">AlreadyRegistered</span><span class=\"p\">(</span><span class=\"n\">msg</span><span class=\"p\">)</span>\n\n            <span class=\"c1\"># Ignore the registration if the model has been</span>\n            <span class=\"c1\"># swapped out.</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">swapped</span><span class=\"p\">:</span>\n                <span class=\"c1\"># If we got **options then dynamically construct a subclass of</span>\n                <span class=\"c1\"># admin_class with those **options.</span>\n                <span class=\"k\">if</span> <span class=\"n\">options</span><span class=\"p\">:</span>\n                    <span class=\"c1\"># For reasons I don&#39;t quite understand, without a __module__</span>\n                    <span class=\"c1\"># the created class appears to &quot;live&quot; in the wrong place,</span>\n                    <span class=\"c1\"># which causes issues later on.</span>\n                    <span class=\"n\">options</span><span class=\"p\">[</span><span class=\"s2\">&quot;__module__&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"vm\">__name__</span>\n                    <span class=\"n\">admin_class</span> <span class=\"o\">=</span> <span class=\"nb\">type</span><span class=\"p\">(</span>\n                        <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">Admin&quot;</span> <span class=\"o\">%</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">admin_class</span><span class=\"p\">,),</span> <span class=\"n\">options</span>\n                    <span class=\"p\">)</span>\n\n                <span class=\"c1\"># Instantiate the admin class to save in the registry</span>\n                <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"p\">[</span><span class=\"n\">model</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">admin_class</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"AdminSite.unregister\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.AdminSite.unregister\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">unregister</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">model_or_iterable</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Unregister the given model(s).</span>\n\n<span class=\"sd\">        If a model isn&#39;t already registered, raise NotRegistered.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"nb\">isinstance</span><span class=\"p\">(</span><span class=\"n\">model_or_iterable</span><span class=\"p\">,</span> <span class=\"n\">ModelBase</span><span class=\"p\">):</span>\n            <span class=\"n\">model_or_iterable</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">model_or_iterable</span><span class=\"p\">]</span>\n        <span class=\"k\">for</span> <span class=\"n\">model</span> <span class=\"ow\">in</span> <span class=\"n\">model_or_iterable</span><span class=\"p\">:</span>\n            <span class=\"k\">if</span> <span class=\"n\">model</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"p\">:</span>\n                <span class=\"k\">raise</span> <span class=\"n\">NotRegistered</span><span class=\"p\">(</span><span class=\"s2\">&quot;The model </span><span class=\"si\">%s</span><span class=\"s2\"> is not registered&quot;</span> <span class=\"o\">%</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"vm\">__name__</span><span class=\"p\">)</span>\n            <span class=\"k\">del</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"p\">[</span><span class=\"n\">model</span><span class=\"p\">]</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">is_registered</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Check if a model class is registered with this `AdminSite`.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">model</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span>\n\n<div class=\"viewcode-block\" id=\"AdminSite.add_action\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/actions/#django.contrib.admin.AdminSite.add_action\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">add_action</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">action</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Register an action to be available globally.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">name</span> <span class=\"o\">=</span> <span class=\"n\">name</span> <span class=\"ow\">or</span> <span class=\"n\">action</span><span class=\"o\">.</span><span class=\"vm\">__name__</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_actions</span><span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">action</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_global_actions</span><span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">action</span></div>\n\n<div class=\"viewcode-block\" id=\"AdminSite.disable_action\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/actions/#django.contrib.admin.AdminSite.disable_action\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">disable_action</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Disable a globally-registered action. Raise KeyError for invalid names.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">del</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_actions</span><span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_action</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Explicitly get a registered global action whether it&#39;s enabled or</span>\n<span class=\"sd\">        not. Raise KeyError for invalid names.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_global_actions</span><span class=\"p\">[</span><span class=\"n\">name</span><span class=\"p\">]</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">actions</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Get all the enabled actions as an iterable of (name, func).</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_actions</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n\n<div class=\"viewcode-block\" id=\"AdminSite.has_permission\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.AdminSite.has_permission\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">has_permission</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return True if the given HttpRequest has permission to view</span>\n<span class=\"sd\">        *at least one* page in the admin site.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">is_active</span> <span class=\"ow\">and</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">is_staff</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">admin_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">view</span><span class=\"p\">,</span> <span class=\"n\">cacheable</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Decorator to create an admin view attached to this ``AdminSite``. This</span>\n<span class=\"sd\">        wraps the view and provides permission checking by calling</span>\n<span class=\"sd\">        ``self.has_permission``.</span>\n\n<span class=\"sd\">        You&#39;ll want to use this from within ``AdminSite.get_urls()``:</span>\n\n<span class=\"sd\">            class MyAdminSite(AdminSite):</span>\n\n<span class=\"sd\">                def get_urls(self):</span>\n<span class=\"sd\">                    from django.urls import path</span>\n\n<span class=\"sd\">                    urls = super().get_urls()</span>\n<span class=\"sd\">                    urls += [</span>\n<span class=\"sd\">                        path(&#39;my_view/&#39;, self.admin_view(some_view))</span>\n<span class=\"sd\">                    ]</span>\n<span class=\"sd\">                    return urls</span>\n\n<span class=\"sd\">        By default, admin_views are marked non-cacheable using the</span>\n<span class=\"sd\">        ``never_cache`` decorator. If the view can be safely cached, set</span>\n<span class=\"sd\">        cacheable=True.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n\n        <span class=\"k\">def</span> <span class=\"nf\">inner</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n                <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">path</span> <span class=\"o\">==</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:logout&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">):</span>\n                    <span class=\"n\">index_path</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:index&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n                    <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">index_path</span><span class=\"p\">)</span>\n                <span class=\"c1\"># Inner import to prevent django.contrib.admin (app) from</span>\n                <span class=\"c1\"># importing django.contrib.auth.models.User (unrelated model).</span>\n                <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.views</span> <span class=\"kn\">import</span> <span class=\"n\">redirect_to_login</span>\n\n                <span class=\"k\">return</span> <span class=\"n\">redirect_to_login</span><span class=\"p\">(</span>\n                    <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">get_full_path</span><span class=\"p\">(),</span>\n                    <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:login&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">),</span>\n                <span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">view</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">cacheable</span><span class=\"p\">:</span>\n            <span class=\"n\">inner</span> <span class=\"o\">=</span> <span class=\"n\">never_cache</span><span class=\"p\">(</span><span class=\"n\">inner</span><span class=\"p\">)</span>\n        <span class=\"c1\"># We add csrf_protect here so this function can be used as a utility</span>\n        <span class=\"c1\"># function for any view, without having to repeat &#39;csrf_protect&#39;.</span>\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">view</span><span class=\"p\">,</span> <span class=\"s2\">&quot;csrf_exempt&quot;</span><span class=\"p\">,</span> <span class=\"kc\">False</span><span class=\"p\">):</span>\n            <span class=\"n\">inner</span> <span class=\"o\">=</span> <span class=\"n\">csrf_protect</span><span class=\"p\">(</span><span class=\"n\">inner</span><span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"n\">update_wrapper</span><span class=\"p\">(</span><span class=\"n\">inner</span><span class=\"p\">,</span> <span class=\"n\">view</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">get_urls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"c1\"># Since this module gets imported in the application&#39;s root package,</span>\n        <span class=\"c1\"># it cannot import models from other applications at the module level,</span>\n        <span class=\"c1\"># and django.contrib.contenttypes.views imports ContentType.</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.contenttypes</span> <span class=\"kn\">import</span> <span class=\"n\">views</span> <span class=\"k\">as</span> <span class=\"n\">contenttype_views</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.urls</span> <span class=\"kn\">import</span> <span class=\"n\">include</span><span class=\"p\">,</span> <span class=\"n\">path</span><span class=\"p\">,</span> <span class=\"n\">re_path</span>\n\n        <span class=\"k\">def</span> <span class=\"nf\">wrap</span><span class=\"p\">(</span><span class=\"n\">view</span><span class=\"p\">,</span> <span class=\"n\">cacheable</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">):</span>\n            <span class=\"k\">def</span> <span class=\"nf\">wrapper</span><span class=\"p\">(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n                <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">admin_view</span><span class=\"p\">(</span><span class=\"n\">view</span><span class=\"p\">,</span> <span class=\"n\">cacheable</span><span class=\"p\">)(</span><span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n\n            <span class=\"n\">wrapper</span><span class=\"o\">.</span><span class=\"n\">admin_site</span> <span class=\"o\">=</span> <span class=\"bp\">self</span>\n            <span class=\"k\">return</span> <span class=\"n\">update_wrapper</span><span class=\"p\">(</span><span class=\"n\">wrapper</span><span class=\"p\">,</span> <span class=\"n\">view</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Admin-site-wide views.</span>\n        <span class=\"n\">urlpatterns</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s2\">&quot;&quot;</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">index</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;index&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s2\">&quot;login/&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">login</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;login&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s2\">&quot;logout/&quot;</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logout</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;logout&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;password_change/&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">password_change</span><span class=\"p\">,</span> <span class=\"n\">cacheable</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">),</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;password_change&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;password_change/done/&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">password_change_done</span><span class=\"p\">,</span> <span class=\"n\">cacheable</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">),</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;password_change_done&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s2\">&quot;autocomplete/&quot;</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">autocomplete_view</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;autocomplete&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span><span class=\"s2\">&quot;jsi18n/&quot;</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">i18n_javascript</span><span class=\"p\">,</span> <span class=\"n\">cacheable</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;jsi18n&quot;</span><span class=\"p\">),</span>\n            <span class=\"n\">path</span><span class=\"p\">(</span>\n                <span class=\"s2\">&quot;r/&lt;int:content_type_id&gt;/&lt;path:object_id&gt;/&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"n\">contenttype_views</span><span class=\"o\">.</span><span class=\"n\">shortcut</span><span class=\"p\">),</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;view_on_site&quot;</span><span class=\"p\">,</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">]</span>\n\n        <span class=\"c1\"># Add in each model&#39;s views, and create a list of valid URLS for the</span>\n        <span class=\"c1\"># app_index</span>\n        <span class=\"n\">valid_app_labels</span> <span class=\"o\">=</span> <span class=\"p\">[]</span>\n        <span class=\"k\">for</span> <span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">model_admin</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"n\">urlpatterns</span> <span class=\"o\">+=</span> <span class=\"p\">[</span>\n                <span class=\"n\">path</span><span class=\"p\">(</span>\n                    <span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">/</span><span class=\"si\">%s</span><span class=\"s2\">/&quot;</span> <span class=\"o\">%</span> <span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">),</span>\n                    <span class=\"n\">include</span><span class=\"p\">(</span><span class=\"n\">model_admin</span><span class=\"o\">.</span><span class=\"n\">urls</span><span class=\"p\">),</span>\n                <span class=\"p\">),</span>\n            <span class=\"p\">]</span>\n            <span class=\"k\">if</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">app_label</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">valid_app_labels</span><span class=\"p\">:</span>\n                <span class=\"n\">valid_app_labels</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">app_label</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># If there were ModelAdmins registered, we should have a list of app</span>\n        <span class=\"c1\"># labels for which we need to allow access to the app_index view,</span>\n        <span class=\"k\">if</span> <span class=\"n\">valid_app_labels</span><span class=\"p\">:</span>\n            <span class=\"n\">regex</span> <span class=\"o\">=</span> <span class=\"sa\">r</span><span class=\"s2\">&quot;^(?P&lt;app_label&gt;&quot;</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;|&quot;</span><span class=\"o\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">valid_app_labels</span><span class=\"p\">)</span> <span class=\"o\">+</span> <span class=\"s2\">&quot;)/$&quot;</span>\n            <span class=\"n\">urlpatterns</span> <span class=\"o\">+=</span> <span class=\"p\">[</span>\n                <span class=\"n\">re_path</span><span class=\"p\">(</span><span class=\"n\">regex</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">app_index</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;app_list&quot;</span><span class=\"p\">),</span>\n            <span class=\"p\">]</span>\n\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">final_catch_all_view</span><span class=\"p\">:</span>\n            <span class=\"n\">urlpatterns</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">re_path</span><span class=\"p\">(</span><span class=\"sa\">r</span><span class=\"s2\">&quot;(?P&lt;url&gt;.*)$&quot;</span><span class=\"p\">,</span> <span class=\"n\">wrap</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">catch_all_view</span><span class=\"p\">)))</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">urlpatterns</span>\n\n    <span class=\"nd\">@property</span>\n    <span class=\"k\">def</span> <span class=\"nf\">urls</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_urls</span><span class=\"p\">(),</span> <span class=\"s2\">&quot;admin&quot;</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n\n<div class=\"viewcode-block\" id=\"AdminSite.each_context\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.AdminSite.each_context\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">each_context</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a dictionary of variables to put in the template context for</span>\n<span class=\"sd\">        *every* page in the admin site.</span>\n\n<span class=\"sd\">        For sites running on a subpath, use the SCRIPT_NAME value if site_url</span>\n<span class=\"sd\">        hasn&#39;t been customized.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">script_name</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">META</span><span class=\"p\">[</span><span class=\"s2\">&quot;SCRIPT_NAME&quot;</span><span class=\"p\">]</span>\n        <span class=\"n\">site_url</span> <span class=\"o\">=</span> <span class=\"p\">(</span>\n            <span class=\"n\">script_name</span> <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">site_url</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;/&quot;</span> <span class=\"ow\">and</span> <span class=\"n\">script_name</span> <span class=\"k\">else</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">site_url</span>\n        <span class=\"p\">)</span>\n        <span class=\"k\">return</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;site_title&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">site_title</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;site_header&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">site_header</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;site_url&quot;</span><span class=\"p\">:</span> <span class=\"n\">site_url</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;has_permission&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;available_apps&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_app_list</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;is_popup&quot;</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;is_nav_sidebar_enabled&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">enable_nav_sidebar</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;log_entries&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_log_entries</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n        <span class=\"p\">}</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">password_change</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Handle the &quot;change password&quot; task -- both form display and validation.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.forms</span> <span class=\"kn\">import</span> <span class=\"n\">AdminPasswordChangeForm</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.views</span> <span class=\"kn\">import</span> <span class=\"n\">PasswordChangeView</span>\n\n        <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:password_change_done&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;form_class&quot;</span><span class=\"p\">:</span> <span class=\"n\">AdminPasswordChangeForm</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;success_url&quot;</span><span class=\"p\">:</span> <span class=\"n\">url</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;extra_context&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span> <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{})},</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">password_change_template</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;template_name&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">password_change_template</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"k\">return</span> <span class=\"n\">PasswordChangeView</span><span class=\"o\">.</span><span class=\"n\">as_view</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">)(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">password_change_done</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Display the &quot;success&quot; page after a password change.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.views</span> <span class=\"kn\">import</span> <span class=\"n\">PasswordChangeDoneView</span>\n\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;extra_context&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span><span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span> <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{})},</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">password_change_done_template</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;template_name&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">password_change_done_template</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"k\">return</span> <span class=\"n\">PasswordChangeDoneView</span><span class=\"o\">.</span><span class=\"n\">as_view</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">)(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">i18n_javascript</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Display the i18n JavaScript that the Django admin requires.</span>\n\n<span class=\"sd\">        `extra_context` is unused but present for consistency with the other</span>\n<span class=\"sd\">        admin views.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">return</span> <span class=\"n\">JavaScriptCatalog</span><span class=\"o\">.</span><span class=\"n\">as_view</span><span class=\"p\">(</span><span class=\"n\">packages</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;django.contrib.admin&quot;</span><span class=\"p\">])(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">logout</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Log out the user for the given HttpRequest.</span>\n\n<span class=\"sd\">        This should *not* assume the user is already logged in.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.views</span> <span class=\"kn\">import</span> <span class=\"n\">LogoutView</span>\n\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;extra_context&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n                <span class=\"c1\"># Since the user isn&#39;t logged out at this point, the value of</span>\n                <span class=\"c1\"># has_permission must be overridden.</span>\n                <span class=\"s2\">&quot;has_permission&quot;</span><span class=\"p\">:</span> <span class=\"kc\">False</span><span class=\"p\">,</span>\n                <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{}),</span>\n            <span class=\"p\">},</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logout_template</span> <span class=\"ow\">is</span> <span class=\"ow\">not</span> <span class=\"kc\">None</span><span class=\"p\">:</span>\n            <span class=\"n\">defaults</span><span class=\"p\">[</span><span class=\"s2\">&quot;template_name&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">logout_template</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"k\">return</span> <span class=\"n\">LogoutView</span><span class=\"o\">.</span><span class=\"n\">as_view</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">)(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@method_decorator</span><span class=\"p\">(</span><span class=\"n\">never_cache</span><span class=\"p\">)</span>\n    <span class=\"k\">def</span> <span class=\"nf\">login</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Display the login form for the given HttpRequest.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"k\">if</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">method</span> <span class=\"o\">==</span> <span class=\"s2\">&quot;GET&quot;</span> <span class=\"ow\">and</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">has_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">):</span>\n            <span class=\"c1\"># Already logged-in, redirect to admin index</span>\n            <span class=\"n\">index_path</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:index&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n            <span class=\"k\">return</span> <span class=\"n\">HttpResponseRedirect</span><span class=\"p\">(</span><span class=\"n\">index_path</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Since this module gets imported in the application&#39;s root package,</span>\n        <span class=\"c1\"># it cannot import models from other applications at the module level,</span>\n        <span class=\"c1\"># and django.contrib.admin.forms eventually imports User.</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.forms</span> <span class=\"kn\">import</span> <span class=\"n\">AdminAuthenticationForm</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.auth.views</span> <span class=\"kn\">import</span> <span class=\"n\">LoginView</span>\n\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;Log in&quot;</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;subtitle&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;app_path&quot;</span><span class=\"p\">:</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">get_full_path</span><span class=\"p\">(),</span>\n            <span class=\"s2\">&quot;username&quot;</span><span class=\"p\">:</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">user</span><span class=\"o\">.</span><span class=\"n\">get_username</span><span class=\"p\">(),</span>\n        <span class=\"p\">}</span>\n        <span class=\"k\">if</span> <span class=\"p\">(</span>\n            <span class=\"n\">REDIRECT_FIELD_NAME</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">GET</span>\n            <span class=\"ow\">and</span> <span class=\"n\">REDIRECT_FIELD_NAME</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">POST</span>\n        <span class=\"p\">):</span>\n            <span class=\"n\">context</span><span class=\"p\">[</span><span class=\"n\">REDIRECT_FIELD_NAME</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin:index&quot;</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">)</span>\n        <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"n\">update</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{})</span>\n\n        <span class=\"n\">defaults</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"s2\">&quot;extra_context&quot;</span><span class=\"p\">:</span> <span class=\"n\">context</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;authentication_form&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">login_form</span> <span class=\"ow\">or</span> <span class=\"n\">AdminAuthenticationForm</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;template_name&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">login_template</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;admin/login.html&quot;</span><span class=\"p\">,</span>\n        <span class=\"p\">}</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n        <span class=\"k\">return</span> <span class=\"n\">LoginView</span><span class=\"o\">.</span><span class=\"n\">as_view</span><span class=\"p\">(</span><span class=\"o\">**</span><span class=\"n\">defaults</span><span class=\"p\">)(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">autocomplete_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"n\">AutocompleteJsonView</span><span class=\"o\">.</span><span class=\"n\">as_view</span><span class=\"p\">(</span><span class=\"n\">admin_site</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"p\">)(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n    <span class=\"nd\">@no_append_slash</span>\n    <span class=\"k\">def</span> <span class=\"nf\">catch_all_view</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">url</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">settings</span><span class=\"o\">.</span><span class=\"n\">APPEND_SLASH</span> <span class=\"ow\">and</span> <span class=\"ow\">not</span> <span class=\"n\">url</span><span class=\"o\">.</span><span class=\"n\">endswith</span><span class=\"p\">(</span><span class=\"s2\">&quot;/&quot;</span><span class=\"p\">):</span>\n            <span class=\"n\">urlconf</span> <span class=\"o\">=</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"s2\">&quot;urlconf&quot;</span><span class=\"p\">,</span> <span class=\"kc\">None</span><span class=\"p\">)</span>\n            <span class=\"k\">try</span><span class=\"p\">:</span>\n                <span class=\"n\">match</span> <span class=\"o\">=</span> <span class=\"n\">resolve</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%s</span><span class=\"s2\">/&quot;</span> <span class=\"o\">%</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">path_info</span><span class=\"p\">,</span> <span class=\"n\">urlconf</span><span class=\"p\">)</span>\n            <span class=\"k\">except</span> <span class=\"n\">Resolver404</span><span class=\"p\">:</span>\n                <span class=\"k\">pass</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"k\">if</span> <span class=\"nb\">getattr</span><span class=\"p\">(</span><span class=\"n\">match</span><span class=\"o\">.</span><span class=\"n\">func</span><span class=\"p\">,</span> <span class=\"s2\">&quot;should_append_slash&quot;</span><span class=\"p\">,</span> <span class=\"kc\">True</span><span class=\"p\">):</span>\n                    <span class=\"k\">return</span> <span class=\"n\">HttpResponsePermanentRedirect</span><span class=\"p\">(</span>\n                        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">get_full_path</span><span class=\"p\">(</span><span class=\"n\">force_append_slash</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n                    <span class=\"p\">)</span>\n        <span class=\"k\">raise</span> <span class=\"n\">Http404</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">_build_app_dict</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">label</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Build the app dictionary. The optional `label` parameter filters models</span>\n<span class=\"sd\">        of a specific app.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">app_dict</span> <span class=\"o\">=</span> <span class=\"p\">{}</span>\n\n        <span class=\"k\">if</span> <span class=\"n\">label</span><span class=\"p\">:</span>\n            <span class=\"n\">models</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n                <span class=\"n\">m</span><span class=\"p\">:</span> <span class=\"n\">m_a</span>\n                <span class=\"k\">for</span> <span class=\"n\">m</span><span class=\"p\">,</span> <span class=\"n\">m_a</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">()</span>\n                <span class=\"k\">if</span> <span class=\"n\">m</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">app_label</span> <span class=\"o\">==</span> <span class=\"n\">label</span>\n            <span class=\"p\">}</span>\n        <span class=\"k\">else</span><span class=\"p\">:</span>\n            <span class=\"n\">models</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_registry</span>\n\n        <span class=\"k\">for</span> <span class=\"n\">model</span><span class=\"p\">,</span> <span class=\"n\">model_admin</span> <span class=\"ow\">in</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">items</span><span class=\"p\">():</span>\n            <span class=\"n\">app_label</span> <span class=\"o\">=</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">app_label</span>\n\n            <span class=\"n\">has_module_perms</span> <span class=\"o\">=</span> <span class=\"n\">model_admin</span><span class=\"o\">.</span><span class=\"n\">has_module_permission</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n            <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">has_module_perms</span><span class=\"p\">:</span>\n                <span class=\"k\">continue</span>\n\n            <span class=\"n\">perms</span> <span class=\"o\">=</span> <span class=\"n\">model_admin</span><span class=\"o\">.</span><span class=\"n\">get_model_perms</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n            <span class=\"c1\"># Check whether user has any perm for this module.</span>\n            <span class=\"c1\"># If so, add the module to the model_list.</span>\n            <span class=\"k\">if</span> <span class=\"kc\">True</span> <span class=\"ow\">not</span> <span class=\"ow\">in</span> <span class=\"n\">perms</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">():</span>\n                <span class=\"k\">continue</span>\n\n            <span class=\"n\">info</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">model_name</span><span class=\"p\">)</span>\n            <span class=\"n\">model_dict</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n                <span class=\"s2\">&quot;model&quot;</span><span class=\"p\">:</span> <span class=\"n\">model</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"n\">capfirst</span><span class=\"p\">(</span><span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">verbose_name_plural</span><span class=\"p\">),</span>\n                <span class=\"s2\">&quot;object_name&quot;</span><span class=\"p\">:</span> <span class=\"n\">model</span><span class=\"o\">.</span><span class=\"n\">_meta</span><span class=\"o\">.</span><span class=\"n\">object_name</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;perms&quot;</span><span class=\"p\">:</span> <span class=\"n\">perms</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;admin_url&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;add_url&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"p\">}</span>\n            <span class=\"k\">if</span> <span class=\"n\">perms</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;change&quot;</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"n\">perms</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;view&quot;</span><span class=\"p\">):</span>\n                <span class=\"n\">model_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;view_only&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"ow\">not</span> <span class=\"n\">perms</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;change&quot;</span><span class=\"p\">)</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"n\">model_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;admin_url&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                        <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_changelist&quot;</span> <span class=\"o\">%</span> <span class=\"n\">info</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n                    <span class=\"p\">)</span>\n                <span class=\"k\">except</span> <span class=\"n\">NoReverseMatch</span><span class=\"p\">:</span>\n                    <span class=\"k\">pass</span>\n            <span class=\"k\">if</span> <span class=\"n\">perms</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s2\">&quot;add&quot;</span><span class=\"p\">):</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"n\">model_dict</span><span class=\"p\">[</span><span class=\"s2\">&quot;add_url&quot;</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                        <span class=\"s2\">&quot;admin:</span><span class=\"si\">%s</span><span class=\"s2\">_</span><span class=\"si\">%s</span><span class=\"s2\">_add&quot;</span> <span class=\"o\">%</span> <span class=\"n\">info</span><span class=\"p\">,</span> <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n                    <span class=\"p\">)</span>\n                <span class=\"k\">except</span> <span class=\"n\">NoReverseMatch</span><span class=\"p\">:</span>\n                    <span class=\"k\">pass</span>\n\n            <span class=\"k\">if</span> <span class=\"n\">app_label</span> <span class=\"ow\">in</span> <span class=\"n\">app_dict</span><span class=\"p\">:</span>\n                <span class=\"n\">app_dict</span><span class=\"p\">[</span><span class=\"n\">app_label</span><span class=\"p\">][</span><span class=\"s2\">&quot;models&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">append</span><span class=\"p\">(</span><span class=\"n\">model_dict</span><span class=\"p\">)</span>\n            <span class=\"k\">else</span><span class=\"p\">:</span>\n                <span class=\"n\">app_dict</span><span class=\"p\">[</span><span class=\"n\">app_label</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n                    <span class=\"s2\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"n\">apps</span><span class=\"o\">.</span><span class=\"n\">get_app_config</span><span class=\"p\">(</span><span class=\"n\">app_label</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">verbose_name</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;app_label&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_label</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;app_url&quot;</span><span class=\"p\">:</span> <span class=\"n\">reverse</span><span class=\"p\">(</span>\n                        <span class=\"s2\">&quot;admin:app_list&quot;</span><span class=\"p\">,</span>\n                        <span class=\"n\">kwargs</span><span class=\"o\">=</span><span class=\"p\">{</span><span class=\"s2\">&quot;app_label&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_label</span><span class=\"p\">},</span>\n                        <span class=\"n\">current_app</span><span class=\"o\">=</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span><span class=\"p\">,</span>\n                    <span class=\"p\">),</span>\n                    <span class=\"s2\">&quot;has_module_perms&quot;</span><span class=\"p\">:</span> <span class=\"n\">has_module_perms</span><span class=\"p\">,</span>\n                    <span class=\"s2\">&quot;models&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"n\">model_dict</span><span class=\"p\">],</span>\n                <span class=\"p\">}</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">app_dict</span>\n\n<div class=\"viewcode-block\" id=\"AdminSite.get_app_list\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.AdminSite.get_app_list\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_app_list</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">app_label</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Return a sorted list of all the installed apps that have been</span>\n<span class=\"sd\">        registered in this site.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">app_dict</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_build_app_dict</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">app_label</span><span class=\"p\">)</span>\n\n        <span class=\"c1\"># Sort the apps alphabetically.</span>\n        <span class=\"n\">app_list</span> <span class=\"o\">=</span> <span class=\"nb\">sorted</span><span class=\"p\">(</span><span class=\"n\">app_dict</span><span class=\"o\">.</span><span class=\"n\">values</span><span class=\"p\">(),</span> <span class=\"n\">key</span><span class=\"o\">=</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">())</span>\n\n        <span class=\"c1\"># Sort the models alphabetically within each app.</span>\n        <span class=\"k\">for</span> <span class=\"n\">app</span> <span class=\"ow\">in</span> <span class=\"n\">app_list</span><span class=\"p\">:</span>\n            <span class=\"n\">app</span><span class=\"p\">[</span><span class=\"s2\">&quot;models&quot;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">sort</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"o\">=</span><span class=\"k\">lambda</span> <span class=\"n\">x</span><span class=\"p\">:</span> <span class=\"n\">x</span><span class=\"p\">[</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">])</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">app_list</span></div>\n\n    <span class=\"k\">def</span> <span class=\"nf\">index</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"sd\">&quot;&quot;&quot;</span>\n<span class=\"sd\">        Display the main admin index page, which lists all of the installed</span>\n<span class=\"sd\">        apps that have been registered in this site.</span>\n<span class=\"sd\">        &quot;&quot;&quot;</span>\n        <span class=\"n\">app_list</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_app_list</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">)</span>\n\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">index_title</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;subtitle&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;app_list&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_list</span><span class=\"p\">,</span>\n            <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{}),</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">index_template</span> <span class=\"ow\">or</span> <span class=\"s2\">&quot;admin/index.html&quot;</span><span class=\"p\">,</span> <span class=\"n\">context</span>\n        <span class=\"p\">)</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">app_index</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"n\">extra_context</span><span class=\"o\">=</span><span class=\"kc\">None</span><span class=\"p\">):</span>\n        <span class=\"n\">app_list</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_app_list</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"n\">app_label</span><span class=\"p\">)</span>\n\n        <span class=\"k\">if</span> <span class=\"ow\">not</span> <span class=\"n\">app_list</span><span class=\"p\">:</span>\n            <span class=\"k\">raise</span> <span class=\"n\">Http404</span><span class=\"p\">(</span><span class=\"s2\">&quot;The requested admin page does not exist.&quot;</span><span class=\"p\">)</span>\n\n        <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n            <span class=\"o\">**</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">each_context</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">),</span>\n            <span class=\"s2\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"n\">_</span><span class=\"p\">(</span><span class=\"s2\">&quot;</span><span class=\"si\">%(app)s</span><span class=\"s2\"> administration&quot;</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"p\">{</span><span class=\"s2\">&quot;app&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_list</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">][</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">]},</span>\n            <span class=\"s2\">&quot;subtitle&quot;</span><span class=\"p\">:</span> <span class=\"kc\">None</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;app_list&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_list</span><span class=\"p\">,</span>\n            <span class=\"s2\">&quot;app_label&quot;</span><span class=\"p\">:</span> <span class=\"n\">app_label</span><span class=\"p\">,</span>\n            <span class=\"o\">**</span><span class=\"p\">(</span><span class=\"n\">extra_context</span> <span class=\"ow\">or</span> <span class=\"p\">{}),</span>\n        <span class=\"p\">}</span>\n\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">current_app</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">name</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">TemplateResponse</span><span class=\"p\">(</span>\n            <span class=\"n\">request</span><span class=\"p\">,</span>\n            <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">app_index_template</span>\n            <span class=\"ow\">or</span> <span class=\"p\">[</span><span class=\"s2\">&quot;admin/</span><span class=\"si\">%s</span><span class=\"s2\">/app_index.html&quot;</span> <span class=\"o\">%</span> <span class=\"n\">app_label</span><span class=\"p\">,</span> <span class=\"s2\">&quot;admin/app_index.html&quot;</span><span class=\"p\">],</span>\n            <span class=\"n\">context</span><span class=\"p\">,</span>\n        <span class=\"p\">)</span>\n\n<div class=\"viewcode-block\" id=\"AdminSite.get_log_entries\"><a class=\"viewcode-back\" href=\"../../../../../ref/contrib/admin/#django.contrib.admin.AdminSite.get_log_entries\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">get_log_entries</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"kn\">from</span> <span class=\"nn\">django.contrib.admin.models</span> <span class=\"kn\">import</span> <span class=\"n\">LogEntry</span>\n\n        <span class=\"k\">return</span> <span class=\"n\">LogEntry</span><span class=\"o\">.</span><span class=\"n\">objects</span><span class=\"o\">.</span><span class=\"n\">select_related</span><span class=\"p\">(</span><span class=\"s2\">&quot;content_type&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;user&quot;</span><span class=\"p\">)</span></div></div>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">DefaultAdminSite</span><span class=\"p\">(</span><span class=\"n\">LazyObject</span><span class=\"p\">):</span>\n    <span class=\"k\">def</span> <span class=\"nf\">_setup</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"n\">AdminSiteClass</span> <span class=\"o\">=</span> <span class=\"n\">import_string</span><span class=\"p\">(</span><span class=\"n\">apps</span><span class=\"o\">.</span><span class=\"n\">get_app_config</span><span class=\"p\">(</span><span class=\"s2\">&quot;admin&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">default_site</span><span class=\"p\">)</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_wrapped</span> <span class=\"o\">=</span> <span class=\"n\">AdminSiteClass</span><span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"fm\">__repr__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span>\n        <span class=\"k\">return</span> <span class=\"nb\">repr</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">_wrapped</span><span class=\"p\">)</span>\n\n\n<span class=\"c1\"># This global object represents the default admin site, for the common case.</span>\n<span class=\"c1\"># You can provide your own AdminSite using the (Simple)AdminConfig.default_site</span>\n<span class=\"c1\"># attribute. You can also instantiate AdminSite in your own code to create a</span>\n<span class=\"c1\"># custom admin site.</span>\n<span class=\"n\">site</span> <span class=\"o\">=</span> <span class=\"n\">DefaultAdminSite</span><span class=\"p\">()</span>\n</pre></div>", "current_page_name": "_modules/django/contrib/admin/sites", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}