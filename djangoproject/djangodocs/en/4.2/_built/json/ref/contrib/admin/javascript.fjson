{"parents": [{"link": "../../../", "title": "API Reference"}, {"link": "../../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">contrib</span></code> packages"}, {"link": "../", "title": "The Django admin site"}], "prev": {"link": "../admindocs/", "title": "The Django admin documentation generator"}, "next": {"link": "../../auth/", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.auth</span></code>"}, "title": "JavaScript customizations in the admin", "meta": {}, "body": "<div class=\"section\" id=\"s-javascript-customizations-in-the-admin\">\n<span id=\"javascript-customizations-in-the-admin\"></span><h1>JavaScript customizations in the admin<a class=\"headerlink\" href=\"#javascript-customizations-in-the-admin\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<div class=\"section\" id=\"s-inline-form-events\">\n<span id=\"s-admin-javascript-inline-form-events\"></span><span id=\"inline-form-events\"></span><span id=\"admin-javascript-inline-form-events\"></span><h2>Inline form events<a class=\"headerlink\" href=\"#inline-form-events\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>You may want to execute some JavaScript when an inline form is added or removed\nin the admin change form. The <code class=\"docutils literal notranslate\"><span class=\"pre\">formset:added</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">formset:removed</span></code> events\nallow this. <code class=\"docutils literal notranslate\"><span class=\"pre\">event.detail.formsetName</span></code> is the formset the row belongs to.\nFor the <code class=\"docutils literal notranslate\"><span class=\"pre\">formset:added</span></code> event, <code class=\"docutils literal notranslate\"><span class=\"pre\">event.target</span></code> is the newly added row.</p>\n<p>In your custom <code class=\"docutils literal notranslate\"><span class=\"pre\">change_form.html</span></code> template, extend the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">admin_change_form_document_ready</span></code> block and add the event listener code:</p>\n<div class=\"highlight-html+django notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"cp\">{%</span> <span class=\"k\">extends</span> <span class=\"s1\">&#39;admin/change_form.html&#39;</span> <span class=\"cp\">%}</span>\n<span class=\"cp\">{%</span> <span class=\"k\">load</span> <span class=\"nv\">static</span> <span class=\"cp\">%}</span>\n\n<span class=\"cp\">{%</span> <span class=\"k\">block</span> <span class=\"nv\">admin_change_form_document_ready</span> <span class=\"cp\">%}</span>\n<span class=\"cp\">{{</span> <span class=\"nb\">block</span><span class=\"nv\">.super</span> <span class=\"cp\">}}</span>\n<span class=\"p\">&lt;</span><span class=\"nt\">script</span> <span class=\"na\">src</span><span class=\"o\">=</span><span class=\"s\">&quot;</span><span class=\"cp\">{%</span> <span class=\"k\">static</span> <span class=\"s1\">&#39;app/formset_handlers.js&#39;</span> <span class=\"cp\">%}</span><span class=\"s\">&quot;</span><span class=\"p\">&gt;&lt;/</span><span class=\"nt\">script</span><span class=\"p\">&gt;</span>\n<span class=\"cp\">{%</span> <span class=\"k\">endblock</span> <span class=\"cp\">%}</span>\n</pre></div>\n</div>\n<div class=\"literal-block-wrapper docutils container\" id=\"id1\">\n<div class=\"code-block-caption\"><span class=\"caption-text\"><code class=\"docutils literal notranslate\"><span class=\"pre\">app/static/app/formset_handlers.js</span></code></span><a class=\"headerlink\" href=\"#id1\" title=\"Permalink to this code\">\u00b6</a></div>\n<div class=\"highlight-javascript notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">addEventListener</span><span class=\"p\">(</span><span class=\"s1\">&#39;formset:added&#39;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">.</span><span class=\"nx\">detail</span><span class=\"p\">.</span><span class=\"nx\">formsetName</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"s1\">&#39;author_set&#39;</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"c1\">// Do something</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">});</span><span class=\"w\"></span>\n<span class=\"nb\">document</span><span class=\"p\">.</span><span class=\"nx\">addEventListener</span><span class=\"p\">(</span><span class=\"s1\">&#39;formset:removed&#39;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"c1\">// Row removed</span><span class=\"w\"></span>\n<span class=\"p\">});</span><span class=\"w\"></span>\n</pre></div>\n</div>\n</div>\n<p>Two points to keep in mind:</p>\n<ul class=\"simple\">\n<li>The JavaScript code must go in a template block if you are inheriting\n<code class=\"docutils literal notranslate\"><span class=\"pre\">admin/change_form.html</span></code> or it won\u2019t be rendered in the final HTML.</li>\n<li><code class=\"docutils literal notranslate\"><span class=\"pre\">{{</span> <span class=\"pre\">block.super</span> <span class=\"pre\">}}</span></code> is added because Django\u2019s\n<code class=\"docutils literal notranslate\"><span class=\"pre\">admin_change_form_document_ready</span></code> block contains JavaScript code to handle\nvarious operations in the change form and we need that to be rendered too.</li>\n</ul>\n<div class=\"section\" id=\"s-supporting-versions-of-django-older-than-4-1\">\n<span id=\"supporting-versions-of-django-older-than-4-1\"></span><h3>Supporting versions of Django older than 4.1<a class=\"headerlink\" href=\"#supporting-versions-of-django-older-than-4-1\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>If your event listener still has to support older versions of Django you have\nto use jQuery to register your event listener. jQuery handles JavaScript events\nbut the reverse isn\u2019t true.</p>\n<p>You could check for the presence of <code class=\"docutils literal notranslate\"><span class=\"pre\">event.detail.formsetName</span></code> and fall back\nto the old listener signature as follows:</p>\n<div class=\"highlight-javascript notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kd\">function</span><span class=\"w\"> </span><span class=\"nx\">handleFormsetAdded</span><span class=\"p\">(</span><span class=\"nx\">row</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">formsetName</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"c1\">// Do something</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n\n<span class=\"nx\">$</span><span class=\"p\">(</span><span class=\"nb\">document</span><span class=\"p\">).</span><span class=\"nx\">on</span><span class=\"p\">(</span><span class=\"s1\">&#39;formset:added&#39;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">$row</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">formsetName</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">=&gt;</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">.</span><span class=\"nx\">detail</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"nx\">event</span><span class=\"p\">.</span><span class=\"nx\">detail</span><span class=\"p\">.</span><span class=\"nx\">formsetName</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"c1\">// Django &gt;= 4.1</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nx\">handleFormsetAdded</span><span class=\"p\">(</span><span class=\"nx\">event</span><span class=\"p\">.</span><span class=\"nx\">target</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">event</span><span class=\"p\">.</span><span class=\"nx\">detail</span><span class=\"p\">.</span><span class=\"nx\">formsetName</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"c1\">// Django &lt; 4.1, use $row and formsetName</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nx\">handleFormsetAdded</span><span class=\"p\">(</span><span class=\"nx\">$row</span><span class=\"p\">.</span><span class=\"nx\">get</span><span class=\"p\">(</span><span class=\"mf\">0</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"nx\">formsetName</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">})</span><span class=\"w\"></span>\n</pre></div>\n</div>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["ref/contrib/auth", "<code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.auth</span></code>", "N", "next"], ["ref/contrib/admin/admindocs", "The Django admin documentation generator", "P", "previous"]], "sourcename": "ref/contrib/admin/javascript.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">JavaScript customizations in the admin</a><ul>\n<li><a class=\"reference internal\" href=\"#inline-form-events\">Inline form events</a><ul>\n<li><a class=\"reference internal\" href=\"#supporting-versions-of-django-older-than-4-1\">Supporting versions of Django older than 4.1</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "ref/contrib/admin/javascript", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}