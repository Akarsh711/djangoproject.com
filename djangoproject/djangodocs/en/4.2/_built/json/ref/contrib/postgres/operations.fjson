{"parents": [{"link": "../../../", "title": "API Reference"}, {"link": "../../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">contrib</span></code> packages"}, {"link": "../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.postgres</span></code>"}], "prev": {"link": "../lookups/", "title": "PostgreSQL specific lookups"}, "next": {"link": "../search/", "title": "Full text search"}, "title": "Database migration operations", "meta": {}, "body": "<div class=\"section\" id=\"s-database-migration-operations\">\n<span id=\"database-migration-operations\"></span><h1>Database migration operations<a class=\"headerlink\" href=\"#database-migration-operations\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>All of these <a class=\"reference internal\" href=\"../../../migration-operations/\"><span class=\"doc\">operations</span></a> are available from\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.postgres.operations</span></code> module.</p>\n<div class=\"section\" id=\"s-creating-extension-using-migrations\">\n<span id=\"s-create-postgresql-extensions\"></span><span id=\"creating-extension-using-migrations\"></span><span id=\"create-postgresql-extensions\"></span><h2>Creating extension using migrations<a class=\"headerlink\" href=\"#creating-extension-using-migrations\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>You can create a PostgreSQL extension in your database using a migration file.\nThis example creates an hstore extension, but the same principles apply for\nother extensions.</p>\n<p>Set up the hstore extension in PostgreSQL before the first <code class=\"docutils literal notranslate\"><span class=\"pre\">CreateModel</span></code>\nor <code class=\"docutils literal notranslate\"><span class=\"pre\">AddField</span></code> operation that involves\n<a class=\"reference internal\" href=\"../fields/#django.contrib.postgres.fields.HStoreField\" title=\"django.contrib.postgres.fields.HStoreField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">HStoreField</span></code></a> by adding a migration with\nthe <a class=\"reference internal\" href=\"#django.contrib.postgres.operations.HStoreExtension\" title=\"django.contrib.postgres.operations.HStoreExtension\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">HStoreExtension</span></code></a> operation.\nFor example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.operations</span> <span class=\"kn\">import</span> <span class=\"n\">HStoreExtension</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Migration</span><span class=\"p\">(</span><span class=\"n\">migrations</span><span class=\"o\">.</span><span class=\"n\">Migration</span><span class=\"p\">):</span>\n    <span class=\"o\">...</span>\n\n    <span class=\"n\">operations</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"n\">HStoreExtension</span><span class=\"p\">(),</span> <span class=\"o\">...</span><span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>The operation skips adding the extension if it already exists.</p>\n<p>For most extensions, this requires a database user with superuser privileges.\nIf the Django database user doesn\u2019t have the appropriate privileges, you\u2019ll\nhave to create the extension outside of Django migrations with a user that has\nthem. In that case, connect to your Django database and run the query\n<code class=\"docutils literal notranslate\"><span class=\"pre\">CREATE</span> <span class=\"pre\">EXTENSION</span> <span class=\"pre\">IF</span> <span class=\"pre\">NOT</span> <span class=\"pre\">EXISTS</span> <span class=\"pre\">hstore;</span></code>.</p>\n</div>\n<div class=\"section\" id=\"s-createextension\">\n<span id=\"createextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">CreateExtension</span></code><a class=\"headerlink\" href=\"#createextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.CreateExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">CreateExtension</span></code>(<em><span class=\"n\"><span class=\"pre\">name</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#CreateExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.CreateExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>An <code class=\"docutils literal notranslate\"><span class=\"pre\">Operation</span></code> subclass which installs a PostgreSQL extension. For common\nextensions, use one of the more specific subclasses below.</p>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.CreateExtension.name\">\n<code class=\"sig-name descname\"><span class=\"pre\">name</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.CreateExtension.name\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>This is a required argument. The name of the extension to be installed.</p>\n</dd></dl>\n\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-bloomextension\">\n<span id=\"bloomextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">BloomExtension</span></code><a class=\"headerlink\" href=\"#bloomextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.BloomExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">BloomExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#BloomExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.BloomExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">bloom</span></code> extension.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-btreeginextension\">\n<span id=\"btreeginextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">BtreeGinExtension</span></code><a class=\"headerlink\" href=\"#btreeginextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.BtreeGinExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">BtreeGinExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#BtreeGinExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.BtreeGinExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">btree_gin</span></code> extension.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-btreegistextension\">\n<span id=\"btreegistextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">BtreeGistExtension</span></code><a class=\"headerlink\" href=\"#btreegistextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.BtreeGistExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">BtreeGistExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#BtreeGistExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.BtreeGistExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">btree_gist</span></code> extension.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-citextextension\">\n<span id=\"citextextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">CITextExtension</span></code><a class=\"headerlink\" href=\"#citextextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.CITextExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">CITextExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#CITextExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.CITextExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">citext</span></code> extension.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-cryptoextension\">\n<span id=\"cryptoextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">CryptoExtension</span></code><a class=\"headerlink\" href=\"#cryptoextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.CryptoExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">CryptoExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#CryptoExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.CryptoExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">pgcrypto</span></code> extension.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-hstoreextension\">\n<span id=\"hstoreextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">HStoreExtension</span></code><a class=\"headerlink\" href=\"#hstoreextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.HStoreExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">HStoreExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#HStoreExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.HStoreExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">hstore</span></code> extension and also sets up the connection to\ninterpret hstore data for possible use in subsequent migrations.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-trigramextension\">\n<span id=\"trigramextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">TrigramExtension</span></code><a class=\"headerlink\" href=\"#trigramextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.TrigramExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">TrigramExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#TrigramExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.TrigramExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">pg_trgm</span></code> extension.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-unaccentextension\">\n<span id=\"unaccentextension\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">UnaccentExtension</span></code><a class=\"headerlink\" href=\"#unaccentextension\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.UnaccentExtension\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">UnaccentExtension</span></code><a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#UnaccentExtension\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.UnaccentExtension\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Installs the <code class=\"docutils literal notranslate\"><span class=\"pre\">unaccent</span></code> extension.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-managing-collations-using-migrations\">\n<span id=\"s-manage-postgresql-collations\"></span><span id=\"managing-collations-using-migrations\"></span><span id=\"manage-postgresql-collations\"></span><h2>Managing collations using migrations<a class=\"headerlink\" href=\"#managing-collations-using-migrations\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>If you need to filter or order a column using a particular collation that your\noperating system provides but PostgreSQL does not, you can manage collations in\nyour database using a migration file. These collations can then be used with\nthe <code class=\"docutils literal notranslate\"><span class=\"pre\">db_collation</span></code> parameter on <a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.CharField\" title=\"django.db.models.CharField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">CharField</span></code></a>,\n<a class=\"reference internal\" href=\"../../../models/fields/#django.db.models.TextField\" title=\"django.db.models.TextField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">TextField</span></code></a>, and their subclasses.</p>\n<p>For example, to create a collation for German phone book ordering:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.operations</span> <span class=\"kn\">import</span> <span class=\"n\">CreateCollation</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Migration</span><span class=\"p\">(</span><span class=\"n\">migrations</span><span class=\"o\">.</span><span class=\"n\">Migration</span><span class=\"p\">):</span>\n    <span class=\"o\">...</span>\n\n    <span class=\"n\">operations</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n        <span class=\"n\">CreateCollation</span><span class=\"p\">(</span>\n            <span class=\"s2\">&quot;case_insensitive&quot;</span><span class=\"p\">,</span>\n            <span class=\"n\">provider</span><span class=\"o\">=</span><span class=\"s2\">&quot;icu&quot;</span><span class=\"p\">,</span>\n            <span class=\"n\">locale</span><span class=\"o\">=</span><span class=\"s2\">&quot;und-u-ks-level2&quot;</span><span class=\"p\">,</span>\n            <span class=\"n\">deterministic</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span>\n        <span class=\"p\">),</span>\n        <span class=\"o\">...</span><span class=\"p\">,</span>\n    <span class=\"p\">]</span>\n</pre></div>\n</div>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.CreateCollation\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">CreateCollation</span></code>(<em><span class=\"n\"><span class=\"pre\">name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">locale</span></span></em>, <em><span class=\"o\"><span class=\"pre\">*</span></span></em>, <em><span class=\"n\"><span class=\"pre\">provider</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">'libc'</span></span></em>, <em><span class=\"n\"><span class=\"pre\">deterministic</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">True</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#CreateCollation\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.CreateCollation\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Creates a collation with the given <code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">locale</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">provider</span></code>.</p>\n<p>Set the <code class=\"docutils literal notranslate\"><span class=\"pre\">deterministic</span></code> parameter to <code class=\"docutils literal notranslate\"><span class=\"pre\">False</span></code> to create a\nnon-deterministic collation, such as for case-insensitive filtering.</p>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.RemoveCollation\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">RemoveCollation</span></code>(<em><span class=\"n\"><span class=\"pre\">name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">locale</span></span></em>, <em><span class=\"o\"><span class=\"pre\">*</span></span></em>, <em><span class=\"n\"><span class=\"pre\">provider</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">'libc'</span></span></em>, <em><span class=\"n\"><span class=\"pre\">deterministic</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">True</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#RemoveCollation\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.RemoveCollation\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Removes the collations named <code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code>.</p>\n<p>When reversed this is creating a collation with the provided <code class=\"docutils literal notranslate\"><span class=\"pre\">locale</span></code>,\n<code class=\"docutils literal notranslate\"><span class=\"pre\">provider</span></code>, and <code class=\"docutils literal notranslate\"><span class=\"pre\">deterministic</span></code> arguments. Therefore, <code class=\"docutils literal notranslate\"><span class=\"pre\">locale</span></code> is\nrequired to make this operation reversible.</p>\n</dd></dl>\n\n</div>\n<div class=\"section\" id=\"s-concurrent-index-operations\">\n<span id=\"concurrent-index-operations\"></span><h2>Concurrent index operations<a class=\"headerlink\" href=\"#concurrent-index-operations\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>PostgreSQL supports the <code class=\"docutils literal notranslate\"><span class=\"pre\">CONCURRENTLY</span></code> option to <code class=\"docutils literal notranslate\"><span class=\"pre\">CREATE</span> <span class=\"pre\">INDEX</span></code> and\n<code class=\"docutils literal notranslate\"><span class=\"pre\">DROP</span> <span class=\"pre\">INDEX</span></code> statements to add and remove indexes without locking out writes.\nThis option is useful for adding or removing an index in a live production\ndatabase.</p>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.AddIndexConcurrently\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">AddIndexConcurrently</span></code>(<em><span class=\"n\"><span class=\"pre\">model_name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">index</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#AddIndexConcurrently\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.AddIndexConcurrently\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Like <a class=\"reference internal\" href=\"../../../migration-operations/#django.db.migrations.operations.AddIndex\" title=\"django.db.migrations.operations.AddIndex\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">AddIndex</span></code></a>, but creates an\nindex with the <code class=\"docutils literal notranslate\"><span class=\"pre\">CONCURRENTLY</span></code> option. This has a few caveats to be aware\nof when using this option, see <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/sql-createindex.html#SQL-CREATEINDEX-CONCURRENTLY\">the PostgreSQL documentation of building\nindexes concurrently</a>.</p>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.RemoveIndexConcurrently\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">RemoveIndexConcurrently</span></code>(<em><span class=\"n\"><span class=\"pre\">model_name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">name</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#RemoveIndexConcurrently\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.RemoveIndexConcurrently\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Like <a class=\"reference internal\" href=\"../../../migration-operations/#django.db.migrations.operations.RemoveIndex\" title=\"django.db.migrations.operations.RemoveIndex\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">RemoveIndex</span></code></a>, but removes the\nindex with the <code class=\"docutils literal notranslate\"><span class=\"pre\">CONCURRENTLY</span></code> option. This has a few caveats to be aware\nof when using this option, see <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/sql-dropindex.html\">the PostgreSQL documentation</a>.</p>\n</dd></dl>\n\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\">The <code class=\"docutils literal notranslate\"><span class=\"pre\">CONCURRENTLY</span></code> option is not supported inside a transaction (see\n<a class=\"reference internal\" href=\"../../../../howto/writing-migrations/#non-atomic-migrations\"><span class=\"std std-ref\">non-atomic migration</span></a>).</p>\n</div>\n</div>\n<div class=\"section\" id=\"s-adding-constraints-without-enforcing-validation\">\n<span id=\"adding-constraints-without-enforcing-validation\"></span><h2>Adding constraints without enforcing validation<a class=\"headerlink\" href=\"#adding-constraints-without-enforcing-validation\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>PostgreSQL supports the <code class=\"docutils literal notranslate\"><span class=\"pre\">NOT</span> <span class=\"pre\">VALID</span></code> option with the <code class=\"docutils literal notranslate\"><span class=\"pre\">ADD</span> <span class=\"pre\">CONSTRAINT</span></code>\nstatement to add check constraints without enforcing validation on existing\nrows. This option is useful if you want to skip the potentially lengthy scan of\nthe table to verify that all existing rows satisfy the constraint.</p>\n<p>To validate check constraints created with the <code class=\"docutils literal notranslate\"><span class=\"pre\">NOT</span> <span class=\"pre\">VALID</span></code> option at a later\npoint of time, use the\n<a class=\"reference internal\" href=\"#django.contrib.postgres.operations.ValidateConstraint\" title=\"django.contrib.postgres.operations.ValidateConstraint\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ValidateConstraint</span></code></a> operation.</p>\n<p>See <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/sql-altertable.html#SQL-ALTERTABLE-NOTES\">the PostgreSQL documentation</a> for more details.</p>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.AddConstraintNotValid\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">AddConstraintNotValid</span></code>(<em><span class=\"n\"><span class=\"pre\">model_name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">constraint</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#AddConstraintNotValid\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.AddConstraintNotValid\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Like <a class=\"reference internal\" href=\"../../../migration-operations/#django.db.migrations.operations.AddConstraint\" title=\"django.db.migrations.operations.AddConstraint\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">AddConstraint</span></code></a>, but avoids\nvalidating the constraint on existing rows.</p>\n</dd></dl>\n\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.operations.ValidateConstraint\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">ValidateConstraint</span></code>(<em><span class=\"n\"><span class=\"pre\">model_name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">name</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/operations/#ValidateConstraint\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.operations.ValidateConstraint\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Scans through the table and validates the given check constraint on\nexisting rows.</p>\n</dd></dl>\n\n<div class=\"admonition note\">\n<p class=\"first admonition-title\">Note</p>\n<p class=\"last\"><code class=\"docutils literal notranslate\"><span class=\"pre\">AddConstraintNotValid</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidateConstraint</span></code> operations should be\nperformed in two separate migrations. Performing both operations in the\nsame atomic migration has the same effect as\n<a class=\"reference internal\" href=\"../../../migration-operations/#django.db.migrations.operations.AddConstraint\" title=\"django.db.migrations.operations.AddConstraint\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">AddConstraint</span></code></a>, whereas performing\nthem in a single non-atomic migration, may leave your database in an\ninconsistent state if the <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidateConstraint</span></code> operation fails.</p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["ref/contrib/postgres/search", "Full text search", "N", "next"], ["ref/contrib/postgres/lookups", "PostgreSQL specific lookups", "P", "previous"]], "sourcename": "ref/contrib/postgres/operations.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Database migration operations</a><ul>\n<li><a class=\"reference internal\" href=\"#creating-extension-using-migrations\">Creating extension using migrations</a></li>\n<li><a class=\"reference internal\" href=\"#createextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">CreateExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#bloomextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">BloomExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#btreeginextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">BtreeGinExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#btreegistextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">BtreeGistExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#citextextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">CITextExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#cryptoextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">CryptoExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#hstoreextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">HStoreExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#trigramextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">TrigramExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#unaccentextension\"><code class=\"docutils literal notranslate\"><span class=\"pre\">UnaccentExtension</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#managing-collations-using-migrations\">Managing collations using migrations</a></li>\n<li><a class=\"reference internal\" href=\"#concurrent-index-operations\">Concurrent index operations</a></li>\n<li><a class=\"reference internal\" href=\"#adding-constraints-without-enforcing-validation\">Adding constraints without enforcing validation</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "ref/contrib/postgres/operations", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}