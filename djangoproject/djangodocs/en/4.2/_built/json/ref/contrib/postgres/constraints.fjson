{"parents": [{"link": "../../../", "title": "API Reference"}, {"link": "../../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">contrib</span></code> packages"}, {"link": "../", "title": "<code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.postgres</span></code>"}], "prev": {"link": "../aggregates/", "title": "PostgreSQL specific aggregation functions"}, "next": {"link": "../expressions/", "title": "PostgreSQL specific query expressions"}, "title": "PostgreSQL specific database constraints", "meta": {}, "body": "<div class=\"section\" id=\"s-module-django.contrib.postgres.constraints\">\n<span id=\"s-postgresql-specific-database-constraints\"></span><span id=\"module-django.contrib.postgres.constraints\"></span><span id=\"postgresql-specific-database-constraints\"></span><h1>PostgreSQL specific database constraints<a class=\"headerlink\" href=\"#module-django.contrib.postgres.constraints\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>PostgreSQL supports additional data integrity constraints available from the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">django.contrib.postgres.constraints</span></code> module. They are added in the model\n<a class=\"reference internal\" href=\"../../../models/options/#django.db.models.Options.constraints\" title=\"django.db.models.Options.constraints\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Meta.constraints</span></code></a> option.</p>\n<div class=\"section\" id=\"s-exclusionconstraint\">\n<span id=\"exclusionconstraint\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">ExclusionConstraint</span></code><a class=\"headerlink\" href=\"#exclusionconstraint\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">ExclusionConstraint</span></code>(<em><span class=\"o\"><span class=\"pre\">*</span></span></em>, <em><span class=\"n\"><span class=\"pre\">name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">expressions</span></span></em>, <em><span class=\"n\"><span class=\"pre\">index_type</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">condition</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">deferrable</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">include</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_code</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_message</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>)<a class=\"reference internal\" href=\"../../../../_modules/django/contrib/postgres/constraints/#ExclusionConstraint\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Creates an exclusion constraint in the database. Internally, PostgreSQL\nimplements exclusion constraints using indexes. The default index type is\n<a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/gist.html\">GiST</a>. To use them,\nyou need to activate the <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/btree-gist.html\">btree_gist extension</a> on PostgreSQL.\nYou can install it using the\n<a class=\"reference internal\" href=\"../operations/#django.contrib.postgres.operations.BtreeGistExtension\" title=\"django.contrib.postgres.operations.BtreeGistExtension\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">BtreeGistExtension</span></code></a> migration\noperation.</p>\n<p>If you attempt to insert a new row that conflicts with an existing row, an\n<a class=\"reference internal\" href=\"../../../exceptions/#django.db.IntegrityError\" title=\"django.db.IntegrityError\"><code class=\"xref py py-exc docutils literal notranslate\"><span class=\"pre\">IntegrityError</span></code></a> is raised. Similarly, when update\nconflicts with an existing row.</p>\n<p>Exclusion constraints are checked during the <a class=\"reference internal\" href=\"../../../models/instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>.</p>\n</dd></dl>\n\n<div class=\"section\" id=\"s-name\">\n<span id=\"name\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code><a class=\"headerlink\" href=\"#name\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint.name\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">ExclusionConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">name</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.name\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>See <a class=\"reference internal\" href=\"../../../models/constraints/#django.db.models.BaseConstraint.name\" title=\"django.db.models.BaseConstraint.name\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">BaseConstraint.name</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-expressions\">\n<span id=\"expressions\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">expressions</span></code><a class=\"headerlink\" href=\"#expressions\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint.expressions\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">ExclusionConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">expressions</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.expressions\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>An iterable of 2-tuples. The first element is an expression or string. The\nsecond element is an SQL operator represented as a string. To avoid typos, you\nmay use <a class=\"reference internal\" href=\"../fields/#django.contrib.postgres.fields.RangeOperators\" title=\"django.contrib.postgres.fields.RangeOperators\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">RangeOperators</span></code></a> which maps the\noperators with strings. For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">expressions</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"p\">(</span><span class=\"s2\">&quot;timespan&quot;</span><span class=\"p\">,</span> <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">ADJACENT_TO</span><span class=\"p\">),</span>\n    <span class=\"p\">(</span><span class=\"n\">F</span><span class=\"p\">(</span><span class=\"s2\">&quot;room&quot;</span><span class=\"p\">),</span> <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">EQUAL</span><span class=\"p\">),</span>\n<span class=\"p\">]</span>\n</pre></div>\n</div>\n<div class=\"admonition-restrictions-on-operators admonition\">\n<p class=\"first admonition-title\">Restrictions on operators.</p>\n<p class=\"last\">Only commutative operators can be used in exclusion constraints.</p>\n</div>\n<p>The <a class=\"reference internal\" href=\"../indexes/#django.contrib.postgres.indexes.OpClass\" title=\"django.contrib.postgres.indexes.OpClass\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">OpClass()</span></code></a> expression can\nbe used to specify a custom <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/indexes-opclass.html\">operator class</a> for the constraint expressions.\nFor example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">expressions</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n    <span class=\"p\">(</span><span class=\"n\">OpClass</span><span class=\"p\">(</span><span class=\"s2\">&quot;circle&quot;</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;circle_ops&quot;</span><span class=\"p\">),</span> <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">OVERLAPS</span><span class=\"p\">),</span>\n<span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>creates an exclusion constraint on <code class=\"docutils literal notranslate\"><span class=\"pre\">circle</span></code> using <code class=\"docutils literal notranslate\"><span class=\"pre\">circle_ops</span></code>.</p>\n</div>\n<div class=\"section\" id=\"s-index-type\">\n<span id=\"index-type\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">index_type</span></code><a class=\"headerlink\" href=\"#index-type\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint.index_type\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">ExclusionConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">index_type</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.index_type\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The index type of the constraint. Accepted values are <code class=\"docutils literal notranslate\"><span class=\"pre\">GIST</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">SPGIST</span></code>.\nMatching is case insensitive. If not provided, the default index type is\n<code class=\"docutils literal notranslate\"><span class=\"pre\">GIST</span></code>.</p>\n</div>\n<div class=\"section\" id=\"s-condition\">\n<span id=\"condition\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">condition</span></code><a class=\"headerlink\" href=\"#condition\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint.condition\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">ExclusionConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">condition</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.condition\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>A <a class=\"reference internal\" href=\"../../../models/querysets/#django.db.models.Q\" title=\"django.db.models.Q\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Q</span></code></a> object that specifies the condition to restrict\na constraint to a subset of rows. For example,\n<code class=\"docutils literal notranslate\"><span class=\"pre\">condition=Q(cancelled=False)</span></code>.</p>\n<p>These conditions have the same database restrictions as\n<a class=\"reference internal\" href=\"../../../models/indexes/#django.db.models.Index.condition\" title=\"django.db.models.Index.condition\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">django.db.models.Index.condition</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-deferrable\">\n<span id=\"deferrable\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">deferrable</span></code><a class=\"headerlink\" href=\"#deferrable\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint.deferrable\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">ExclusionConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">deferrable</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.deferrable\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>Set this parameter to create a deferrable exclusion constraint. Accepted values\nare <code class=\"docutils literal notranslate\"><span class=\"pre\">Deferrable.DEFERRED</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">Deferrable.IMMEDIATE</span></code>. For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.constraints</span> <span class=\"kn\">import</span> <span class=\"n\">ExclusionConstraint</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.fields</span> <span class=\"kn\">import</span> <span class=\"n\">RangeOperators</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models</span> <span class=\"kn\">import</span> <span class=\"n\">Deferrable</span>\n\n\n<span class=\"n\">ExclusionConstraint</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;exclude_overlapping_deferred&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">expressions</span><span class=\"o\">=</span><span class=\"p\">[</span>\n        <span class=\"p\">(</span><span class=\"s2\">&quot;timespan&quot;</span><span class=\"p\">,</span> <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">OVERLAPS</span><span class=\"p\">),</span>\n    <span class=\"p\">],</span>\n    <span class=\"n\">deferrable</span><span class=\"o\">=</span><span class=\"n\">Deferrable</span><span class=\"o\">.</span><span class=\"n\">DEFERRED</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>By default constraints are not deferred. A deferred constraint will not be\nenforced until the end of the transaction. An immediate constraint will be\nenforced immediately after every command.</p>\n<div class=\"admonition warning\">\n<p class=\"first admonition-title\">Warning</p>\n<p class=\"last\">Deferred exclusion constraints may lead to a <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/sql-createtable.html#id-1.9.3.85.9.4\">performance penalty</a>.</p>\n</div>\n</div>\n<div class=\"section\" id=\"s-include\">\n<span id=\"include\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code><a class=\"headerlink\" href=\"#include\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint.include\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">ExclusionConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">include</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.include\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>A list or tuple of the names of the fields to be included in the covering\nexclusion constraint as non-key columns. This allows index-only scans to be\nused for queries that select only included fields\n(<a class=\"reference internal\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.include\" title=\"django.contrib.postgres.constraints.ExclusionConstraint.include\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">include</span></code></a>) and filter only by indexed fields\n(<a class=\"reference internal\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.expressions\" title=\"django.contrib.postgres.constraints.ExclusionConstraint.expressions\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">expressions</span></code></a>).</p>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code> is supported for GiST indexes. PostgreSQL 14+ also supports\n<code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code> for SP-GiST indexes.</p>\n</div>\n<div class=\"section\" id=\"s-violation-error-code\">\n<span id=\"violation-error-code\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_code</span></code><a class=\"headerlink\" href=\"#violation-error-code\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<div class=\"versionadded\">\n<span class=\"title\">New in Django Development version.</span> </div>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.contrib.postgres.constraints.ExclusionConstraint.violation_error_code\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">ExclusionConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">violation_error_code</span></code><a class=\"headerlink\" href=\"#django.contrib.postgres.constraints.ExclusionConstraint.violation_error_code\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The error code used when <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidationError</span></code> is raised during\n<a class=\"reference internal\" href=\"../../../models/instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>. Defaults to <code class=\"docutils literal notranslate\"><span class=\"pre\">None</span></code>.</p>\n</div>\n<div class=\"section\" id=\"s-violation-error-message\">\n<span id=\"violation-error-message\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_message</span></code><a class=\"headerlink\" href=\"#violation-error-message\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The error message used when <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidationError</span></code> is raised during\n<a class=\"reference internal\" href=\"../../../models/instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>. Defaults to\n<a class=\"reference internal\" href=\"../../../models/constraints/#django.db.models.BaseConstraint.violation_error_message\" title=\"django.db.models.BaseConstraint.violation_error_message\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">BaseConstraint.violation_error_message</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-examples\">\n<span id=\"examples\"></span><h3>Examples<a class=\"headerlink\" href=\"#examples\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The following example restricts overlapping reservations in the same room, not\ntaking canceled reservations into account:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.constraints</span> <span class=\"kn\">import</span> <span class=\"n\">ExclusionConstraint</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.fields</span> <span class=\"kn\">import</span> <span class=\"n\">DateTimeRangeField</span><span class=\"p\">,</span> <span class=\"n\">RangeOperators</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db</span> <span class=\"kn\">import</span> <span class=\"n\">models</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models</span> <span class=\"kn\">import</span> <span class=\"n\">Q</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Room</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">number</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">IntegerField</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Reservation</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">room</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ForeignKey</span><span class=\"p\">(</span><span class=\"s2\">&quot;Room&quot;</span><span class=\"p\">,</span> <span class=\"n\">on_delete</span><span class=\"o\">=</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CASCADE</span><span class=\"p\">)</span>\n    <span class=\"n\">timespan</span> <span class=\"o\">=</span> <span class=\"n\">DateTimeRangeField</span><span class=\"p\">()</span>\n    <span class=\"n\">cancelled</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">BooleanField</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">constraints</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">ExclusionConstraint</span><span class=\"p\">(</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;exclude_overlapping_reservations&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">expressions</span><span class=\"o\">=</span><span class=\"p\">[</span>\n                    <span class=\"p\">(</span><span class=\"s2\">&quot;timespan&quot;</span><span class=\"p\">,</span> <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">OVERLAPS</span><span class=\"p\">),</span>\n                    <span class=\"p\">(</span><span class=\"s2\">&quot;room&quot;</span><span class=\"p\">,</span> <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">EQUAL</span><span class=\"p\">),</span>\n                <span class=\"p\">],</span>\n                <span class=\"n\">condition</span><span class=\"o\">=</span><span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">cancelled</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">]</span>\n</pre></div>\n</div>\n<p>In case your model defines a range using two fields, instead of the native\nPostgreSQL range types, you should write an expression that uses the equivalent\nfunction (e.g. <code class=\"docutils literal notranslate\"><span class=\"pre\">TsTzRange()</span></code>), and use the delimiters for the field. Most\noften, the delimiters will be <code class=\"docutils literal notranslate\"><span class=\"pre\">'[)'</span></code>, meaning that the lower bound is\ninclusive and the upper bound is exclusive. You may use the\n<a class=\"reference internal\" href=\"../fields/#django.contrib.postgres.fields.RangeBoundary\" title=\"django.contrib.postgres.fields.RangeBoundary\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">RangeBoundary</span></code></a> that provides an\nexpression mapping for the <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/rangetypes.html#RANGETYPES-INCLUSIVITY\">range boundaries</a>. For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.constraints</span> <span class=\"kn\">import</span> <span class=\"n\">ExclusionConstraint</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.contrib.postgres.fields</span> <span class=\"kn\">import</span> <span class=\"p\">(</span>\n    <span class=\"n\">DateTimeRangeField</span><span class=\"p\">,</span>\n    <span class=\"n\">RangeBoundary</span><span class=\"p\">,</span>\n    <span class=\"n\">RangeOperators</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db</span> <span class=\"kn\">import</span> <span class=\"n\">models</span>\n<span class=\"kn\">from</span> <span class=\"nn\">django.db.models</span> <span class=\"kn\">import</span> <span class=\"n\">Func</span><span class=\"p\">,</span> <span class=\"n\">Q</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">TsTzRange</span><span class=\"p\">(</span><span class=\"n\">Func</span><span class=\"p\">):</span>\n    <span class=\"n\">function</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;TSTZRANGE&quot;</span>\n    <span class=\"n\">output_field</span> <span class=\"o\">=</span> <span class=\"n\">DateTimeRangeField</span><span class=\"p\">()</span>\n\n\n<span class=\"k\">class</span> <span class=\"nc\">Reservation</span><span class=\"p\">(</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">Model</span><span class=\"p\">):</span>\n    <span class=\"n\">room</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">ForeignKey</span><span class=\"p\">(</span><span class=\"s2\">&quot;Room&quot;</span><span class=\"p\">,</span> <span class=\"n\">on_delete</span><span class=\"o\">=</span><span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">CASCADE</span><span class=\"p\">)</span>\n    <span class=\"n\">start</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">DateTimeField</span><span class=\"p\">()</span>\n    <span class=\"n\">end</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">DateTimeField</span><span class=\"p\">()</span>\n    <span class=\"n\">cancelled</span> <span class=\"o\">=</span> <span class=\"n\">models</span><span class=\"o\">.</span><span class=\"n\">BooleanField</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n\n    <span class=\"k\">class</span> <span class=\"nc\">Meta</span><span class=\"p\">:</span>\n        <span class=\"n\">constraints</span> <span class=\"o\">=</span> <span class=\"p\">[</span>\n            <span class=\"n\">ExclusionConstraint</span><span class=\"p\">(</span>\n                <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;exclude_overlapping_reservations&quot;</span><span class=\"p\">,</span>\n                <span class=\"n\">expressions</span><span class=\"o\">=</span><span class=\"p\">[</span>\n                    <span class=\"p\">(</span>\n                        <span class=\"n\">TsTzRange</span><span class=\"p\">(</span><span class=\"s2\">&quot;start&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;end&quot;</span><span class=\"p\">,</span> <span class=\"n\">RangeBoundary</span><span class=\"p\">()),</span>\n                        <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">OVERLAPS</span><span class=\"p\">,</span>\n                    <span class=\"p\">),</span>\n                    <span class=\"p\">(</span><span class=\"s2\">&quot;room&quot;</span><span class=\"p\">,</span> <span class=\"n\">RangeOperators</span><span class=\"o\">.</span><span class=\"n\">EQUAL</span><span class=\"p\">),</span>\n                <span class=\"p\">],</span>\n                <span class=\"n\">condition</span><span class=\"o\">=</span><span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">cancelled</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">),</span>\n            <span class=\"p\">),</span>\n        <span class=\"p\">]</span>\n</pre></div>\n</div>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["ref/contrib/postgres/expressions", "PostgreSQL specific query expressions", "N", "next"], ["ref/contrib/postgres/aggregates", "PostgreSQL specific aggregation functions", "P", "previous"]], "sourcename": "ref/contrib/postgres/constraints.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">PostgreSQL specific database constraints</a><ul>\n<li><a class=\"reference internal\" href=\"#exclusionconstraint\"><code class=\"docutils literal notranslate\"><span class=\"pre\">ExclusionConstraint</span></code></a><ul>\n<li><a class=\"reference internal\" href=\"#name\"><code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#expressions\"><code class=\"docutils literal notranslate\"><span class=\"pre\">expressions</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#index-type\"><code class=\"docutils literal notranslate\"><span class=\"pre\">index_type</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#condition\"><code class=\"docutils literal notranslate\"><span class=\"pre\">condition</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#deferrable\"><code class=\"docutils literal notranslate\"><span class=\"pre\">deferrable</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#include\"><code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#violation-error-code\"><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_code</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#violation-error-message\"><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_message</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#examples\">Examples</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "ref/contrib/postgres/constraints", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}