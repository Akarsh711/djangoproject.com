{"parents": [{"link": "../../", "title": "API Reference"}, {"link": "../", "title": "Models"}], "prev": {"link": "../indexes/", "title": "Model index reference"}, "next": {"link": "../meta/", "title": "Model <code class=\"docutils literal notranslate\"><span class=\"pre\">_meta</span></code> API"}, "title": "Constraints reference", "meta": {}, "body": "<div class=\"section\" id=\"s-module-django.db.models.constraints\">\n<span id=\"s-constraints-reference\"></span><span id=\"module-django.db.models.constraints\"></span><span id=\"constraints-reference\"></span><h1>Constraints reference<a class=\"headerlink\" href=\"#module-django.db.models.constraints\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>The classes defined in this module create database constraints. They are added\nin the model <a class=\"reference internal\" href=\"../options/#django.db.models.Options.constraints\" title=\"django.db.models.Options.constraints\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Meta.constraints</span></code></a>\noption.</p>\n<div class=\"admonition-referencing-built-in-constraints admonition\">\n<p class=\"first admonition-title\">Referencing built-in constraints</p>\n<p class=\"last\">Constraints are defined in <code class=\"docutils literal notranslate\"><span class=\"pre\">django.db.models.constraints</span></code>, but for\nconvenience they\u2019re imported into <a class=\"reference internal\" href=\"../../../topics/db/models/#module-django.db.models\" title=\"django.db.models\"><code class=\"xref py py-mod docutils literal notranslate\"><span class=\"pre\">django.db.models</span></code></a>. The standard\nconvention is to use <code class=\"docutils literal notranslate\"><span class=\"pre\">from</span> <span class=\"pre\">django.db</span> <span class=\"pre\">import</span> <span class=\"pre\">models</span></code> and refer to the\nconstraints as <code class=\"docutils literal notranslate\"><span class=\"pre\">models.&lt;Foo&gt;Constraint</span></code>.</p>\n</div>\n<div class=\"admonition-constraints-in-abstract-base-classes admonition\">\n<p class=\"first admonition-title\">Constraints in abstract base classes</p>\n<p class=\"last\">You must always specify a unique name for the constraint. As such, you\ncannot normally specify a constraint on an abstract base class, since the\n<a class=\"reference internal\" href=\"../options/#django.db.models.Options.constraints\" title=\"django.db.models.Options.constraints\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Meta.constraints</span></code></a> option is\ninherited by subclasses, with exactly the same values for the attributes\n(including <code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code>) each time. To work around name collisions, part of the\nname may contain <code class=\"docutils literal notranslate\"><span class=\"pre\">'%(app_label)s'</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">'%(class)s'</span></code>, which are\nreplaced, respectively, by the lowercased app label and class name of the\nconcrete model. For example <code class=\"docutils literal notranslate\"><span class=\"pre\">CheckConstraint(check=Q(age__gte=18),</span>\n<span class=\"pre\">name='%(app_label)s_%(class)s_is_adult')</span></code>.</p>\n</div>\n<div class=\"admonition-validation-of-constraints admonition\">\n<p class=\"first admonition-title\">Validation of Constraints</p>\n<p class=\"last\">Constraints are checked during the <a class=\"reference internal\" href=\"../instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>.</p>\n</div>\n<div class=\"admonition-validation-of-constraints-with-jsonfield admonition\">\n<p class=\"first admonition-title\">Validation of Constraints with <code class=\"docutils literal notranslate\"><span class=\"pre\">JSONField</span></code></p>\n<p>Constraints containing <a class=\"reference internal\" href=\"../fields/#django.db.models.JSONField\" title=\"django.db.models.JSONField\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">JSONField</span></code></a> may not raise\nvalidation errors as key, index, and path transforms have many\ndatabase-specific caveats. This <a class=\"reference external\" href=\"https://code.djangoproject.com/ticket/34059\">may be fully supported later</a>.</p>\n<p class=\"last\">You should always check that there are no log messages, in the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">django.db.models</span></code> logger, like <em>\u201cGot a database error calling check() on\n\u2026\u201d</em> to confirm it\u2019s validated properly.</p>\n</div>\n<div class=\"section\" id=\"s-baseconstraint\">\n<span id=\"baseconstraint\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">BaseConstraint</span></code><a class=\"headerlink\" href=\"#baseconstraint\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.BaseConstraint\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">BaseConstraint</span></code>(<em><span class=\"o\"><span class=\"pre\">*</span></span><span class=\"n\"><span class=\"pre\">name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_code</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_message</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>)<a class=\"reference internal\" href=\"../../../_modules/django/db/models/constraints/#BaseConstraint\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.db.models.BaseConstraint\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Base class for all constraints. Subclasses must implement\n<code class=\"docutils literal notranslate\"><span class=\"pre\">constraint_sql()</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">create_sql()</span></code>, <code class=\"docutils literal notranslate\"><span class=\"pre\">remove_sql()</span></code> and\n<code class=\"docutils literal notranslate\"><span class=\"pre\">validate()</span></code> methods.</p>\n<div class=\"deprecated\">\n<p><span class=\"versionmodified deprecated\">Deprecated since version 5.0: </span>Support for passing positional arguments is deprecated.</p>\n</div>\n</dd></dl>\n\n<p>All constraints have the following parameters in common:</p>\n<div class=\"section\" id=\"s-name\">\n<span id=\"name\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code><a class=\"headerlink\" href=\"#name\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.BaseConstraint.name\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">BaseConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">name</span></code><a class=\"headerlink\" href=\"#django.db.models.BaseConstraint.name\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The name of the constraint. You must always specify a unique name for the\nconstraint.</p>\n</div>\n<div class=\"section\" id=\"s-violation-error-code\">\n<span id=\"violation-error-code\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_code</span></code><a class=\"headerlink\" href=\"#violation-error-code\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<div class=\"versionadded\">\n<span class=\"title\">New in Django Development version.</span> </div>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.BaseConstraint.violation_error_code\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">BaseConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">violation_error_code</span></code><a class=\"headerlink\" href=\"#django.db.models.BaseConstraint.violation_error_code\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The error code used when <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidationError</span></code> is raised during\n<a class=\"reference internal\" href=\"../instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>. Defaults to <code class=\"docutils literal notranslate\"><span class=\"pre\">None</span></code>.</p>\n</div>\n<div class=\"section\" id=\"s-violation-error-message\">\n<span id=\"violation-error-message\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_message</span></code><a class=\"headerlink\" href=\"#violation-error-message\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.BaseConstraint.violation_error_message\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">BaseConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">violation_error_message</span></code><a class=\"headerlink\" href=\"#django.db.models.BaseConstraint.violation_error_message\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The error message used when <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidationError</span></code> is raised during\n<a class=\"reference internal\" href=\"../instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>. Defaults to\n<code class=\"docutils literal notranslate\"><span class=\"pre\">&quot;Constraint</span> <span class=\"pre\">\u201c%(name)s\u201d</span> <span class=\"pre\">is</span> <span class=\"pre\">violated.&quot;</span></code>.</p>\n</div>\n<div class=\"section\" id=\"s-validate\">\n<span id=\"validate\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">validate()</span></code><a class=\"headerlink\" href=\"#validate\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py method\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.BaseConstraint.validate\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">BaseConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">validate</span></code>(<em><span class=\"n\"><span class=\"pre\">model</span></span></em>, <em><span class=\"n\"><span class=\"pre\">instance</span></span></em>, <em><span class=\"n\"><span class=\"pre\">exclude</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">using</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">DEFAULT_DB_ALIAS</span></span></em>)<a class=\"reference internal\" href=\"../../../_modules/django/db/models/constraints/#BaseConstraint.validate\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.db.models.BaseConstraint.validate\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>Validates that the constraint, defined on <code class=\"docutils literal notranslate\"><span class=\"pre\">model</span></code>, is respected on the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">instance</span></code>. This will do a query on the database to ensure that the\nconstraint is respected. If fields in the <code class=\"docutils literal notranslate\"><span class=\"pre\">exclude</span></code> list are needed to\nvalidate the constraint, the constraint is ignored.</p>\n<p>Raise a <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidationError</span></code> if the constraint is violated.</p>\n<p>This method must be implemented by a subclass.</p>\n</div>\n</div>\n<div class=\"section\" id=\"s-checkconstraint\">\n<span id=\"checkconstraint\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">CheckConstraint</span></code><a class=\"headerlink\" href=\"#checkconstraint\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.CheckConstraint\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">CheckConstraint</span></code>(<em><span class=\"o\"><span class=\"pre\">*</span></span></em>, <em><span class=\"n\"><span class=\"pre\">check</span></span></em>, <em><span class=\"n\"><span class=\"pre\">name</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_code</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_message</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>)<a class=\"reference internal\" href=\"../../../_modules/django/db/models/constraints/#CheckConstraint\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.db.models.CheckConstraint\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Creates a check constraint in the database.</p>\n</dd></dl>\n\n<div class=\"section\" id=\"s-check\">\n<span id=\"check\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">check</span></code><a class=\"headerlink\" href=\"#check\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.CheckConstraint.check\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">CheckConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">check</span></code><a class=\"headerlink\" href=\"#django.db.models.CheckConstraint.check\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>A <a class=\"reference internal\" href=\"../querysets/#django.db.models.Q\" title=\"django.db.models.Q\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Q</span></code></a> object or boolean <a class=\"reference internal\" href=\"../expressions/#django.db.models.Expression\" title=\"django.db.models.Expression\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Expression</span></code></a> that\nspecifies the check you want the constraint to enforce.</p>\n<p>For example, <code class=\"docutils literal notranslate\"><span class=\"pre\">CheckConstraint(check=Q(age__gte=18),</span> <span class=\"pre\">name='age_gte_18')</span></code>\nensures the age field is never less than 18.</p>\n<div class=\"admonition-oracle admonition\">\n<p class=\"first admonition-title\">Oracle</p>\n<p>Checks with nullable fields on Oracle must include a condition allowing for\n<code class=\"docutils literal notranslate\"><span class=\"pre\">NULL</span></code> values in order for <a class=\"reference internal\" href=\"#django.db.models.BaseConstraint.validate\" title=\"django.db.models.BaseConstraint.validate\"><code class=\"xref py py-meth docutils literal notranslate\"><span class=\"pre\">validate()</span></code></a>\nto behave the same as check constraints validation. For example, if <code class=\"docutils literal notranslate\"><span class=\"pre\">age</span></code>\nis a nullable field:</p>\n<div class=\"last highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">CheckConstraint</span><span class=\"p\">(</span><span class=\"n\">check</span><span class=\"o\">=</span><span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">age__gte</span><span class=\"o\">=</span><span class=\"mi\">18</span><span class=\"p\">)</span> <span class=\"o\">|</span> <span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">age__isnull</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;age_gte_18&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</div>\n</div>\n</div>\n<div class=\"section\" id=\"s-uniqueconstraint\">\n<span id=\"uniqueconstraint\"></span><h2><code class=\"docutils literal notranslate\"><span class=\"pre\">UniqueConstraint</span></code><a class=\"headerlink\" href=\"#uniqueconstraint\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"py class\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint\">\n<em class=\"property\"><span class=\"pre\">class</span><span class=\"w\"> </span></em><code class=\"sig-name descname\"><span class=\"pre\">UniqueConstraint</span></code>(<em><span class=\"o\"><span class=\"pre\">*</span></span><span class=\"n\"><span class=\"pre\">expressions</span></span></em>, <em><span class=\"n\"><span class=\"pre\">fields</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">()</span></span></em>, <em><span class=\"n\"><span class=\"pre\">name</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">condition</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">deferrable</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">include</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">opclasses</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">()</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_code</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>, <em><span class=\"n\"><span class=\"pre\">violation_error_message</span></span><span class=\"o\"><span class=\"pre\">=</span></span><span class=\"default_value\"><span class=\"pre\">None</span></span></em>)<a class=\"reference internal\" href=\"../../../_modules/django/db/models/constraints/#UniqueConstraint\"><span class=\"viewcode-link\"><span class=\"pre\">[source]</span></span></a><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd><p>Creates a unique constraint in the database.</p>\n</dd></dl>\n\n<div class=\"section\" id=\"s-expressions\">\n<span id=\"expressions\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">expressions</span></code><a class=\"headerlink\" href=\"#expressions\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.expressions\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">expressions</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.expressions\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>Positional argument <code class=\"docutils literal notranslate\"><span class=\"pre\">*expressions</span></code> allows creating functional unique\nconstraints on expressions and database functions.</p>\n<p>For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">UniqueConstraint</span><span class=\"p\">(</span><span class=\"n\">Lower</span><span class=\"p\">(</span><span class=\"s2\">&quot;name&quot;</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">desc</span><span class=\"p\">(),</span> <span class=\"s2\">&quot;category&quot;</span><span class=\"p\">,</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;unique_lower_name_category&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>creates a unique constraint on the lowercased value of the <code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code> field in\ndescending order and the <code class=\"docutils literal notranslate\"><span class=\"pre\">category</span></code> field in the default ascending order.</p>\n<p>Functional unique constraints have the same database restrictions as\n<a class=\"reference internal\" href=\"../indexes/#django.db.models.Index.expressions\" title=\"django.db.models.Index.expressions\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Index.expressions</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-fields\">\n<span id=\"fields\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">fields</span></code><a class=\"headerlink\" href=\"#fields\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.fields\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">fields</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.fields\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>A list of field names that specifies the unique set of columns you want the\nconstraint to enforce.</p>\n<p>For example, <code class=\"docutils literal notranslate\"><span class=\"pre\">UniqueConstraint(fields=['room',</span> <span class=\"pre\">'date'],</span>\n<span class=\"pre\">name='unique_booking')</span></code> ensures each room can only be booked once for each\ndate.</p>\n</div>\n<div class=\"section\" id=\"s-condition\">\n<span id=\"condition\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">condition</span></code><a class=\"headerlink\" href=\"#condition\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.condition\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">condition</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.condition\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>A <a class=\"reference internal\" href=\"../querysets/#django.db.models.Q\" title=\"django.db.models.Q\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">Q</span></code></a> object that specifies the condition you want the constraint to\nenforce.</p>\n<p>For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">UniqueConstraint</span><span class=\"p\">(</span><span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;user&quot;</span><span class=\"p\">],</span> <span class=\"n\">condition</span><span class=\"o\">=</span><span class=\"n\">Q</span><span class=\"p\">(</span><span class=\"n\">status</span><span class=\"o\">=</span><span class=\"s2\">&quot;DRAFT&quot;</span><span class=\"p\">),</span> <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;unique_draft_user&quot;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>ensures that each user only has one draft.</p>\n<p>These conditions have the same database restrictions as\n<a class=\"reference internal\" href=\"../indexes/#django.db.models.Index.condition\" title=\"django.db.models.Index.condition\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Index.condition</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-deferrable\">\n<span id=\"deferrable\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">deferrable</span></code><a class=\"headerlink\" href=\"#deferrable\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.deferrable\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">deferrable</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.deferrable\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>Set this parameter to create a deferrable unique constraint. Accepted values\nare <code class=\"docutils literal notranslate\"><span class=\"pre\">Deferrable.DEFERRED</span></code> or <code class=\"docutils literal notranslate\"><span class=\"pre\">Deferrable.IMMEDIATE</span></code>. For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">django.db.models</span> <span class=\"kn\">import</span> <span class=\"n\">Deferrable</span><span class=\"p\">,</span> <span class=\"n\">UniqueConstraint</span>\n\n<span class=\"n\">UniqueConstraint</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;unique_order&quot;</span><span class=\"p\">,</span>\n    <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;order&quot;</span><span class=\"p\">],</span>\n    <span class=\"n\">deferrable</span><span class=\"o\">=</span><span class=\"n\">Deferrable</span><span class=\"o\">.</span><span class=\"n\">DEFERRED</span><span class=\"p\">,</span>\n<span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>By default constraints are not deferred. A deferred constraint will not be\nenforced until the end of the transaction. An immediate constraint will be\nenforced immediately after every command.</p>\n<div class=\"admonition-mysql-mariadb-and-sqlite admonition\">\n<p class=\"first admonition-title\">MySQL, MariaDB, and SQLite.</p>\n<p class=\"last\">Deferrable unique constraints are ignored on MySQL, MariaDB, and SQLite as\nneither supports them.</p>\n</div>\n<div class=\"admonition warning\">\n<p class=\"first admonition-title\">Warning</p>\n<p class=\"last\">Deferred unique constraints may lead to a <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/sql-createtable.html#id-1.9.3.85.9.4\">performance penalty</a>.</p>\n</div>\n</div>\n<div class=\"section\" id=\"s-include\">\n<span id=\"include\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code><a class=\"headerlink\" href=\"#include\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.include\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">include</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.include\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>A list or tuple of the names of the fields to be included in the covering\nunique index as non-key columns. This allows index-only scans to be used for\nqueries that select only included fields (<a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint.include\" title=\"django.db.models.UniqueConstraint.include\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">include</span></code></a>)\nand filter only by unique fields (<a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint.fields\" title=\"django.db.models.UniqueConstraint.fields\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">fields</span></code></a>).</p>\n<p>For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">UniqueConstraint</span><span class=\"p\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;unique_booking&quot;</span><span class=\"p\">,</span> <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;room&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;date&quot;</span><span class=\"p\">],</span> <span class=\"n\">include</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;full_name&quot;</span><span class=\"p\">])</span>\n</pre></div>\n</div>\n<p>will allow filtering on <code class=\"docutils literal notranslate\"><span class=\"pre\">room</span></code> and <code class=\"docutils literal notranslate\"><span class=\"pre\">date</span></code>, also selecting <code class=\"docutils literal notranslate\"><span class=\"pre\">full_name</span></code>,\nwhile fetching data only from the index.</p>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code> is supported only on PostgreSQL.</p>\n<p>Non-key columns have the same database restrictions as <a class=\"reference internal\" href=\"../indexes/#django.db.models.Index.include\" title=\"django.db.models.Index.include\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Index.include</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-opclasses\">\n<span id=\"opclasses\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">opclasses</span></code><a class=\"headerlink\" href=\"#opclasses\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.opclasses\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">opclasses</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.opclasses\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The names of the <a class=\"reference external\" href=\"https://www.postgresql.org/docs/current/indexes-opclass.html\">PostgreSQL operator classes</a> to use for\nthis unique index. If you require a custom operator class, you must provide one\nfor each field in the index.</p>\n<p>For example:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">UniqueConstraint</span><span class=\"p\">(</span>\n    <span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s2\">&quot;unique_username&quot;</span><span class=\"p\">,</span> <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;username&quot;</span><span class=\"p\">],</span> <span class=\"n\">opclasses</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s2\">&quot;varchar_pattern_ops&quot;</span><span class=\"p\">]</span>\n<span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>creates a unique index on <code class=\"docutils literal notranslate\"><span class=\"pre\">username</span></code> using <code class=\"docutils literal notranslate\"><span class=\"pre\">varchar_pattern_ops</span></code>.</p>\n<p><code class=\"docutils literal notranslate\"><span class=\"pre\">opclasses</span></code> are ignored for databases besides PostgreSQL.</p>\n</div>\n<div class=\"section\" id=\"s-id1\">\n<span id=\"id1\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_code</span></code><a class=\"headerlink\" href=\"#id1\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<div class=\"versionadded\">\n<span class=\"title\">New in Django Development version.</span> </div>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.violation_error_code\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">violation_error_code</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.violation_error_code\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The error code used when <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidationError</span></code> is raised during\n<a class=\"reference internal\" href=\"../instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>. Defaults to <code class=\"docutils literal notranslate\"><span class=\"pre\">None</span></code>.</p>\n<p>This code is <em>not used</em> for <a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint\" title=\"django.db.models.UniqueConstraint\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">UniqueConstraint</span></code></a>s with\n<a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint.fields\" title=\"django.db.models.UniqueConstraint.fields\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">fields</span></code></a> and without a\n<a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint.condition\" title=\"django.db.models.UniqueConstraint.condition\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">condition</span></code></a>. Such <a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint\" title=\"django.db.models.UniqueConstraint\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">UniqueConstraint</span></code></a>s have the\nsame error code as constraints defined with <a class=\"reference internal\" href=\"../fields/#django.db.models.Field.unique\" title=\"django.db.models.Field.unique\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Field.unique</span></code></a> or in\n<a class=\"reference internal\" href=\"../options/#django.db.models.Options.constraints\" title=\"django.db.models.Options.constraints\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Meta.unique_together</span></code></a>.</p>\n</div>\n<div class=\"section\" id=\"s-id2\">\n<span id=\"id2\"></span><h3><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_message</span></code><a class=\"headerlink\" href=\"#id2\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"py attribute\">\n<dt class=\"sig sig-object py\" id=\"django.db.models.UniqueConstraint.violation_error_message\">\n<code class=\"sig-prename descclassname\"><span class=\"pre\">UniqueConstraint.</span></code><code class=\"sig-name descname\"><span class=\"pre\">violation_error_message</span></code><a class=\"headerlink\" href=\"#django.db.models.UniqueConstraint.violation_error_message\" title=\"Permalink to this definition\">\u00b6</a></dt>\n<dd></dd></dl>\n\n<p>The error message used when <code class=\"docutils literal notranslate\"><span class=\"pre\">ValidationError</span></code> is raised during\n<a class=\"reference internal\" href=\"../instances/#validating-objects\"><span class=\"std std-ref\">model validation</span></a>. Defaults to\n<a class=\"reference internal\" href=\"#django.db.models.BaseConstraint.violation_error_message\" title=\"django.db.models.BaseConstraint.violation_error_message\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">BaseConstraint.violation_error_message</span></code></a>.</p>\n<p>This message is <em>not used</em> for <a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint\" title=\"django.db.models.UniqueConstraint\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">UniqueConstraint</span></code></a>s with\n<a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint.fields\" title=\"django.db.models.UniqueConstraint.fields\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">fields</span></code></a> and without a\n<a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint.condition\" title=\"django.db.models.UniqueConstraint.condition\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">condition</span></code></a>. Such <a class=\"reference internal\" href=\"#django.db.models.UniqueConstraint\" title=\"django.db.models.UniqueConstraint\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">UniqueConstraint</span></code></a>s show the\nsame message as constraints defined with\n<a class=\"reference internal\" href=\"../fields/#django.db.models.Field.unique\" title=\"django.db.models.Field.unique\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Field.unique</span></code></a> or in\n<a class=\"reference internal\" href=\"../options/#django.db.models.Options.constraints\" title=\"django.db.models.Options.constraints\"><code class=\"xref py py-attr docutils literal notranslate\"><span class=\"pre\">Meta.unique_together</span></code></a>.</p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["ref/models/meta", "Model <code class=\"docutils literal notranslate\"><span class=\"pre\">_meta</span></code> API", "N", "next"], ["ref/models/indexes", "Model index reference", "P", "previous"]], "sourcename": "ref/models/constraints.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Constraints reference</a><ul>\n<li><a class=\"reference internal\" href=\"#baseconstraint\"><code class=\"docutils literal notranslate\"><span class=\"pre\">BaseConstraint</span></code></a><ul>\n<li><a class=\"reference internal\" href=\"#name\"><code class=\"docutils literal notranslate\"><span class=\"pre\">name</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#violation-error-code\"><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_code</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#violation-error-message\"><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_message</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#validate\"><code class=\"docutils literal notranslate\"><span class=\"pre\">validate()</span></code></a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#checkconstraint\"><code class=\"docutils literal notranslate\"><span class=\"pre\">CheckConstraint</span></code></a><ul>\n<li><a class=\"reference internal\" href=\"#check\"><code class=\"docutils literal notranslate\"><span class=\"pre\">check</span></code></a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#uniqueconstraint\"><code class=\"docutils literal notranslate\"><span class=\"pre\">UniqueConstraint</span></code></a><ul>\n<li><a class=\"reference internal\" href=\"#expressions\"><code class=\"docutils literal notranslate\"><span class=\"pre\">expressions</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#fields\"><code class=\"docutils literal notranslate\"><span class=\"pre\">fields</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#condition\"><code class=\"docutils literal notranslate\"><span class=\"pre\">condition</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#deferrable\"><code class=\"docutils literal notranslate\"><span class=\"pre\">deferrable</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#include\"><code class=\"docutils literal notranslate\"><span class=\"pre\">include</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#opclasses\"><code class=\"docutils literal notranslate\"><span class=\"pre\">opclasses</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#id1\"><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_code</span></code></a></li>\n<li><a class=\"reference internal\" href=\"#id2\"><code class=\"docutils literal notranslate\"><span class=\"pre\">violation_error_message</span></code></a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".txt", "current_page_name": "ref/models/constraints", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "favicon_url": null, "logo_url": null, "alabaster_version": "0.7.13", "include_console_assets": false}
